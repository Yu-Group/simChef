---
title: "Setting Up Your Simulation"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Setting Up Your Simulation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = FALSE
)
```

We recommend initializing your simulation directory as you would any new
analysis: using a project. Doing so improves reproducibility and replicability;
it keeps your code, data, and outputs are neatly separated from other analyses.
In the same vein, we encourage the use of version control software ---
[git](https://git-scm.com/) in particular. It helps you keep track of changes,
undo snafus, and seamlessly collaborate with your peers.

While you could create a version-controlled R project manually, we suggest using
the tools provided by the [`usethis`](https://usethis.r-lib.org/index.html) R
package. Here's a brief workflow:

1. Install the most recent release of this package by running
  `install.packages("usethis")`.
2. Create the project using `usethis::create_project()`.
3. Initialize a git repository with `usethis::use_git()`. Call this function
   from the root of your simulation project directory,
4. (Optional) Link you local project to a project on GitHub by running
   `usethis::use_github()`.
   
If you're unfamiliar with git or GitHub, or haven't yet set git up on you
machine, we suggest reviewing Chapters 4 through 8 of [*Happy Git and GitHub for
the useR*](https://happygitwithr.com/index.html).


Once your project is set up, we recommend organizing your project with the
following directories and files:

- `R/`: This folder will contain your simulation study's R code.
  - `meal.R`: Your `simChef` experiment is assembled in this file.
  - `dgp/`: Data-generating process functions are stored here.
  - `method/`: Method functions are stored here.
  - `eval/`: Evaluator functions are stored here.
  - `viz/`: Visualizer functions are stored here.
- `results/`: Your simulation experiment's output are automatically saved here.
- `README.md`: This markdown file briefly summarizes your simulation study's
  goals and results. Some guidance on navigating your project's directory
  structure might also be appreciated by your collaborators --- and even
  yourself at some point in the future.

You might consider including the following directories, too:

- `tests/`: Unit tests promote high-quality code by ensuring that your many
  functions operate as expected. Your simulation study's results are in turn
  more trustworthy. We recommend using the
  [`testthat`](https://testthat.r-lib.org/) R package's suite of unit testing
  tools, and including the following files and sub-directories:
  - `testthat.R`: This script should call `testthat::test_dir()` on the
    following sub-directories to run the tests contained therein.
  - `testthat/dgp-tests/`: Tests for data-generating process functions.
  - `testthat/method-tests/`: Tests for method functions.
  - `testthat/eval-tests/`: Tests for evaluator functions.
  - `testthat/viz-tests/`: Tests for visualizer functions.
- `scripts/`: We recommend running resource-intense simulation studies on
  high-performance computing environments with workload managers, like
  [SLURM](https://slurm.schedmd.com/documentation.html). Bash scripts for doing
  so can be saved here. For added flexibility, we recommend the R package
  [`optparse`](https://github.com/trevorld/r-optparse) to parse command-line
  options from your bash scripts within `meal.R`.
- `logs/`: The files output by these workload managers can be stored in this
  directory.

Again with reproducibility and replicability in mind, we encourage the use of
[`renv`](https://cran.r-project.org/web/packages/renv/index.html) for
project-local dependency management. The general `renv` workflow can be found
[here](https://rstudio.github.io/renv/articles/renv.html). Note that
initializing this tool generates an `renv/` directory and `renv.lock` file in
the root directory.

Of course, this project structure, as well as the names of directories and
files, are nothing but suggestions. Feel free to organize your simulation study
as best you see fit. You might find some inspiration
[here](https://github.com/openpharma/mmrm/tree/main/simulations) and
[here](https://github.com/PhilBoileau/simChef-case-study).

