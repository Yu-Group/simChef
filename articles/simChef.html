<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started with simChef • simChef</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with simChef">
<meta property="og:description" content="simChef">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simChef</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/simChef.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/parallel.html">Parallel strategies in `simChef`</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="simChef_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting started with simChef</h1>
            
      
      
      <div class="hidden name"><code>simChef.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The goal of <code>simChef</code> is to seamlessly and efficiently run simulation experiments using a simple grammar. The results of these simulation experiments can also be conveniently viewed in an organized and interactive browser (or html file) (e.g., <a href="linear_regression_output.html">here</a>). The basic usage of <code>simChef</code> can be summarized as follows:</p>
<ol style="list-style-type: decimal">
<li>Create individual parts of the simulation experiment recipe
<ol style="list-style-type: lower-alpha">
<li>Create DGP(s) (data-generating processes) via <code><a href="../reference/create_dgp.html">create_dgp()</a></code>
</li>
<li>Create Method(s) via <code><a href="../reference/create_method.html">create_method()</a></code>
</li>
<li>Create Evaluator(s) via <code><a href="../reference/create_evaluator.html">create_evaluator()</a></code>
</li>
<li>Create Visualizer(s) via <code><a href="../reference/create_visualizer.html">create_visualizer()</a></code>
</li>
</ol>
</li>
<li>Assemble recipe parts into a complete simulation experiment recipe, e.g., via</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_experiment.html">create_experiment</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Experiment"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/add_funs.html">add_dgp</a></span><span class="op">(</span><span class="va">dgp</span>, name <span class="op">=</span> <span class="st">"DGP1"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/add_funs.html">add_method</a></span><span class="op">(</span><span class="va">method</span>, name <span class="op">=</span> <span class="st">"Method1"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/add_funs.html">add_evaluator</a></span><span class="op">(</span><span class="va">evaluator</span>, name <span class="op">=</span> <span class="st">"Evaluator1"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/add_funs.html">add_visualizer</a></span><span class="op">(</span><span class="va">visualizer</span>, name <span class="op">=</span> <span class="st">"Visualizer1"</span><span class="op">)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Document and describe the simulation experiment in text</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/create_doc_template.html">create_doc_template</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Run the experiment</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span> <span class="op">&lt;-</span> <span class="va">experiment</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">100</span>, save <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>  
<span class="co"># or alternatively, `run_experiment(experiment, n_reps = 100, save = T)`</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Visualize results via an automated R Markdown report</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/create_rmd.html">create_rmd</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></code></pre></div>
<p>We will next go through a toy example simulation using linear regression.</p>
</div>
<div class="section level2">
<h2 id="basic-usage">Basic usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h2>
<div class="section level3">
<h3 id="create-individual-parts-of-the-simulation-experiment-recipe">Create individual parts of the simulation experiment recipe<a class="anchor" aria-label="anchor" href="#create-individual-parts-of-the-simulation-experiment-recipe"></a>
</h3>
<p>To begin, we first need to create the individual parts of the simulation experiment recipe. There are four main components/classes and verbs in the simulation experiment:</p>
<ol style="list-style-type: decimal">
<li>
<strong>DGP</strong> (data-generating process): the data-generating processes from which to <strong>generate</strong> data</li>
<li>
<strong>Method</strong>: the methods (or models) to <strong>fit</strong> in the experiment</li>
<li>
<strong>Evaluator</strong>: the evaluation metrics used to <strong>evaluate</strong> the methods performance</li>
<li>
<strong>Visualizer</strong>: the visualization functions used to <strong>visualize</strong> outputs from the method fits or evaluation results (can be tables, plots, or even R Markdown snippets to display)</li>
</ol>
<p>To create a <code><a href="../reference/DGP.html">DGP()</a></code>, <code><a href="../reference/Method.html">Method()</a></code>, <code><a href="../reference/Evaluator.html">Evaluator()</a></code>, or <code><a href="../reference/Visualizer.html">Visualizer()</a></code>, we can respectively use the <code><a href="../reference/create_dgp.html">create_dgp()</a></code>, <code><a href="../reference/create_method.html">create_method()</a></code>, <code><a href="../reference/create_evaluator.html">create_evaluator()</a></code>, or <code><a href="../reference/create_visualizer.html">create_visualizer()</a></code> functions. Each <code>create_*()</code> function follows the same syntax and takes in the inputs:</p>
<ul>
<li>
<code>.*_fun</code>: the first input is a function from which to simulate data, fit the method, evaluate the metrics, or create a visualization (depending on <code>*</code>).</li>
<li>
<code>.name</code>: (optional) name of the component. Can be specified either here in <code>create_*()</code> or when creating the experiment as we will see later.</li>
<li>
<code>...</code>: additional arguments get passed into the <code>*_fun</code> above.</li>
</ul>
<div class="section level4">
<h4 id="create-data-generating-process-dgp">Create data-generating process (DGP)<a class="anchor" aria-label="anchor" href="#create-data-generating-process-dgp"></a>
</h4>
<p>As a toy DGP example, let us create a function to simulate a random Gaussian data matrix <span class="math inline">\(\mathbf{X}\)</span> of size <span class="math inline">\(n \times 2\)</span> and a linear response vector <span class="math inline">\(\mathbf{y}\)</span> of size <span class="math inline">\(n \times 1\)</span>, where</p>
<p><span class="math display">\[\begin{gather*}
\mathbf{X} \sim N\left(\mathbf{0}, \begin{pmatrix} 1 &amp; \rho \\ \rho &amp; 1 \end{pmatrix}\right), \\
\mathbf{y} = \mathbf{X} \boldsymbol{\beta} + \boldsymbol{\epsilon},\\
\boldsymbol{\epsilon} \sim N(\mathbf{0}, \sigma^2 \mathbf{I}_n)
\end{gather*}\]</span></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dgp_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">beta</span>, <span class="va">rho</span>, <span class="va">sigma</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">cov_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">rho</span>, <span class="va">rho</span>, <span class="fl">1</span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">T</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="va">cov_mat</span><span class="op">)</span>
  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>We can create an object of class <code><a href="../reference/DGP.html">DGP()</a></code> from this function via</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dgp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dgp.html">create_dgp</a></span><span class="op">(</span>.dgp_fun <span class="op">=</span> <span class="va">dgp_fun</span>, .name <span class="op">=</span> <span class="st">"Linear Gaussian DGP"</span>,
                  <span class="co"># additional named parameters to pass to dgp_fun()</span>
                  n <span class="op">=</span> <span class="fl">200</span>, beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, rho <span class="op">=</span> <span class="fl">0</span>, sigma <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>Note that the additional arguments in <code><a href="../reference/create_dgp.html">create_dgp()</a></code> must be named arguments that match those in <code>dgp_fun()</code>.</p>
</div>
<div class="section level4">
<h4 id="create-method">Create method<a class="anchor" aria-label="anchor" href="#create-method"></a>
</h4>
<p>Given the above DGP, suppose we want to investigate the performance of linear regression, specifically the p-values that are outputted for the non-intercept coefficients from <code><a href="https://rdrr.io/r/stats/summary.lm.html" class="external-link">summary.lm()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, <span class="va">cols</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1"</span>, <span class="st">"X2"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">lm_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">X</span><span class="op">)</span>
  <span class="va">pvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lm_fit</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="va">cols</span>, <span class="st">"Pr(&gt;|t|)"</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="st">"p-value"</span><span class="op">)</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">pvals</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>We can create an object of class <code><a href="../reference/Method.html">Method()</a></code> from this function via</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_method.html">create_method</a></span><span class="op">(</span>.method_fun <span class="op">=</span> <span class="va">lm_fun</span><span class="op">)</span></code></pre></div>
<p>A couple notes here:</p>
<ul>
<li>The inputs into the method function <code>lm_fun()</code> should include the named outputs from the DGP function <code>dgp_fun()</code> (in this case, <code>X</code> and <code>y</code>), as the data generated from the DGP will be automatically passed into the Method.</li>
<li>Additional arguments can be passed into <code><a href="../reference/create_method.html">create_method()</a></code> as was done previously in <code><a href="../reference/create_dgp.html">create_dgp()</a></code>. However, this is not necessary in this case if we are happy with the default argument for <code>cols</code> in <code>lm_fun()</code>.</li>
</ul>
</div>
<div class="section level4">
<h4 id="create-evaluator">Create evaluator<a class="anchor" aria-label="anchor" href="#create-evaluator"></a>
</h4>
<p>To evaluate the performance of linear regression, one metric (or statistic) of interest could be the rejection probability at some level <span class="math inline">\(\alpha\)</span>, which we compute in the following function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reject_prob_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fit_results</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">group_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">".dgp_name"</span>, <span class="st">".method_name"</span><span class="op">)</span>
  <span class="va">eval_out</span> <span class="op">&lt;-</span> <span class="va">fit_results</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span><span class="va">group_vars</span><span class="op">}</span><span class="op">}</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>
      `X1 Reject Prob.` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">`X1 p-value`</span> <span class="op">&lt;</span> <span class="va">alpha</span><span class="op">)</span>,
      `X2 Reject Prob.` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">`X2 p-value`</span> <span class="op">&lt;</span> <span class="va">alpha</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">eval_out</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>We can create an object of class <code><a href="../reference/Evaluator.html">Evaluator()</a></code> from this function via</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reject_prob_eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_evaluator.html">create_evaluator</a></span><span class="op">(</span>.eval_fun <span class="op">=</span> <span class="va">reject_prob_fun</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></code></pre></div>
<p>There are a few key points to keep in mind when writing a custom Evaluator function such as <code>reject_prob_fun()</code>.</p>
<ul>
<li>First, the Evaluator function should almost always take in the named argument <code>fit_results</code>. <code>fit_results</code> is a placeholder for the tibble that will be outputted by <code>Experiment$fit()</code> and automatically passed in when the experiment is fitted. Note that this argument must be exactly named <code>fit_results</code> or else the Evaluator function will not receive the results from <code>Experiment$fit()</code>. We will see <code>Experiment$fit()</code> in action later, but for now, we can think of <code>fit_results</code> as a tibble containing the results of all (replicate, DGP, method) combinations fitted in the experiment. Naturally, <code>fit_results</code> will have columns named <code>.rep</code>, <code>.dgp_name</code>, <code>.method_name</code>, and any other named arguments that were outputted from the method function (i.e., <code>lm_fun</code>).</li>
<li>Many evaluation metrics are most naturally computed across replicates, so it is common to group the <code>fit_results</code> by <code>.dgp_name</code> and <code>.method_name</code> as seen in <code>reject_prob_fun()</code> above. In doing so, the rejection probability (across replicates) will be computed for each (DGP, Method) combination separately. However, depending on the goal of the Evaluator function, grouping by <code>.dgp_name</code> and <code>.method_name</code> might not be necessary.</li>
</ul>
<p>As before, additional arguments can be passed into <code><a href="../reference/create_evaluator.html">create_evaluator()</a></code>, and in this case, we have overwritten the default value of <code>alpha</code> with <code>alpha = 0.1</code>.</p>
</div>
<div class="section level4">
<h4 id="create-visualizer">Create visualizer<a class="anchor" aria-label="anchor" href="#create-visualizer"></a>
</h4>
<p>Lastly, we may want to plot the results from the <code>Method</code> fits (stored in <code>fit_results</code>) and/or the outputs from our <code>Evaluators</code> (stored in <code>eval_results</code>). For example, we could plot the power of the hypothesis test.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">power_plot_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fit_results</span>, <span class="va">col</span> <span class="op">=</span> <span class="st">"X1"</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fit_results</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">col</span>, <span class="st">"p-value"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>,
                 color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">.method_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span>, 
                         color <span class="op">=</span> <span class="st">"darkgray"</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ecdf.html" class="external-link">stat_ecdf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"t"</span>, y <span class="op">=</span> <span class="st">"P( p-value \u2264 t )"</span>, 
                  linetype <span class="op">=</span> <span class="st">""</span>, color <span class="op">=</span> <span class="st">"Method"</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">plt</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>We can create an object of class <code><a href="../reference/Visualizer.html">Visualizer()</a></code> from this function via</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">power_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_visualizer.html">create_visualizer</a></span><span class="op">(</span>.viz_fun <span class="op">=</span> <span class="va">power_plot_fun</span><span class="op">)</span></code></pre></div>
<p>Like the custom <code>Evaluator</code> functions, custom <code>Visualizer</code> functions such as <code>power_plot_fun()</code> can take in the argument <code>fit_results</code> if we want to construct a plot from the method fit outputs. If we want to construct a visualization using the output of our <code>Evaluators</code> (e.g., the output from <code>reject_prob_fun()</code>), the <code>Visualizer</code> function can also take the argument <code>eval_results</code> as input. Note again that the arguments must be exactly named <code>fit_results</code> and <code>eval_results</code> in order to work properly. Beyond creating plots, <code>Visualizers</code> can return tables and more generally, any R Markdown snippet containing results.</p>
<p>As with the other <code>create_*</code> functions, additional arguments that need to pass into the custom <code>Visualizer</code> function can be passed into <code><a href="../reference/create_visualizer.html">create_visualizer()</a></code>.</p>
</div>
</div>
<div class="section level3">
<h3 id="assemble-simulation-experiment-recipe">Assemble simulation experiment recipe<a class="anchor" aria-label="anchor" href="#assemble-simulation-experiment-recipe"></a>
</h3>
<p>At this point, we have created a <code>DGP</code> (<code>dgp</code>), <code>Method</code> (<code>lm_method</code>), <code>Evaluator</code> (<code>reject_prob_eval</code>), and <code>Visualizer</code> (<code>power_plot</code>). The next step is to create the simulation experiment recipe and <code>add</code> each component to the recipe via</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_experiment.html">create_experiment</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Linear Regression Experiment"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/add_funs.html">add_dgp</a></span><span class="op">(</span><span class="va">dgp</span>, name <span class="op">=</span> <span class="st">"Linear Gaussian DGP"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/add_funs.html">add_method</a></span><span class="op">(</span><span class="va">lm_method</span>, name <span class="op">=</span> <span class="st">"OLS"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/add_funs.html">add_evaluator</a></span><span class="op">(</span><span class="va">reject_prob_eval</span>, name <span class="op">=</span> <span class="st">"Rejection Prob. (alpha = 0.1)"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/add_funs.html">add_visualizer</a></span><span class="op">(</span><span class="va">power_plot</span>, name <span class="op">=</span> <span class="st">"Power"</span><span class="op">)</span></code></pre></div>
<p>Any number of DGPs, Methods, Evaluators, and Visualizers can be added to the simulation experiment recipe, but each added element to the experiment should have an intelligible name as this will be used in creating the R Markdown results report.</p>
<p>We can easily see the individual parts of the simulation experiment recipe by printing the experiment.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span>
<span class="co">#&gt; Experiment Name: Linear Regression Experiment </span>
<span class="co">#&gt;    Saved results at: results/Linear Regression Experiment </span>
<span class="co">#&gt;    DGPs: Linear Gaussian DGP </span>
<span class="co">#&gt;    Methods: OLS </span>
<span class="co">#&gt;    Evaluators: Rejection Prob. (alpha = 0.1) </span>
<span class="co">#&gt;    Visualizers: Power </span>
<span class="co">#&gt;    Vary Across: None</span></code></pre></div>
<p>Once a DGP, Method, Evaluator, or Visualizer has been added to the simulation experiment recipe, the component can be updated using <code><a href="../reference/update_funs.html">update_dgp()</a></code>, <code><a href="../reference/update_funs.html">update_method()</a></code>, <code><a href="../reference/update_funs.html">update_evaluator()</a></code>, or <code><a href="../reference/update_funs.html">update_visualizer()</a></code> and removed using <code><a href="../reference/remove_funs.html">remove_dgp()</a></code>, <code><a href="../reference/remove_funs.html">remove_method()</a></code>, <code><a href="../reference/remove_funs.html">remove_evaluator()</a></code>, or <code><a href="../reference/remove_funs.html">remove_visualizer()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="document-the-simulation-experiment">Document the simulation experiment<a class="anchor" aria-label="anchor" href="#document-the-simulation-experiment"></a>
</h3>
<p>A crucial component when running veridical simulations is <strong>documentation</strong>. We highly encourage practitioners to document the purpose or objective of the simulation experiment, what DGPs, Methods, Evaluators, and Visualizers were used, and why these DGPs, Methods, Evaluators, and Visualizers were chosen. This can and should be done before even running the simulation experiment. To facilitate this tedious but important process, we can easily create a documentation template to fill out using</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/create_doc_template.html">create_doc_template</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></code></pre></div>
<p>This creates a series of blank .md files for the user to fill out with descriptions of the simulation experiment and its recipe components. These blank .md files can be found in the experiment’s root results directory under docs/. To find the experiment’s root results directory, use <code>experiment$get_save_dir()</code>.</p>
</div>
<div class="section level3">
<h3 id="run-the-simulation-experiment">Run the simulation experiment<a class="anchor" aria-label="anchor" href="#run-the-simulation-experiment"></a>
</h3>
<p>Thus far, we have created and documented the simulation experiment recipe, but we have not generated any results from the experiment. That is, we have only given the simulation experiment instructions on what to do. To run the experiment, say over 100 replicates, we can do so via</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span> <span class="op">&lt;-</span> <span class="va">experiment</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">100</span>, save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Fitting Linear Regression Experiment...</span>
<span class="co">#&gt; 100 reps completed (totals: 100/100) | time taken: 0.026027 minutes</span>
<span class="co">#&gt; Saving fit results...</span>
<span class="co">#&gt; Fit results saved | time taken: 0.054359 seconds</span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; Evaluating Linear Regression Experiment...</span>
<span class="co">#&gt; `summarise()` has grouped output by '.dgp_name'. You can override using the `.groups` argument.</span>
<span class="co">#&gt; Evaluation completed | time taken: 0.000387 minutes</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Saving eval results...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Eval results saved | time taken: 0.185464 seconds</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Visualizing Linear Regression Experiment...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Visualization completed | time taken: 0.001911 minutes</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Saving viz results...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Viz results saved | time taken: 0.063054 seconds</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ==============================</span></code></pre></div>
<p>or alternatively,</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span> <span class="op">&lt;-</span> <span class="va">experiment</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">100</span>, save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>The output of <code>experiment$run()</code> is a list of length three:</p>
<ul>
<li>
<code>fit_results</code>: output of <code>Method</code> fits (see <code>experiment$fit()</code>)</li>
<li>
<code>eval_results</code>: output of <code>Evaluators</code> (see <code>experiment$evaluate()</code>)</li>
<li>
<code>viz_results</code>: output of <code>Visualizers</code> (see <code>experiment$visualize()</code>)</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">results</span>, max.level <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; List of 3</span>
<span class="co">#&gt;  $ fit_results : tibble [100 × 5] (S3: tbl_df/tbl/data.frame)</span>
<span class="co">#&gt;  $ eval_results:List of 1</span>
<span class="co">#&gt;   ..$ Rejection Prob. (alpha = 0.1): tibble [1 × 4] (S3: tbl_df/tbl/data.frame)</span>
<span class="co">#&gt;  $ viz_results :List of 1</span>
<span class="co">#&gt;   ..$ Power:List of 9</span>
<span class="co">#&gt;   .. ..- attr(*, "class")= chr [1:2] "gg" "ggplot"</span>
<span class="va">results</span><span class="op">$</span><span class="va">fit_results</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 100 × 5</span></span>
<span class="co">#&gt;    .rep  .dgp_name           .method_name `X1 p-value` `X2 p-value`</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1     Linear Gaussian DGP OLS              4.90<span style="color: #949494;">e</span><span style="color: #BB0000;">-29</span>       0.704 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2     Linear Gaussian DGP OLS              4.28<span style="color: #949494;">e</span><span style="color: #BB0000;">-28</span>       0.713 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 3     Linear Gaussian DGP OLS              1.60<span style="color: #949494;">e</span><span style="color: #BB0000;">-38</span>       0.680 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 4     Linear Gaussian DGP OLS              2.31<span style="color: #949494;">e</span><span style="color: #BB0000;">-29</span>       0.011<span style="text-decoration: underline;">5</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 5     Linear Gaussian DGP OLS              8.08<span style="color: #949494;">e</span><span style="color: #BB0000;">-33</span>       0.127 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 6     Linear Gaussian DGP OLS              8.95<span style="color: #949494;">e</span><span style="color: #BB0000;">-29</span>       0.980 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 7     Linear Gaussian DGP OLS              6.84<span style="color: #949494;">e</span><span style="color: #BB0000;">-33</span>       0.385 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 8     Linear Gaussian DGP OLS              6.60<span style="color: #949494;">e</span><span style="color: #BB0000;">-29</span>       0.116 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 9     Linear Gaussian DGP OLS              4.16<span style="color: #949494;">e</span><span style="color: #BB0000;">-28</span>       0.765 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 10    Linear Gaussian DGP OLS              1.28<span style="color: #949494;">e</span><span style="color: #BB0000;">-21</span>       0.530 </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 90 more rows</span></span>
<span class="va">results</span><span class="op">$</span><span class="va">eval_results</span>
<span class="co">#&gt; $`Rejection Prob. (alpha = 0.1)`</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span>
<span class="co">#&gt;   .dgp_name           .method_name `X1 Reject Prob.` `X2 Reject Prob.`</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Linear Gaussian DGP OLS                          1              0.12</span>
<span class="va">results</span><span class="op">$</span><span class="va">viz_results</span>
<span class="co">#&gt; $Power</span></code></pre></div>
<p><img src="simChef_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>By default, the results are not saved to disk. However, to generate the R Markdown report, we will need to save the results to disk and hence set <code>save = TRUE</code> above.</p>
<p>The experiment can also be run in parallel. For a more detailed walkthrough on how to parallelize the experiment, please see <code><a href="../articles/parallel.html">vignette("parallel")</a></code>.</p>
</div>
<div class="section level3">
<h3 id="visualize-results">Visualize results<a class="anchor" aria-label="anchor" href="#visualize-results"></a>
</h3>
<p>Finally, we can easily visualize all results from the simulation experiment in an html file (generated using R Markdown) or browser.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/create_rmd.html">create_rmd</a></span><span class="op">(</span><span class="va">experiment</span>, open <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; Creating R Markdown report for Linear Regression Experiment...</span></code></pre></div>
<p>The results can be found <a href="linear_regression_base_output.html">here</a>.</p>
<p>Note that if the documentation template has not yet been created for <code>experiment</code> (e.g., via <code>create_doc_template(experiment)</code>), then <code><a href="../reference/create_rmd.html">create_rmd()</a></code> will automatically create the documentation template for the user to fill out. Again, we highly encourage practitioners to document their simulation experiments in the spirit of transparency and reproducibility.</p>
</div>
<div class="section level3">
<h3 id="running-an-experiment-across-varying-parameters-in-the-dgpmethod">Running an experiment across varying parameters in the DGP/Method<a class="anchor" aria-label="anchor" href="#running-an-experiment-across-varying-parameters-in-the-dgpmethod"></a>
</h3>
<p>Now, going slightly beyond the most basic usage of <code>simChef</code>, it is often helpful to understand how a method’s performance is affected as we vary a single parameter in the DGP across different values. For instance, what happens to the power as the amount of noise in the linear model increases?</p>
<p>Using the simple grammar of <code>simChef</code>, we can investigate this question by adding a “vary across” component to the simulation experiment.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="va">experiment</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/vary_across.html">add_vary_across</a></span><span class="op">(</span>.dgp <span class="op">=</span> <span class="st">"Linear Gaussian DGP"</span>, sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span>
<span class="co">#&gt; Experiment Name: Linear Regression Experiment </span>
<span class="co">#&gt;    Saved results at: results/Linear Regression Experiment </span>
<span class="co">#&gt;    DGPs: Linear Gaussian DGP </span>
<span class="co">#&gt;    Methods: OLS </span>
<span class="co">#&gt;    Evaluators: Rejection Prob. (alpha = 0.1) </span>
<span class="co">#&gt;    Visualizers: Power </span>
<span class="co">#&gt;    Vary Across: </span>
<span class="co">#&gt;       DGP: Linear Gaussian DGP </span>
<span class="co">#&gt;          sigma:  num [1:4] 1 2 4 8</span></code></pre></div>
<p>In <code><a href="../reference/vary_across.html">add_vary_across()</a></code>, the <code>dgp</code> argument is the name of the DGP to vary or the DGP object itself. All subsequent arguments should be of the form <code>[param_name] = [param_values]</code>, where <code>param_name</code> is the name of the argument/parameter in the <code>DGP</code> function that will be varied, and <code>param_values</code> is a list or atomic vector of values that <code>param_name</code> will take and vary across while all other arguments are kept constant at their base value (see <code>dgp$dgp_params</code>). Here, we are varying the <code>sigma</code> parameter (i.e., the SD of the additive noise term) over values of 1, 2, 4, and 8 within the Linear Gaussian DGP. (Note: we can also vary across parameters in a <code>Method</code> by inputting the <code>method</code> argument instead of the <code>dgp</code> argument in <code><a href="../reference/vary_across.html">add_vary_across()</a></code>.)</p>
<p>However, when we run the experiment, the results are not quite what we expect. The results are summarized/aggregated across all values of <code>sigma</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vary_results</span> <span class="op">&lt;-</span> <span class="va">experiment</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">100</span>, save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Fitting Linear Regression Experiment...</span>
<span class="co">#&gt; 100 reps completed (totals: 100/100) | time taken: 0.070929 minutes</span>
<span class="co">#&gt; Saving fit results...</span>
<span class="co">#&gt; Fit results saved | time taken: 0.047772 seconds</span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; Evaluating Linear Regression Experiment...</span>
<span class="co">#&gt; Evaluation completed | time taken: 0.000334 minutes</span>
<span class="co">#&gt; Saving eval results...</span>
<span class="co">#&gt; Eval results saved | time taken: 0.037467 seconds</span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; Visualizing Linear Regression Experiment...</span>
<span class="co">#&gt; Visualization completed | time taken: 0.000388 minutes</span>
<span class="co">#&gt; Saving viz results...</span>
<span class="co">#&gt; Viz results saved | time taken: 0.079165 seconds</span>
<span class="co">#&gt; ==============================</span>
<span class="va">vary_results</span><span class="op">$</span><span class="va">eval_results</span>
<span class="co">#&gt; $`Rejection Prob. (alpha = 0.1)`</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span>
<span class="co">#&gt;   .dgp_name           .method_name `X1 Reject Prob.` `X2 Reject Prob.`</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Linear Gaussian DGP OLS                      0.875             0.112</span>
<span class="va">vary_results</span><span class="op">$</span><span class="va">viz_results</span>
<span class="co">#&gt; $Power</span></code></pre></div>
<p><img src="simChef_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<p>To see how different values of <code>sigma</code> affect the experiment results, we need to modify our <code>Evaluator</code> and <code>Visualizer</code> functions. Specifically, in <code>reject_prob_eval</code>, we want to group <code>fit_results</code> by <code>sigma</code> in addition to <code>.dgp_name</code> and <code>.method_name</code>. To do this, we need to add a <code>vary_params</code> argument to our custom <code>Evaluator</code> function. When we run the experiment, <code>vary_params</code> will be auto-filled by a vector of the parameter names that are varied (i.e., those that have been added via <code><a href="../reference/vary_across.html">add_vary_across()</a></code>). In this case, <code>vary_params</code> will be auto-filled by <code>c("sigma")</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reject_prob_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fit_results</span>, <span class="va">vary_params</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">group_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">".dgp_name"</span>, <span class="st">".method_name"</span>, <span class="va">vary_params</span><span class="op">)</span>
  <span class="va">eval_out</span> <span class="op">&lt;-</span> <span class="va">fit_results</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span><span class="va">group_vars</span><span class="op">}</span><span class="op">}</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>
      `X1 Reject Prob.` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">`X1 p-value`</span> <span class="op">&lt;</span> <span class="va">alpha</span><span class="op">)</span>,
      `X2 Reject Prob.` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">`X2 p-value`</span> <span class="op">&lt;</span> <span class="va">alpha</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">eval_out</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">reject_prob_eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_evaluator.html">create_evaluator</a></span><span class="op">(</span>.eval_fun <span class="op">=</span> <span class="va">reject_prob_fun</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></code></pre></div>
<p>Similarly in <code>power_plot_fun</code>, we need to add a <code>vary_params</code> argument to plot the results across different values of <code>sigma</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">power_plot_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fit_results</span>, <span class="va">vary_params</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">col</span> <span class="op">=</span> <span class="st">"X1"</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">vary_params</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># deal with the case when we vary across a parameter that is vector-valued</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">fit_results</span><span class="op">[[</span><span class="va">vary_params</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">fit_results</span><span class="op">[[</span><span class="va">vary_params</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/list_col_to_chr.html">list_col_to_chr</a></span><span class="op">(</span><span class="va">fit_results</span><span class="op">[[</span><span class="va">vary_params</span><span class="op">]</span><span class="op">]</span>,
                                                    name <span class="op">=</span> <span class="va">vary_params</span>,
                                                    verbatim <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">}</span>
  
  <span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fit_results</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">col</span>, <span class="st">"p-value"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>,
                 color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">.method_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span>, 
                         color <span class="op">=</span> <span class="st">"darkgray"</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ecdf.html" class="external-link">stat_ecdf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"t"</span>, y <span class="op">=</span> <span class="st">"P( p-value \u2264 t )"</span>, 
                  linetype <span class="op">=</span> <span class="st">""</span>, color <span class="op">=</span> <span class="st">"Method"</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">vary_params</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">plt</span> <span class="op">&lt;-</span> <span class="va">plt</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.data</span><span class="op">[[</span><span class="va">vary_params</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">plt</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">power_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_visualizer.html">create_visualizer</a></span><span class="op">(</span>.viz_fun <span class="op">=</span> <span class="va">power_plot_fun</span><span class="op">)</span></code></pre></div>
<p>Here, we have also added a pre-processing step to deal with the potential case when we vary across a <em>list</em> of parameter values. This pre-processing step uses a helper function, <code><a href="../reference/list_col_to_chr.html">list_col_to_chr()</a></code>, to convert a list-type tibble column to a character-type tibble column that is amenable for plotting (unlike the list-type column).</p>
<p>Now, we are ready to update our experiment and run the experiment via</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vary_results</span> <span class="op">&lt;-</span> <span class="va">experiment</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/update_funs.html">update_evaluator</a></span><span class="op">(</span><span class="va">reject_prob_eval</span>, name <span class="op">=</span> <span class="st">"Rejection Prob. (alpha = 0.1)"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/update_funs.html">update_visualizer</a></span><span class="op">(</span><span class="va">power_plot</span>, name <span class="op">=</span> <span class="st">"Power"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">100</span>, save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Fitting Linear Regression Experiment...</span>
<span class="co">#&gt; 100 reps completed (totals: 100/100) | time taken: 0.072855 minutes</span>
<span class="co">#&gt; Saving fit results...</span>
<span class="co">#&gt; Fit results saved | time taken: 0.063524 seconds</span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; Evaluating Linear Regression Experiment...</span>
<span class="co">#&gt; Evaluation completed | time taken: 0.000229 minutes</span>
<span class="co">#&gt; Saving eval results...</span>
<span class="co">#&gt; Eval results saved | time taken: 0.047416 seconds</span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; Visualizing Linear Regression Experiment...</span>
<span class="co">#&gt; Visualization completed | time taken: 0.000447 minutes</span>
<span class="co">#&gt; Saving viz results...</span>
<span class="co">#&gt; Viz results saved | time taken: 0.094637 seconds</span>
<span class="co">#&gt; ==============================</span>
<span class="va">vary_results</span><span class="op">$</span><span class="va">eval_results</span>
<span class="co">#&gt; $`Rejection Prob. (alpha = 0.1)`</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 5</span></span>
<span class="co">#&gt;   .dgp_name           .method_name sigma `X1 Reject Prob.` `X2 Reject Prob.`</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Linear Gaussian DGP OLS              1              1                 0.08</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Linear Gaussian DGP OLS              2              1                 0.12</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Linear Gaussian DGP OLS              4              0.98              0.08</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Linear Gaussian DGP OLS              8              0.58              0.11</span>
<span class="va">vary_results</span><span class="op">$</span><span class="va">viz_results</span>
<span class="co">#&gt; $Power</span></code></pre></div>
<p><img src="simChef_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
<p>Note here we need to use <code>update_*</code> instead of <code>add_*</code> since an <code>Evaluator</code> named “Rejection Prob. (alpha = 0.1)” and a <code>Visualizer</code> named “Power” already exist in the <code>Experiment</code>. Using <code>add_*</code> will throw an error.</p>
<p>For fun, let’s add another plot (in fact, an interactive plot using <code><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html" class="external-link">plotly::ggplotly</a></code>) to our <code>Experiment</code> and run the <code>Experiment</code> across various values of the coefficient <span class="math inline">\(\boldsymbol{\beta}_2\)</span> and the correlation <span class="math inline">\(\rho\)</span> between features in <span class="math inline">\(\mathbf{X}\)</span>. (Note: the visualizer function below (<code>reject_prob_plot_fun</code>) takes in the <code>Evaluator</code> results, stored as <code>eval_results</code>, and plots the rejection probability for the <span class="math inline">\(\boldsymbol{\beta}_1\)</span> at <span class="math inline">\(\alpha = 0.1\)</span>.)</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create rejection probability plot</span>
<span class="va">reject_prob_plot_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">eval_results</span>, <span class="va">vary_params</span> <span class="op">=</span> <span class="cn">NULL</span>, 
                                 <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">eval_results</span> <span class="op">&lt;-</span> <span class="va">eval_results</span><span class="op">$</span><span class="va">`Rejection Prob. (alpha = 0.1)`</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">eval_results</span><span class="op">[[</span><span class="va">vary_params</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># deal with the case when we vary across a parameter that is vector-valued</span>
    <span class="va">eval_results</span><span class="op">[[</span><span class="va">vary_params</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/list_col_to_chr.html">list_col_to_chr</a></span><span class="op">(</span><span class="va">eval_results</span><span class="op">[[</span><span class="va">vary_params</span><span class="op">]</span><span class="op">]</span>,
                                                   name <span class="op">=</span> <span class="va">vary_params</span>,
                                                   verbatim <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">eval_results</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="va">vary_params</span><span class="op">]</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">`X1 Reject Prob.`</span>, 
                 color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">.method_name</span><span class="op">)</span>, 
                 fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">.method_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">vary_params</span>, 
                  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Rejection Probability (alpha = %s)"</span>, <span class="va">alpha</span><span class="op">)</span>,
                  color <span class="op">=</span> <span class="st">"Method"</span>, fill <span class="op">=</span> <span class="st">"Method"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">eval_results</span><span class="op">[[</span><span class="va">vary_params</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">plt</span> <span class="op">&lt;-</span> <span class="va">plt</span> <span class="op">+</span>
      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="va">plt</span> <span class="op">&lt;-</span> <span class="va">plt</span> <span class="op">+</span>
      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">plotly</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html" class="external-link">ggplotly</a></span><span class="op">(</span><span class="va">plt</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">reject_prob_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_visualizer.html">create_visualizer</a></span><span class="op">(</span>.viz_fun <span class="op">=</span> <span class="va">reject_prob_plot_fun</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>

<span class="va">experiment</span> <span class="op">&lt;-</span> <span class="va">experiment</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/add_funs.html">add_visualizer</a></span><span class="op">(</span><span class="va">reject_prob_plot</span>, name <span class="op">=</span> <span class="st">"Rejection Prob. (alpha = 0.1) Plot"</span><span class="op">)</span>

<span class="co"># run experiment across values of beta_2</span>
<span class="va">vary_beta2_results</span> <span class="op">&lt;-</span> <span class="va">experiment</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/vary_across.html">remove_vary_across</a></span><span class="op">(</span>dgp <span class="op">=</span> <span class="st">"Linear Gaussian DGP"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/vary_across.html">add_vary_across</a></span><span class="op">(</span>.dgp <span class="op">=</span> <span class="st">"Linear Gaussian DGP"</span>,
                  beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,
                              <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span>,
                              <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,
                              <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span><span class="op">)</span>,
                              <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">100</span>, save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Fitting Linear Regression Experiment...</span>
<span class="co">#&gt; 100 reps completed (totals: 100/100) | time taken: 2.824854 minutes</span>
<span class="co">#&gt; Saving fit results...</span>
<span class="co">#&gt; Fit results saved | time taken: 0.055677 seconds</span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; Evaluating Linear Regression Experiment...</span>
<span class="co">#&gt; Evaluation completed | time taken: 0.000404 minutes</span>
<span class="co">#&gt; Saving eval results...</span>
<span class="co">#&gt; Eval results saved | time taken: 0.047258 seconds</span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; Visualizing Linear Regression Experiment...</span>
<span class="co">#&gt; Visualization completed | time taken: 0.003496 minutes</span>
<span class="co">#&gt; Saving viz results...</span>
<span class="co">#&gt; Viz results saved | time taken: 0.143013 seconds</span>
<span class="co">#&gt; ==============================</span>

<span class="co"># run experiment across values of rho (correlation)</span>
<span class="va">vary_cor_results</span> <span class="op">&lt;-</span> <span class="va">experiment</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/vary_across.html">remove_vary_across</a></span><span class="op">(</span>dgp <span class="op">=</span> <span class="st">"Linear Gaussian DGP"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/vary_across.html">add_vary_across</a></span><span class="op">(</span>.dgp <span class="op">=</span> <span class="st">"Linear Gaussian DGP"</span>, 
                  rho <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">100</span>, save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Fitting Linear Regression Experiment...</span>
<span class="co">#&gt; 100 reps completed (totals: 100/100) | time taken: 0.075439 minutes</span>
<span class="co">#&gt; Saving fit results...</span>
<span class="co">#&gt; Fit results saved | time taken: 0.064422 seconds</span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; Evaluating Linear Regression Experiment...</span>
<span class="co">#&gt; Evaluation completed | time taken: 0.000239 minutes</span>
<span class="co">#&gt; Saving eval results...</span>
<span class="co">#&gt; Eval results saved | time taken: 0.054490 seconds</span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; Visualizing Linear Regression Experiment...</span>
<span class="co">#&gt; Visualization completed | time taken: 0.002269 minutes</span>
<span class="co">#&gt; Saving viz results...</span>
<span class="co">#&gt; Viz results saved | time taken: 0.161141 seconds</span>
<span class="co">#&gt; ==============================</span></code></pre></div>
<p>Now when generating the R Markdown report summary for an <code>Experiment</code>, the R Markdown will compile results (both evaluation and visualization results) from all saved <code>Experiments</code> under the root results directory <code>experiment$get_save_dir()</code>. Since the results from the many <code>vary_across</code> runs above are all saved under the original <code>experiment</code>’s results directory, then the following will include all of the above results in a single document.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/create_rmd.html">create_rmd</a></span><span class="op">(</span><span class="va">experiment</span>, open <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; Creating R Markdown report for Linear Regression Experiment...</span>
<span class="co">#&gt; *Linear Gaussian DGP</span>
<span class="co">#&gt; **Varying beta</span>
<span class="co">#&gt;    Rejection Prob. (alpha = 0.1)</span>
<span class="co">#&gt;    Power</span>
<span class="co">#&gt;    Rejection Prob. (alpha = 0.1) Plot</span>
<span class="co">#&gt; **Varying rho</span>
<span class="co">#&gt;    Rejection Prob. (alpha = 0.1)</span>
<span class="co">#&gt;    Power</span>
<span class="co">#&gt;    Rejection Prob. (alpha = 0.1) Plot</span>
<span class="co">#&gt; **Varying sigma</span>
<span class="co">#&gt;    Rejection Prob. (alpha = 0.1)</span>
<span class="co">#&gt;    Power</span></code></pre></div>
<p>Equivalently, we can create the same R Markdown report summary by directly specifying the experiment’s root results directory.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/create_rmd.html">create_rmd</a></span><span class="op">(</span>save_dir <span class="op">=</span> <span class="va">experiment</span><span class="op">$</span><span class="fu">get_save_dir</span><span class="op">(</span><span class="op">)</span>, open <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>The results can be found <a href="linear_regression_output.html">here</a>.</p>
<p>In addition to showing all results under the root results directory, <code><a href="../reference/create_rmd.html">create_rmd()</a></code> will automatically generate a blank documentation template for every <code><a href="../reference/DGP.html">DGP()</a></code>, <code><a href="../reference/Method.html">Method()</a></code>, <code><a href="../reference/Evaluator.html">Evaluator()</a></code>, and <code><a href="../reference/Visualizer.html">Visualizer()</a></code> found in any one of the <code>Experiments</code> under the root results directory. If one would like to generate the documentation template but not create the R Markdown report, see <code><a href="../reference/create_doc_template.html">create_doc_template()</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="simulation-experiment-library">Simulation Experiment Library<a class="anchor" aria-label="anchor" href="#simulation-experiment-library"></a>
</h2>
<p>In addition to the simple grammar and automated report, <code>simChef</code> provides a built-in library of functions to create commonly used DGPs, Evaluators, and Visualizers for simulation experiments. As we have seen thus far, it can be quite tedious to construct functions for generating data, evaluating methods, and visualizing results. <code>simChef</code> aims to lessen this load by providing a starter set of functions that can be used create common DGPs, Evaluators, and Visualizers. The full library of functions can be viewed <a href="https://yu-group.github.io/simChef/reference/index.html#section-simulation-experiment-library" class="external-link">here</a>.</p>
<div class="section level3">
<h3 id="simulation-experiment-templates">Simulation Experiment Templates<a class="anchor" aria-label="anchor" href="#simulation-experiment-templates"></a>
</h3>
<p>We have also provided boilerplate code templates for running common <em>types</em> of simulation experiments, namely, those focused on prediction (regression and classification), feature selection, or inference. These templates provide (1) a quick starting point with Evaluators and Visualizers that are commonly used for the specified type of simulation experiment and (2) a concrete example of how to get started using functions from the <code>simChef</code> library.</p>
<p>Currently, we have implemented the following templates:</p>
<ul>
<li><code>use_prediction_template(type = "regression")</code></li>
<li><code>use_prediction_template(type = "classification")</code></li>
<li><code><a href="../reference/library_templates.html">use_feature_selection_template()</a></code></li>
<li><code><a href="../reference/library_templates.html">use_inference_template()</a></code></li>
</ul>
<p>These functions will print out code to the console that can be easily copied and/or run. For example,</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/library_templates.html">use_prediction_template</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"regression"</span><span class="op">)</span>
<span class="co">#&gt; dgp &lt;- create_dgp(</span>
<span class="co">#&gt;   dgp_fun = stop('Add DGP function here.'),</span>
<span class="co">#&gt;   name = stop('Add name of DGP here.'),</span>
<span class="co">#&gt;   stop('Add additional arguments (if necessary) to pass to DGP here.')</span>
<span class="co">#&gt; ) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; method &lt;- create_method(</span>
<span class="co">#&gt;   method_fun = stop('Add Method function here.'),</span>
<span class="co">#&gt;   name = stop('Add name of Method here.'),</span>
<span class="co">#&gt;   stop('Add additional arguments (if necessary) to pass to Method here.')</span>
<span class="co">#&gt; ) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; nested_pred_data &lt;- stop('(Optional) Add name of column in `fit_results` with prediction result columns to be unnested.')</span>
<span class="co">#&gt; true_pred_col &lt;- stop('Add name of column in `fit_results` with true responses here.')</span>
<span class="co">#&gt; est_pred_col &lt;- stop('Add name of column in `fit_results` with the predicted responses here.')</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; pred_err &lt;- create_evaluator(</span>
<span class="co">#&gt;   eval_fun = summarize_pred_err,</span>
<span class="co">#&gt;   name = 'Prediction Accuracy',</span>
<span class="co">#&gt;   nested_data = nested_pred_data,</span>
<span class="co">#&gt;   truth_col = true_pred_col,</span>
<span class="co">#&gt;   estimate_col = est_pred_col</span>
<span class="co">#&gt; ) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; pred_err_plot &lt;- create_visualizer(</span>
<span class="co">#&gt;   viz_fun = plot_pred_err,</span>
<span class="co">#&gt;   name = 'Prediction Accuracy Plot',</span>
<span class="co">#&gt;   evaluator_name = 'Prediction Accuracy'</span>
<span class="co">#&gt; ) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; experiment &lt;- create_experiment(name = 'Prediction Experiment') %&gt;% </span>
<span class="co">#&gt;   add_dgp(dgp) %&gt;% </span>
<span class="co">#&gt;   add_method(method) %&gt;% </span>
<span class="co">#&gt;   add_evaluator(pred_err) %&gt;% </span>
<span class="co">#&gt;   add_visualizer(pred_err_plot) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; create_doc_template(experiment)  #&gt; fill out documentation before proceeding!</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; results &lt;- run_experiment(</span>
<span class="co">#&gt;   experiment = experiment,</span>
<span class="co">#&gt;   n_reps = stop('Add number of replicates here.'),</span>
<span class="co">#&gt;   save = TRUE</span>
<span class="co">#&gt; ) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; create_rmd(experiment)</span></code></pre></div>
<p>For more guidance, we can also include concrete examples of a DGP and Method via:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/library_templates.html">use_prediction_template</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"regression"</span>,
                        include_dgp_example <span class="op">=</span> <span class="cn">TRUE</span>,
                        include_method_example <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; dgp &lt;- create_dgp(</span>
<span class="co">#&gt;   dgp_fun = xy_dgp_constructor,</span>
<span class="co">#&gt;   name = 'Example DGP (Uncorrelated Gaussian Linear DGP)',</span>
<span class="co">#&gt;   x_fun = generate_X_gaussian,</span>
<span class="co">#&gt;   y_fun = generate_y_linear,</span>
<span class="co">#&gt;   err_fun = rnorm,</span>
<span class="co">#&gt;   n = 200,</span>
<span class="co">#&gt;   p = 10,</span>
<span class="co">#&gt;   betas = c(rep(1, 5), rep(0, 5)),</span>
<span class="co">#&gt;   .err_sd = 1,</span>
<span class="co">#&gt;   data_split = TRUE,</span>
<span class="co">#&gt;   train_prop = 0.5,</span>
<span class="co">#&gt;   return_support = TRUE</span>
<span class="co">#&gt; ) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; rf_method &lt;-function (X, y, Xtest, ytest, support, ...) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     data &lt;- as.data.frame(X) %&gt;% cbind(.y = y)</span>
<span class="co">#&gt;     if (is.factor(y)) {</span>
<span class="co">#&gt;         mtry &lt;- round(sqrt(ncol(X)))</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else {</span>
<span class="co">#&gt;         mtry &lt;- round(ncol(X)/3)</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     fit &lt;- ranger::ranger(data = data, dependent.variable.name = ".y", </span>
<span class="co">#&gt;         importance = "impurity", mtry = mtry, num.threads = 1, </span>
<span class="co">#&gt;         ...)</span>
<span class="co">#&gt;     preds &lt;- stats::predict(fit, as.data.frame(Xtest))$predictions</span>
<span class="co">#&gt;     if (is.factor(y)) {</span>
<span class="co">#&gt;         k &lt;- nlevels(y)</span>
<span class="co">#&gt;         prob_preds &lt;- stats::predict(fit, as.data.frame(Xtest), </span>
<span class="co">#&gt;             predict.all = TRUE, num.threads = 1)$predictions</span>
<span class="co">#&gt;         prob_preds &lt;- purrr::map_dfr(1:nrow(prob_preds), function(i) {</span>
<span class="co">#&gt;             x &lt;- factor(prob_preds[i, ], levels = 1:k)</span>
<span class="co">#&gt;             c(prop.table(table(x)))</span>
<span class="co">#&gt;         }) %&gt;% stats::setNames(levels(y)) %&gt;% dplyr::select(-1)</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else {</span>
<span class="co">#&gt;         prob_preds &lt;- NULL</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     p &lt;- ncol(X)</span>
<span class="co">#&gt;     if (is.null(colnames(X))) {</span>
<span class="co">#&gt;         features &lt;- 1:p</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else {</span>
<span class="co">#&gt;         features &lt;- colnames(X)</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     out &lt;- list(y = y, predictions = preds, prob_predictions = prob_preds, </span>
<span class="co">#&gt;         support_df = data.frame(feature = features, true_support = 1:p %in% </span>
<span class="co">#&gt;             support, imp = fit$variable.importance, selected = fit$variable.importance &gt; </span>
<span class="co">#&gt;             mean(fit$variable.importance)))</span>
<span class="co">#&gt;     return(out)</span>
<span class="co">#&gt; } </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; method &lt;- create_method(</span>
<span class="co">#&gt;   method_fun = rf_method,</span>
<span class="co">#&gt;   name = 'RF'</span>
<span class="co">#&gt; ) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; nested_pred_data &lt;- c('y', 'predictions', 'prob_predictions')  # prediction results columns to be unnested</span>
<span class="co">#&gt; true_pred_col &lt;- 'y'  # true response column</span>
<span class="co">#&gt; est_pred_col &lt;- 'predictions'  # predicted response column</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; pred_err &lt;- create_evaluator(</span>
<span class="co">#&gt;   eval_fun = summarize_pred_err,</span>
<span class="co">#&gt;   name = 'Prediction Accuracy',</span>
<span class="co">#&gt;   nested_data = nested_pred_data,</span>
<span class="co">#&gt;   truth_col = true_pred_col,</span>
<span class="co">#&gt;   estimate_col = est_pred_col</span>
<span class="co">#&gt; ) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; pred_err_plot &lt;- create_visualizer(</span>
<span class="co">#&gt;   viz_fun = plot_pred_err,</span>
<span class="co">#&gt;   name = 'Prediction Accuracy Plot',</span>
<span class="co">#&gt;   evaluator_name = 'Prediction Accuracy'</span>
<span class="co">#&gt; ) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; experiment &lt;- create_experiment(name = 'Prediction Experiment') %&gt;% </span>
<span class="co">#&gt;   add_dgp(dgp) %&gt;% </span>
<span class="co">#&gt;   add_method(method) %&gt;% </span>
<span class="co">#&gt;   add_evaluator(pred_err) %&gt;% </span>
<span class="co">#&gt;   add_visualizer(pred_err_plot) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; create_doc_template(experiment)  #&gt; fill out documentation before proceeding!</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; results &lt;- run_experiment(</span>
<span class="co">#&gt;   experiment = experiment,</span>
<span class="co">#&gt;   n_reps = stop('Add number of replicates here.'),</span>
<span class="co">#&gt;   save = TRUE</span>
<span class="co">#&gt; ) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; create_rmd(experiment)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="developer-functions">Developer Functions<a class="anchor" aria-label="anchor" href="#developer-functions"></a>
</h3>
<p>Given that the <code>simChef</code> simulation library cannot possibly cover all possible simulation scenarios, we have made available a library of developer functions that can assist writing custom DGP, Evaluator, and Visualizer functions. These functions can be found <a href="https://yu-group.github.io/simChef/reference/index.html#section-developer-functions" class="external-link">here</a>. A vignette with concrete examples on how to write custom DGP, Evaluator, and Visualizer functions using this library is in the works. Stay tuned!</p>
</div>
</div>
<div class="section level2">
<h2 id="additional-notes-and-usage">Additional notes and usage<a class="anchor" aria-label="anchor" href="#additional-notes-and-usage"></a>
</h2>
<div class="section level3">
<h3 id="the-experiment-r6-class">The Experiment R6 Class<a class="anchor" aria-label="anchor" href="#the-experiment-r6-class"></a>
</h3>
<p>It is important to note that the <code><a href="../reference/Experiment.html">Experiment()</a></code> class is an <code>R6</code>. With this, we need to be careful about clones versus pointers. In the following, it may look like the <code>vary_experiment</code> object has a <code>vary_across</code> component while the <code>experiment</code> object does not have a <code>vary_across</code> component. However, when <code>experiment</code> is piped into <code><a href="../reference/vary_across.html">add_vary_across()</a></code>, this is in itself modifying <code>experiment</code>, and <code>vary_experiment</code> is simply pointing to this modified <code>experiment</code>.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="va">experiment</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/vary_across.html">remove_vary_across</a></span><span class="op">(</span>dgp <span class="op">=</span> <span class="st">"Linear Gaussian DGP"</span><span class="op">)</span>
<span class="va">experiment</span>
<span class="co">#&gt; Experiment Name: Linear Regression Experiment </span>
<span class="co">#&gt;    Saved results at: results/Linear Regression Experiment </span>
<span class="co">#&gt;    DGPs: Linear Gaussian DGP </span>
<span class="co">#&gt;    Methods: OLS </span>
<span class="co">#&gt;    Evaluators: Rejection Prob. (alpha = 0.1) </span>
<span class="co">#&gt;    Visualizers: Power, Rejection Prob. (alpha = 0.1) Plot </span>
<span class="co">#&gt;    Vary Across: None</span>
<span class="va">vary_experiment</span> <span class="op">&lt;-</span> <span class="va">experiment</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/vary_across.html">add_vary_across</a></span><span class="op">(</span>.dgp <span class="op">=</span> <span class="st">"Linear Gaussian DGP"</span>, sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">vary_experiment</span>, <span class="va">experiment</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/address.html" class="external-link">address</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span> <span class="op">==</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/address.html" class="external-link">address</a></span><span class="op">(</span><span class="va">vary_experiment</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="va">experiment</span>
<span class="co">#&gt; Experiment Name: Linear Regression Experiment </span>
<span class="co">#&gt;    Saved results at: results/Linear Regression Experiment </span>
<span class="co">#&gt;    DGPs: Linear Gaussian DGP </span>
<span class="co">#&gt;    Methods: OLS </span>
<span class="co">#&gt;    Evaluators: Rejection Prob. (alpha = 0.1) </span>
<span class="co">#&gt;    Visualizers: Power, Rejection Prob. (alpha = 0.1) Plot </span>
<span class="co">#&gt;    Vary Across: </span>
<span class="co">#&gt;       DGP: Linear Gaussian DGP </span>
<span class="co">#&gt;          sigma:  num [1:4] 1 2 4 8</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="creating-an-experiment-from-another-experiment">Creating an experiment from another experiment<a class="anchor" aria-label="anchor" href="#creating-an-experiment-from-another-experiment"></a>
</h3>
<p>To modify <code>vary_experiment</code> without making changes to <code>experiment</code>, we need to create <code>vary_experiment</code> as a new experiment by explicitly <em>cloning</em> from the old experiment <code>experiment</code>.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vary_experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_experiment.html">create_experiment</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"I am a clone"</span>,
                                     clone_from <span class="op">=</span> <span class="va">experiment</span><span class="op">)</span>
<span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/address.html" class="external-link">address</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span> <span class="op">==</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/address.html" class="external-link">address</a></span><span class="op">(</span><span class="va">vary_experiment</span><span class="op">)</span>
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vary_experiment</span>
<span class="co">#&gt; Experiment Name: I am a clone </span>
<span class="co">#&gt;    Saved results at: results/Linear Regression Experiment </span>
<span class="co">#&gt;    DGPs: Linear Gaussian DGP </span>
<span class="co">#&gt;    Methods: OLS </span>
<span class="co">#&gt;    Evaluators: Rejection Prob. (alpha = 0.1) </span>
<span class="co">#&gt;    Visualizers: Power, Rejection Prob. (alpha = 0.1) Plot </span>
<span class="co">#&gt;    Vary Across: None</span></code></pre></div>
<p>When creating an <code>Experiment</code> from a clone, we are making a deep clone of the parent experiment’s <code>DGPs</code>, <code>Methods</code>, <code>Evaluators</code>, and <code>Visualizers</code>, but not the <code>vary_across</code> component. We thus need to add a <code>vary_across</code> component to <code>vary_experiment</code> using <code><a href="../reference/vary_across.html">add_vary_across()</a></code>.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># this works without an error</span>
<span class="va">vary_experiment</span> <span class="op">&lt;-</span> <span class="va">vary_experiment</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/vary_across.html">add_vary_across</a></span><span class="op">(</span>.dgp <span class="op">=</span> <span class="st">"Linear Gaussian DGP"</span>, sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We can also add/update DGPs, Methods, Evaluators, and Visualizers to the cloned experiment without modifying the parent <code>experiment</code>.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># add DGP</span>
<span class="va">dgp_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dgp.html">create_dgp</a></span><span class="op">(</span>.dgp_fun <span class="op">=</span> <span class="va">dgp_fun</span>, .name <span class="op">=</span> <span class="st">"Linear Gaussian DGP (large n)"</span>,
                      n <span class="op">=</span> <span class="fl">500</span>, beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, rho <span class="op">=</span> <span class="fl">0</span>, sigma <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">vary_experiment</span> <span class="op">&lt;-</span> <span class="va">vary_experiment</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/add_funs.html">add_dgp</a></span><span class="op">(</span><span class="va">dgp_new</span>, <span class="st">"Linear Gaussian DGP (large n)"</span><span class="op">)</span>
<span class="va">vary_experiment</span>
<span class="co">#&gt; Experiment Name: I am a clone </span>
<span class="co">#&gt;    Saved results at: results/Linear Regression Experiment </span>
<span class="co">#&gt;    DGPs: Linear Gaussian DGP, Linear Gaussian DGP (large n) </span>
<span class="co">#&gt;    Methods: OLS </span>
<span class="co">#&gt;    Evaluators: Rejection Prob. (alpha = 0.1) </span>
<span class="co">#&gt;    Visualizers: Power, Rejection Prob. (alpha = 0.1) Plot </span>
<span class="co">#&gt;    Vary Across: </span>
<span class="co">#&gt;       DGP: Linear Gaussian DGP </span>
<span class="co">#&gt;          sigma:  num [1:4] 1 2 4 8</span>
<span class="va">experiment</span>
<span class="co">#&gt; Experiment Name: Linear Regression Experiment </span>
<span class="co">#&gt;    Saved results at: results/Linear Regression Experiment </span>
<span class="co">#&gt;    DGPs: Linear Gaussian DGP </span>
<span class="co">#&gt;    Methods: OLS </span>
<span class="co">#&gt;    Evaluators: Rejection Prob. (alpha = 0.1) </span>
<span class="co">#&gt;    Visualizers: Power, Rejection Prob. (alpha = 0.1) Plot </span>
<span class="co">#&gt;    Vary Across: </span>
<span class="co">#&gt;       DGP: Linear Gaussian DGP </span>
<span class="co">#&gt;          sigma:  num [1:4] 1 2 4 8</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-cached-results-from-an-experiment">Using cached results from an experiment<a class="anchor" aria-label="anchor" href="#using-cached-results-from-an-experiment"></a>
</h3>
<p>To reduce computation, one may want to avoid re-running previously computed and saved components of an Experiment. This can be done by setting the argument <code>use_cached</code> to <code>TRUE</code> in <code><a href="../reference/run_experiment.html">run_experiment()</a></code>. More specifically, when an Experiment is run with <code>use_cached = TRUE</code>, all previously cached results (i.e., those that have been previously saved to disk with <code>save = TRUE</code>) are loaded in and checked if their corresponding Experiment matches the configurations of the current Experiment. If the cached Experiment configurations indeed match that of the current Experiment, the cached results are used and only the uncached components of the Experiment are run.</p>
<p>As an example, let us run the following experiment and save its results.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">orig_results</span> <span class="op">&lt;-</span> <span class="va">experiment</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">100</span>, save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Fitting Linear Regression Experiment...</span>
<span class="co">#&gt; 100 reps completed (totals: 100/100) | time taken: 0.070077 minutes</span>
<span class="co">#&gt; Saving fit results...</span>
<span class="co">#&gt; Fit results saved | time taken: 0.068280 seconds</span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; Evaluating Linear Regression Experiment...</span>
<span class="co">#&gt; Evaluation completed | time taken: 0.000248 minutes</span>
<span class="co">#&gt; Saving eval results...</span>
<span class="co">#&gt; Eval results saved | time taken: 0.046878 seconds</span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; Visualizing Linear Regression Experiment...</span>
<span class="co">#&gt; Visualization completed | time taken: 0.001669 minutes</span>
<span class="co">#&gt; Saving viz results...</span>
<span class="co">#&gt; Viz results saved | time taken: 0.150631 seconds</span>
<span class="co">#&gt; ==============================</span></code></pre></div>
<p>When setting <code>use_cached = TRUE</code>, the following line of code will not generate any new results but will instead simply read in the saved or cached results from disk.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cached_results</span> <span class="op">&lt;-</span> <span class="va">experiment</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">100</span>, use_cached <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Reading in cached fit results...</span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; Reading in cached eval results...</span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; Reading in cached viz results...</span>
<span class="co">#&gt; ==============================</span>
<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">orig_results</span>, <span class="va">cached_results</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>We can also choose to read in a smaller number of the cached replicates</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">smaller_results</span> <span class="op">&lt;-</span> <span class="va">experiment</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">10</span>, use_cached <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Reading in cached fit results...</span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; Evaluating Linear Regression Experiment...</span>
<span class="co">#&gt; Evaluation completed | time taken: 0.000259 minutes</span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; Visualizing Linear Regression Experiment...</span>
<span class="co">#&gt; Visualization completed | time taken: 0.001848 minutes</span>
<span class="co">#&gt; ==============================</span>
<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">smaller_results</span><span class="op">$</span><span class="va">fit_results</span><span class="op">$</span><span class="va">.rep</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 10</span></code></pre></div>
<p>or increase the number of replicates without re-doing computation for the previously cached replicates</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">larger_results</span> <span class="op">&lt;-</span> <span class="va">experiment</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">150</span>, use_cached <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Reading in cached fit results...</span>
<span class="co">#&gt; Fitting Linear Regression Experiment...</span>
<span class="co">#&gt; 50 reps completed (totals: 150/150) | time taken: 0.036698 minutes</span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; Evaluating Linear Regression Experiment...</span>
<span class="co">#&gt; Evaluation completed | time taken: 0.000224 minutes</span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; Visualizing Linear Regression Experiment...</span>
<span class="co">#&gt; Visualization completed | time taken: 0.001664 minutes</span>
<span class="co">#&gt; ==============================</span>
<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">orig_results</span><span class="op">$</span><span class="va">fit_results</span>,
          <span class="va">larger_results</span><span class="op">$</span><span class="va">fit_results</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">.rep</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>In addition, caching works intuitively when adding or modifying components of an Experiment. In the following, we add a new DGP to the Experiment, so when we run the Experiment with <code>use_cached = TRUE</code>, only the replicates involving the new DGP are run while the replicates involving the old DGP (i.e., the <code>Linear Gaussian DGP</code>) are loaded in from the cache.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="va">experiment</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/add_funs.html">add_dgp</a></span><span class="op">(</span>dgp <span class="op">=</span> <span class="va">dgp_new</span>, name <span class="op">=</span> <span class="st">"New DGP"</span><span class="op">)</span>
<span class="va">new_results</span> <span class="op">&lt;-</span> <span class="va">experiment</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">100</span>, use_cached <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Fitting Linear Regression Experiment...</span>
<span class="co">#&gt; Reading in cached fit results...</span>
<span class="co">#&gt; Appending cached results to the new fit results...</span>
<span class="co">#&gt; 100 reps completed (totals: 100/100) | time taken: 0.020659 minutes</span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; Evaluating Linear Regression Experiment...</span>
<span class="co">#&gt; Evaluation completed | time taken: 0.000228 minutes</span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; Visualizing Linear Regression Experiment...</span>
<span class="co">#&gt; Visualization completed | time taken: 0.001957 minutes</span>
<span class="co">#&gt; ==============================</span>
<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">new_results</span><span class="op">$</span><span class="va">fit_results</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.dgp_name</span> <span class="op">==</span> <span class="st">"Linear Gaussian DGP"</span><span class="op">)</span>,
          <span class="va">orig_results</span><span class="op">$</span><span class="va">fit_results</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>Note that since we did not save the Experiment results above, then the following will re-run the replicates corresponding to the new DGP as above. Please set <code>save = TRUE</code> in order to cache the results for future use.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_results2</span> <span class="op">&lt;-</span> <span class="va">experiment</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">100</span>, use_cached <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Fitting Linear Regression Experiment...</span>
<span class="co">#&gt; Reading in cached fit results...</span>
<span class="co">#&gt; Appending cached results to the new fit results...</span>
<span class="co">#&gt; 100 reps completed (totals: 100/100) | time taken: 0.021379 minutes</span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; Evaluating Linear Regression Experiment...</span>
<span class="co">#&gt; Evaluation completed | time taken: 0.000237 minutes</span>
<span class="co">#&gt; ==============================</span>
<span class="co">#&gt; Visualizing Linear Regression Experiment...</span>
<span class="co">#&gt; Visualization completed | time taken: 0.001815 minutes</span>
<span class="co">#&gt; ==============================</span>
<span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">new_results</span><span class="op">$</span><span class="va">fit_results</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.dgp_name</span> <span class="op">==</span> <span class="st">"New DGP"</span><span class="op">)</span>,
          <span class="va">new_results2</span><span class="op">$</span><span class="va">fit_results</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.dgp_name</span> <span class="op">==</span> <span class="st">"New DGP"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
<p>Some helpful functions regarding caching include:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># to load in the cached fit results for an experiment</span>
<span class="va">fit_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cached_results.html">get_cached_results</a></span><span class="op">(</span><span class="va">experiment</span>, <span class="st">"fit"</span><span class="op">)</span>
<span class="co"># to load in the cached evaluation results for an experiment</span>
<span class="va">eval_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cached_results.html">get_cached_results</a></span><span class="op">(</span><span class="va">experiment</span>, <span class="st">"eval"</span><span class="op">)</span>
<span class="co"># to load in the cached visualization results for an experiment</span>
<span class="va">viz_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cached_results.html">get_cached_results</a></span><span class="op">(</span><span class="va">experiment</span>, <span class="st">"viz"</span><span class="op">)</span>
<span class="co"># to load in the cached Experiment object</span>
<span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cached_results.html">get_cached_results</a></span><span class="op">(</span><span class="va">experiment</span>, <span class="st">"experiment"</span><span class="op">)</span>
<span class="co"># to load in the Experiment parameters corresponding to the cached *_results</span>
<span class="va">cached_exp_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cached_results.html">get_cached_results</a></span><span class="op">(</span><span class="va">experiment</span>, <span class="st">"experiment_cached_params"</span><span class="op">)</span>

<span class="co"># to clear the cache</span>
<span class="fu"><a href="../reference/clear_cache.html">clear_cache</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-checkpoints-within-an-experiment">Using checkpoints within an experiment<a class="anchor" aria-label="anchor" href="#using-checkpoints-within-an-experiment"></a>
</h3>
<p>A checkpoint is a periodic snapshot of the simulation results, saved to disk. Checkpoints help guard against lost progress in the case of unexpected problems, such as node failures when running on a cluster, at the cost of longer simulation running times. Checkpoints are most useful for long-running simulations where the cost of creating the checkpoints is small relative to the total cost of the simulation. As a result, users should be careful not to create checkpoints more often than necessary.</p>
<p>To enable checkpointing, use a positive value for the argument <code>checkpoint_n_reps</code> passed to <code>Experiment$run()</code> or <code>Experiment$fit()</code>. Below is an example simulation run in which we use checkpointing and encounter errors as the simulation progresses past the first checkpoint:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create a new experiment</span>
<span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_experiment.html">create_experiment</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"checkpoint-exper"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="va">...</span> <span class="co"># add dgps, methods, etc.</span>

<span class="co"># run 100 reps of the experiment, checkpointing every 25 reps</span>
<span class="va">experiment</span><span class="op">$</span><span class="fu">fit</span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">100</span>, checkpoint_n_reps <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>
<span class="co">#&gt; Fitting checkpoint-exper...</span>
<span class="co">#&gt; 25 reps completed (totals: 25/100) | time taken: 0.060645 minutes</span>
<span class="co">#&gt; Saving fit results checkpoint...</span>
<span class="co">#&gt; Fit results saved | time taken: 0.080968 seconds</span>

<span class="co"># the simulation fails here!</span></code></pre></div>
<p>Since a full 25 replicates completed before the simulation failed, the first checkpoint was successful. You can use <code>get_cached_results(experiment, "fit")</code> to examine the completed replicates, or simply continue the simulation using the same code you already ran:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">experiment</span><span class="op">$</span><span class="fu">fit</span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">100</span>, checkpoint_n_reps <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>
<span class="co">#&gt; Reading in cached fit results...</span>
<span class="co">#&gt; Fitting checkpoint-exper...</span>
<span class="co">#&gt; 25 reps completed (totals: 50/100) | time taken: 0.066513 minutes</span>
<span class="co">#&gt; Saving fit results checkpoint...</span>
<span class="co">#&gt; Fit results saved | time taken: 0.133003 seconds</span>
<span class="co">#&gt; 25 reps completed (totals: 75/100) | time taken: 0.125143 minutes</span>
<span class="co">#&gt; Saving fit results checkpoint...</span>
<span class="co">#&gt; Fit results saved | time taken: 0.107203 seconds</span>
<span class="co">#&gt; 25 reps completed (totals: 100/100) | time taken: 0.184656 minutes</span>
<span class="co">#&gt; Saving fit results...</span>
<span class="co">#&gt; Fit results saved | time taken: 0.124632 seconds</span>
<span class="co">#&gt; ==============================</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="additional-r-markdown-notes-and-options">Additional R Markdown notes and options<a class="anchor" aria-label="anchor" href="#additional-r-markdown-notes-and-options"></a>
</h3>
<p>There are several customizable options regarding the aesthetics of Evaluators and Visualizers displayed in the Rmd report. These can be modified using the <code>rmd_options</code> argument in <code><a href="../reference/create_evaluator.html">create_evaluator()</a></code> and <code><a href="../reference/create_visualizer.html">create_visualizer()</a></code>. For example, we can customize the height and width of the Power plot via</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">power_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_visualizer.html">create_visualizer</a></span><span class="op">(</span>.viz_fun <span class="op">=</span> <span class="va">power_plot_fun</span>, 
                                .rmd_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">10</span>, width <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span>
<span class="va">experiment</span> <span class="op">&lt;-</span> <span class="va">experiment</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/update_funs.html">update_visualizer</a></span><span class="op">(</span><span class="va">power_plot</span>, <span class="st">"Power"</span><span class="op">)</span></code></pre></div>
<p>and the number of digits in the evaluation table outputs via</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">reject_prob_eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_evaluator.html">create_evaluator</a></span><span class="op">(</span>.eval_fun <span class="op">=</span> <span class="va">reject_prob_fun</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>,
                                     .rmd_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="va">experiment</span> <span class="op">&lt;-</span> <span class="va">experiment</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/update_funs.html">update_evaluator</a></span><span class="op">(</span><span class="va">reject_prob_eval</span>, <span class="st">"Rejection Prob. (alpha = 0.1)"</span><span class="op">)</span></code></pre></div>
<p>Alternatively, <code><a href="../reference/set_rmd_options.html">set_rmd_options()</a></code> can be used to update the R Markdown option for an existing object, rather than having to recreate the <code><a href="../reference/Evaluator.html">Evaluator()</a></code> or <code><a href="../reference/Visualizer.html">Visualizer()</a></code> from scratch, e.g.,</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="va">experiment</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/set_rmd_options.html">set_rmd_options</a></span><span class="op">(</span>field_name <span class="op">=</span> <span class="st">"visualizer"</span>, name <span class="op">=</span> <span class="st">"Power"</span>, show <span class="op">=</span> <span class="cn">TRUE</span>,
                  height <span class="op">=</span> <span class="fl">10</span>, width <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></code></pre></div>
<p>To hide the output of an <code><a href="../reference/Evaluator.html">Evaluator()</a></code> or <code><a href="../reference/Visualizer.html">Visualizer()</a></code> in the R Markdown report, set <code>show = FALSE</code> in <code><a href="../reference/set_rmd_options.html">set_rmd_options()</a></code> or <code>create_*</code>.</p>
<p>There are additional customization options that can be set in <code><a href="../reference/create_rmd.html">create_rmd()</a></code> including the order in which results of Evaluators and Visualizers are displayed (via the <code>eval_order</code> and <code>viz_order</code> arguments) and the Rmd output type or theme. For example,</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># use html_document instead of rmdformats::material (default)</span>
<span class="fu"><a href="../reference/create_rmd.html">create_rmd</a></span><span class="op">(</span><span class="va">experiment</span>, open <span class="op">=</span> <span class="cn">FALSE</span>, pretty <span class="op">=</span> <span class="cn">FALSE</span>,
           output_format <span class="op">=</span> <span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/html_document.html" class="external-link">html_document</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="co"># add custom css style</span>
<span class="fu"><a href="../reference/create_rmd.html">create_rmd</a></span><span class="op">(</span><span class="va">experiment</span>, open <span class="op">=</span> <span class="cn">FALSE</span>, pretty <span class="op">=</span> <span class="cn">FALSE</span>,
           output_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>css <span class="op">=</span> <span class="st">"path/to/file.css"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="saving-results">Saving results<a class="anchor" aria-label="anchor" href="#saving-results"></a>
</h3>
<p>Since the R Markdown report heavily relies on the results file structure to organize the report summary, it may be helpful to understand the default saving structure utilized in <code>simChef</code>.</p>
<p>By default, the root results directory is ./results/{EXPERIMENT_NAME}. If the experiment was created by cloning another experiment, then the default results directory is the same as the parent experiment. To change the root results directory, one can specify the desired directory via the <code>save_dir</code> argument in <code><a href="../reference/create_experiment.html">create_experiment()</a></code> or use the <code><a href="../reference/set_save_dir.html">set_save_dir()</a></code> helper function.</p>
<p>All results from <code>experiment$run(..., save = TRUE)</code> without a <code>vary_across</code> component are then saved under the root results directory. If <code>experiment</code> has a <code>vary_across</code> component, then the results of <code>experiment$run(..., save = TRUE)</code> are saved under ./{ROOT_RESULTS_DIR}/{DGP_OR_METHOD_NAME}/Varying {PARAM_NAME}/.</p>
<p>For a concrete example of the saving structure, please refer to <a href="https://github.com/Yu-Group/simChef/tree/main/vignettes/results/Linear%20Regression%20Experiment/" class="external-link">this GitHub directory</a>, where we have stored all saved results from this vignette.</p>
</div>
<div class="section level3">
<h3 id="additional-handling-of-the-experiment">Additional handling of the experiment<a class="anchor" aria-label="anchor" href="#additional-handling-of-the-experiment"></a>
</h3>
<p><code>Experiment$run()</code> is the easiest and most concise way of running the simulation experiment from start to finish. However, when debugging and developing the simulation experiment, it may be helpful to run only parts of the experiment so as to not repeat time-consuming, redundant computations. We split up the experimental run into the following three parts:</p>
<ol style="list-style-type: decimal">
<li>
<code>experiment$fit()</code>: fit the Method(s) in the experiment on multiple replicates of the DGP(s) and return the results from the fits</li>
<li>
<code>experiment$evaluate()</code>: evaluate the experiment through the Evaluator(s) and return the evaluation results</li>
<li>
<code>experiment$visualize()</code>: create visualizations of the fit/evaluation results from the experiment using the Visualizer(s) and return the visualization results</li>
</ol>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_results</span> <span class="op">&lt;-</span> <span class="va">experiment</span><span class="op">$</span><span class="fu">fit</span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>
<span class="co">#&gt; Fitting Linear Regression Experiment...</span>
<span class="co">#&gt; 100 reps completed (totals: 100/100) | time taken: 0.070720 minutes</span>
<span class="co">#&gt; ==============================</span>
<span class="va">eval_results</span> <span class="op">&lt;-</span> <span class="va">experiment</span><span class="op">$</span><span class="fu">evaluate</span><span class="op">(</span><span class="va">fit_results</span><span class="op">)</span>
<span class="co">#&gt; Evaluating Linear Regression Experiment...</span>
<span class="co">#&gt; Evaluation completed | time taken: 0.000226 minutes</span>
<span class="co">#&gt; ==============================</span>
<span class="va">viz_results</span> <span class="op">&lt;-</span> <span class="va">experiment</span><span class="op">$</span><span class="fu">visualize</span><span class="op">(</span><span class="va">fit_results</span>, <span class="va">eval_results</span><span class="op">)</span>
<span class="co">#&gt; Visualizing Linear Regression Experiment...</span>
<span class="co">#&gt; Visualization completed | time taken: 0.001815 minutes</span>
<span class="co">#&gt; ==============================</span></code></pre></div>
<p>or alternatively,</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_experiment.html">fit_experiment</a></span><span class="op">(</span><span class="va">experiment</span>, n_reps <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>
<span class="va">eval_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate_experiment.html">evaluate_experiment</a></span><span class="op">(</span><span class="va">experiment</span>, <span class="va">fit_results</span><span class="op">)</span>
<span class="va">viz_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize_experiment.html">visualize_experiment</a></span><span class="op">(</span><span class="va">experiment</span>, <span class="va">fit_results</span>, <span class="va">eval_results</span><span class="op">)</span></code></pre></div>
<p><code>Experiment$run()</code> is simply a wrapper around these three functions: <code>fit()</code>, <code>evaluate()</code>, and <code>visualize()</code>.</p>
<p>Thus far, we have neither stored nor returned any data from the <code>DGPs</code> since these can be large objects that require high memory loads when <code>n_reps</code> is large. However, one can generate small samples of data from the <code>DGPs</code> in the experiment via</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="va">experiment</span><span class="op">$</span><span class="fu">generate_data</span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span>
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ Linear Gaussian DGP:List of 4</span>
<span class="co">#&gt;   ..$ :List of 1</span>
<span class="co">#&gt;   .. ..$ :List of 2</span>
<span class="co">#&gt;   .. .. ..$ X: num [1:200, 1:2] -0.992 0.859 0.282 -2.066 0.612 ...</span>
<span class="co">#&gt;   .. .. .. ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. .. .. .. ..$ : NULL</span>
<span class="co">#&gt;   .. .. .. .. ..$ : NULL</span>
<span class="co">#&gt;   .. .. ..$ y: num [1:200, 1] -1.963 0.698 1.486 -2 -0.271 ...</span>
<span class="co">#&gt;   .. ..- attr(*, "params")=List of 1</span>
<span class="co">#&gt;   .. .. ..$ sigma: num 1</span>
<span class="co">#&gt;   ..$ :List of 1</span>
<span class="co">#&gt;   .. ..$ :List of 2</span>
<span class="co">#&gt;   .. .. ..$ X: num [1:200, 1:2] 0.741 -0.252 0.337 -0.948 0.66 ...</span>
<span class="co">#&gt;   .. .. .. ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. .. .. .. ..$ : NULL</span>
<span class="co">#&gt;   .. .. .. .. ..$ : NULL</span>
<span class="co">#&gt;   .. .. ..$ y: num [1:200, 1] 0.182 -1.544 -0.694 -3.697 2.681 ...</span>
<span class="co">#&gt;   .. ..- attr(*, "params")=List of 1</span>
<span class="co">#&gt;   .. .. ..$ sigma: num 2</span>
<span class="co">#&gt;   ..$ :List of 1</span>
<span class="co">#&gt;   .. ..$ :List of 2</span>
<span class="co">#&gt;   .. .. ..$ X: num [1:200, 1:2] -1.14 0.459 0.921 0.304 -0.268 ...</span>
<span class="co">#&gt;   .. .. .. ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. .. .. .. ..$ : NULL</span>
<span class="co">#&gt;   .. .. .. .. ..$ : NULL</span>
<span class="co">#&gt;   .. .. ..$ y: num [1:200, 1] -0.62915 4.95518 5.8273 4.42944 0.00406 ...</span>
<span class="co">#&gt;   .. ..- attr(*, "params")=List of 1</span>
<span class="co">#&gt;   .. .. ..$ sigma: num 4</span>
<span class="co">#&gt;   ..$ :List of 1</span>
<span class="co">#&gt;   .. ..$ :List of 2</span>
<span class="co">#&gt;   .. .. ..$ X: num [1:200, 1:2] -0.7129 0.5489 -0.0244 0.4301 0.8951 ...</span>
<span class="co">#&gt;   .. .. .. ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. .. .. .. ..$ : NULL</span>
<span class="co">#&gt;   .. .. .. .. ..$ : NULL</span>
<span class="co">#&gt;   .. .. ..$ y: num [1:200, 1] 8.32 -8.35 -6.84 -5.13 -6.03 ...</span>
<span class="co">#&gt;   .. ..- attr(*, "params")=List of 1</span>
<span class="co">#&gt;   .. .. ..$ sigma: num 8</span></code></pre></div>
<p>or alternatively,</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data.html">generate_data</a></span><span class="op">(</span><span class="va">experiment</span>, n_reps <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>This might be helpful for exploratory data analysis or further diagnosis of the experiment results.</p>
<p>Other helpful methods for handling the experiment include the <code>get_*</code> family of methods, i.e.,</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_funs.html">get_dgps</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span>         <span class="co"># or `experiment$get_dgps()`</span>
<span class="co">#&gt; $`Linear Gaussian DGP`</span>
<span class="co">#&gt; DGP Name: Linear Gaussian DGP </span>
<span class="co">#&gt;    Function: function (n, beta, rho, sigma)  </span>
<span class="co">#&gt;    Parameters: List of 4</span>
<span class="co">#&gt;      $ n    : num 200</span>
<span class="co">#&gt;      $ beta : num [1:2] 1 0</span>
<span class="co">#&gt;      $ rho  : num 0</span>
<span class="co">#&gt;      $ sigma: num 1</span>
<span class="fu"><a href="../reference/get_funs.html">get_methods</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span>      <span class="co"># or `experiment$get_methods()`</span>
<span class="co">#&gt; $OLS</span>
<span class="co">#&gt; Method Name: NULL </span>
<span class="co">#&gt;    Function: function (X, y, cols = c("X1", "X2"))  </span>
<span class="co">#&gt;    Parameters:  list()</span>
<span class="fu"><a href="../reference/get_funs.html">get_evaluators</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span>   <span class="co"># or `experiment$get_evaluators()`</span>
<span class="co">#&gt; $`Rejection Prob. (alpha = 0.1)`</span>
<span class="co">#&gt; Evaluator Name: NULL </span>
<span class="co">#&gt;    Function: function (fit_results, vary_params = NULL, alpha = 0.05)  </span>
<span class="co">#&gt;    Parameters: List of 1</span>
<span class="co">#&gt;      $ alpha: num 0.1</span>
<span class="co">#&gt;    R Markdown Options: List of 3</span>
<span class="co">#&gt;      $ digits : num 3</span>
<span class="co">#&gt;      $ sigfig : logi FALSE</span>
<span class="co">#&gt;      $ options:List of 2</span>
<span class="co">#&gt;       ..$ scrollX       : logi TRUE</span>
<span class="co">#&gt;       ..$ scrollCollapse: logi TRUE</span>
<span class="co">#&gt;    Show in R Markdown: TRUE</span>
<span class="fu"><a href="../reference/get_funs.html">get_visualizers</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span>  <span class="co"># or `experiment$get_visualizers()`</span>
<span class="co">#&gt; $Power</span>
<span class="co">#&gt; Visualizer Name: NULL </span>
<span class="co">#&gt;    Function: function (fit_results, vary_params = NULL, col = "X1")  </span>
<span class="co">#&gt;    Parameters:  list()</span>
<span class="co">#&gt;    R Markdown Options: List of 2</span>
<span class="co">#&gt;      $ height: num 10</span>
<span class="co">#&gt;      $ width : num 8</span>
<span class="co">#&gt;    Show in R Markdown: TRUE</span>
<span class="co">#&gt; $`Rejection Prob. (alpha = 0.1) Plot`</span>
<span class="co">#&gt; Visualizer Name: NULL </span>
<span class="co">#&gt;    Function: function (eval_results, vary_params = NULL, alpha = 0.05)  </span>
<span class="co">#&gt;    Parameters: List of 1</span>
<span class="co">#&gt;      $ alpha: num 0.1</span>
<span class="co">#&gt;    R Markdown Options: List of 2</span>
<span class="co">#&gt;      $ height: num 6</span>
<span class="co">#&gt;      $ width : num 10</span>
<span class="co">#&gt;    Show in R Markdown: TRUE</span>
<span class="fu"><a href="../reference/vary_across.html">get_vary_across</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span>  <span class="co"># or `experiment$get_vary_across()`</span>
<span class="co">#&gt; $dgp</span>
<span class="co">#&gt; $dgp$`Linear Gaussian DGP`</span>
<span class="co">#&gt; $dgp$`Linear Gaussian DGP`$sigma</span>
<span class="co">#&gt; [1] 1 2 4 8</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $method</span>
<span class="co">#&gt; list()</span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_save_dir.html">get_save_dir</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span>     <span class="co"># or `experiment$get_save_dir()`</span>
<span class="co">#&gt; [1] "./results/Linear Regression Experiment"</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="error-debugging">Error debugging<a class="anchor" aria-label="anchor" href="#error-debugging"></a>
</h3>
<p>In the event of an error, <code>simChef</code> makes it possible to both retrieve results from completed replicates (before the error occurred) and to gracefully debug errors in user-defined functions. For the sake of demonstration, let us create an artificial example.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create experiment</span>
<span class="va">dgp_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span>
<span class="va">dgp_fun_err</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Uh oh!"</span><span class="op">)</span> <span class="op">}</span>
<span class="va">dgp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dgp.html">create_dgp</a></span><span class="op">(</span><span class="va">dgp_fun</span><span class="op">)</span>
<span class="va">dgp_err</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dgp.html">create_dgp</a></span><span class="op">(</span><span class="va">dgp_fun_err</span><span class="op">)</span>
<span class="va">method_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"result"</span><span class="op">)</span>
<span class="va">method</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_method.html">create_method</a></span><span class="op">(</span><span class="va">method_fun</span><span class="op">)</span>
<span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_experiment.html">create_experiment</a></span><span class="op">(</span>
  dgp_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Working DGP"</span> <span class="op">=</span> <span class="va">dgp</span>, <span class="st">"Buggy DGP"</span> <span class="op">=</span> <span class="va">dgp_err</span><span class="op">)</span>,
  method_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Method"</span> <span class="op">=</span> <span class="va">method</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># run experiment though it should return an error</span>
<span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span><span class="va">experiment</span>, n_reps <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; Fitting experiment...</span>
<span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;">:</span></span>
<span class="co">#&gt; <span style="color: #BBBB00;">!</span> Error(s) encountered while running the simulation, including:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Uh oh!</span>
<span class="co">#&gt; The above error occurred while processing "Buggy DGP" (params empty).</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Use `rlang::last_error()$partial_results` to return partial results.</span></code></pre></div>
<p>If working interactively, the error can be inspected using the usual call to <code><a href="https://rlang.r-lib.org/reference/last_error.html" class="external-link">rlang::last_error()</a></code>, and results that were run and completed before the error can be inspected via <code>rlang::last_error()$partial_results</code>.</p>
<p>Alternatively, we can wrap the call that ran the error (in this case, <code><a href="../reference/run_experiment.html">run_experiment()</a></code>) in <code><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch()</a></code> as follows:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span><span class="va">experiment</span>, n_reps <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,
                    error <span class="op">=</span> <span class="va">identity</span><span class="op">)</span>
<span class="co">#&gt; Fitting experiment...</span>
<span class="va">results</span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">&lt;error/simChefError&gt;</span></span>
<span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;">:</span></span>
<span class="co">#&gt; <span style="color: #BBBB00;">!</span> Error(s) encountered while running the simulation, including:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Uh oh!</span>
<span class="co">#&gt; The above error occurred while processing "Buggy DGP" (params empty).</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Use `rlang::last_error()$partial_results` to return partial results.</span>
<span class="co">#&gt; <span style="font-weight: bold;">Backtrace:</span></span>
<span class="co">#&gt; <span style="color: #555555;"> 1. </span><span style="font-weight: bold;">base</span>::tryCatch(run_experiment(experiment, n_reps = 2), error = identity)</span>
<span class="co">#&gt; <span style="color: #555555;"> 5. </span><span style="font-weight: bold;">simChef</span>::run_experiment(experiment, n_reps = 2)</span>
<span class="co">#&gt; <span style="color: #555555;"> 6. </span>experiment$run(...)</span>
<span class="co">#&gt; <span style="color: #555555;"> 7. </span>self$fit(...)</span></code></pre></div>
<p>From this, we can view the results that were completed before we ran into the error via</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span><span class="op">$</span><span class="va">partial_results</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span>
<span class="co">#&gt;    .rep .dgp_name   .method_name result1 .err      </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 Working DGP Method       result  <span style="color: #949494;">&lt;NULL&gt;</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1 <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>      <span style="color: #949494;">&lt;smChfErr&gt;</span></span></code></pre></div>
<p>and extract the error object(s) via</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># find index where error occurred</span>
<span class="va">err_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">partial_results</span><span class="op">$</span><span class="va">.err</span>, <span class="va">is.null</span><span class="op">)</span><span class="op">)</span>
<span class="co"># extract the error object</span>
<span class="va">err</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">partial_results</span><span class="op">$</span><span class="va">.err</span><span class="op">[[</span><span class="va">err_idx</span><span class="op">]</span><span class="op">]</span>
<span class="va">err</span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">&lt;error/simChefError&gt;</span></span>
<span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in </span><span style="color: #262626; background-color: #DADADA; font-weight: bold;">`do_call_handler()`</span><span style="font-weight: bold;">:</span></span>
<span class="co">#&gt; <span style="color: #BBBB00;">!</span> Uh oh!</span>
<span class="co">#&gt; The above error occurred while processing "Buggy DGP" (params empty).</span>
<span class="co">#&gt; <span style="font-weight: bold;">Caused by error:</span></span>
<span class="co">#&gt; <span style="color: #BBBB00;">!</span> Uh oh!</span>
<span class="co">#&gt; <span style="font-weight: bold;">Backtrace:</span></span>
<span class="co">#&gt; <span style="color: #555555;">  1. </span><span style="font-weight: bold;">base</span>::tryCatch(run_experiment(experiment, n_reps = 2), error = identity)</span>
<span class="co">#&gt; <span style="color: #555555;">  5. </span><span style="font-weight: bold;">simChef</span>::run_experiment(experiment, n_reps = 2)</span>
<span class="co">#&gt; <span style="color: #555555;">  6. </span>experiment$run(...)</span>
<span class="co">#&gt; <span style="color: #555555;">  7. </span>self$fit(...)</span>
<span class="co">#&gt; <span style="color: #555555;"> 14. </span>future.apply::future_replicate(...)</span>
<span class="co">#&gt; <span style="color: #555555;"> 15. </span>future.apply::future_sapply(...)</span>
<span class="co">#&gt; <span style="color: #555555;"> 16. </span>future.apply::future_lapply(...)</span>
<span class="co">#&gt; <span style="color: #555555;"> 17. </span>future.apply:::future_xapply(...)</span>
<span class="co">#&gt; <span style="color: #555555;"> 18. </span><span style="font-weight: bold;">future</span>::future(...)</span>
<span class="co">#&gt; <span style="color: #555555;"> 20. </span>future:::run.Future(future)</span>
<span class="co">#&gt; <span style="color: #555555;"> 22. </span>future:::run.UniprocessFuture(future)</span>
<span class="co">#&gt; <span style="color: #555555;"> 23. </span>[ base::eval(...) ]<span style="color: #555555;"> with 1 more call</span></span>
<span class="co">#&gt; <span style="color: #555555;"> 35. </span>[ base::eval(...) ]<span style="color: #555555;"> with 1 more call</span></span>
<span class="co">#&gt; <span style="color: #555555;"> 38. </span><span style="font-weight: bold;">simChef</span> `&lt;fn&gt;`()</span>
<span class="co">#&gt; <span style="color: #555555;"> 39. </span><span style="font-weight: bold;">base</span>::lapply(...)</span>
<span class="co">#&gt; <span style="color: #555555;"> 40. </span><span style="font-weight: bold;">simChef</span> FUN(X[[i]], ...)</span>
<span class="co">#&gt; <span style="color: #555555;"> 41. </span>simChef ...future.FUN(...future.X_jj, ...)</span>
<span class="co">#&gt; <span style="color: #555555;"> 44. </span><span style="font-weight: bold;">purrr</span>::map(...)</span>
<span class="co">#&gt; <span style="color: #555555;"> 45. </span><span style="font-weight: bold;">simChef</span> .f(.x[[i]], ...)</span>
<span class="co">#&gt; <span style="color: #555555;"> 46. </span>private$.do_call_handler(...)</span>
<span class="co">#&gt; <span style="color: #555555;"> 51. </span><span style="font-weight: bold;">simChef</span>:::do_call_handler(name, fun, params, verbose)</span>
<span class="co">#&gt; <span style="color: #555555;"> 54. </span>simChef `&lt;fn&gt;`()</span>
<span class="co">#&gt; <span style="color: #555555;"> 55. </span>self$dgp_fun()</span>
<span class="co">#&gt; <span style="color: #555555;"> 56. </span><span style="font-weight: bold;">base</span>::stop("Uh oh!")</span></code></pre></div>
<p>Note that the error object contains the name of the component (e.g., DGP, Method) that ran the error (i.e., <code>err$data$name</code>) and the input parameters for the function call (i.e., <code>err$data$params</code>). Using this, we can easily reproduce the error and if desired, work directly with the user-specified function that raised the error, e.g.,</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get dgp that ran the error</span>
<span class="va">err_fun</span> <span class="op">&lt;-</span> <span class="va">experiment</span><span class="op">$</span><span class="fu">get_dgps</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="va">err</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">name</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">dgp_fun</span>
<span class="co"># reproduce error via a direct call to the DGP function that raised the error</span>
<span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">err_fun</span>, args <span class="op">=</span> <span class="va">err</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">params</span><span class="op">)</span>
<span class="co">#&gt; Error in (function () : Uh oh!</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by James Duncan, Tiffany Tang.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
