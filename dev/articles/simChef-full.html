<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>simChef: A comprehensive guide • simChef</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="simChef: A comprehensive guide">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">simChef</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/simChef.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/cheat-sheet.html">Cheat sheet: Inputs/outputs for user-defined functions</a></li>
    <li><a class="dropdown-item" href="../articles/parallel.html">Computing experimental replicates in parallel</a></li>
    <li><a class="dropdown-item" href="../articles/simChef-full.html">simChef: A comprehensive guide</a></li>
    <li><a class="dropdown-item" href="../articles/simulation-directory-setup.html">Setting Up Your Simulation Study</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Yu-Group/simChef/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>simChef: A comprehensive guide</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Yu-Group/simChef/blob/main/vignettes/simChef-full.Rmd" class="external-link"><code>vignettes/simChef-full.Rmd</code></a></small>
      <div class="d-none name"><code>simChef-full.Rmd</code></div>
    </div>

    
    
<style type="text/css">
.infobox {
  padding: .5em 1em 0em 1.5em;
  border: 2px solid orange;
  border-radius: 10px;
  background: #f5f5f5 5px center/3em no-repeat;
  margin-bottom: 1em;
}

.infobox-blue {
  padding: .5em 1em 0em 1.5em;
  border: 2px solid cornflowerblue;
  border-radius: 10px;
  background: #f5f5f5 5px center/3em no-repeat;
  margin-bottom: 1em;
}

details {
  margin-bottom: unset
}
</style>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The goal of <code>simChef</code> is to seamlessly and efficiently run simulation experiments using a simple grammar. The results of these simulation experiments can also be conveniently viewed in an organized and interactive browser (or html file) (e.g., <a href="../linear_regression_output.html">here</a>). The basic usage of <code>simChef</code> can be summarized as follows:</p>
<ol style="list-style-type: decimal">
<li>
<p><strong>Define data-generation, method, evaluation, and visualization functions of interest.</strong></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Define data-generating process (DGP) function(s)</span></span>
<span><span class="va">dgp_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">100</span>, <span class="va">p</span> <span class="op">=</span> <span class="fl">10</span>, <span class="va">noise_sd</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="va">p</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">p</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="va">noise_sd</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">betas</span> <span class="op">+</span> <span class="va">noise</span></span>
<span>  <span class="co"># dgp function should return a named list</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">y</span>, noise_sd <span class="op">=</span> <span class="va">noise_sd</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Define method function(s)</span></span>
<span><span class="co"># method function args include the names in the dgp output list (`X` and `y` here)</span></span>
<span><span class="va">method_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">X</span><span class="op">)</span></span>
<span>  <span class="co"># by concatenating ... with the list output, we can easily pass through </span></span>
<span>  <span class="co"># other outputs from the dgp to later stages of the simulation </span></span>
<span>  <span class="co"># (evaluation and visualization)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="va">fit</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Define evaluation function(s)</span></span>
<span><span class="co"># the main computational loop of the simulation will return a `tibble::tibble`</span></span>
<span><span class="co"># which is passed as 'fit_results' to our evaluation functions</span></span>
<span><span class="va">evaluator_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fit_results</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># calculate R-squared</span></span>
<span>  <span class="va">fit_results</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      rsq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">fit</span>, <span class="kw">function</span><span class="op">(</span><span class="va">.fit</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">.fit</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## d. Define visualization function(s)</span></span>
<span><span class="va">visualizer_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">eval_results</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span>  <span class="co"># return a plot r-squared vs noise level</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">noise_sd</span>, y <span class="op">=</span> <span class="va">rsq</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">eval_results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</li>
<li>
<p><strong>Convert functions into <code><a href="../reference/DGP.html">DGP()</a></code>, <code><a href="../reference/Method.html">Method()</a></code>, <code><a href="../reference/Evaluator.html">Evaluator()</a></code>, and <code><a href="../reference/Visualizer.html">Visualizer()</a></code> class objects.</strong></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dgp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dgp.html">create_dgp</a></span><span class="op">(</span>.dgp_fun <span class="op">=</span> <span class="va">dgp_fun</span>, .name <span class="op">=</span> <span class="st">"DGP1"</span><span class="op">)</span></span>
<span><span class="va">method</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_method.html">create_method</a></span><span class="op">(</span>.method_fun <span class="op">=</span> <span class="va">method_fun</span>, .name <span class="op">=</span> <span class="st">"Method1"</span><span class="op">)</span></span>
<span><span class="va">evaluator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_evaluator.html">create_evaluator</a></span><span class="op">(</span>.eval_fun <span class="op">=</span> <span class="va">evaluator_fun</span>, .name <span class="op">=</span> <span class="st">"Evaluator1"</span><span class="op">)</span></span>
<span><span class="va">visualizer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_visualizer.html">create_visualizer</a></span><span class="op">(</span>.viz_fun <span class="op">=</span> <span class="va">visualizer_fun</span>, .name <span class="op">=</span> <span class="st">"Visualizer1"</span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p><strong>Assemble these recipe parts into a complete simulation experiment.</strong></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_experiment.html">create_experiment</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Experiment"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_dgp</a></span><span class="op">(</span><span class="va">dgp</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_method</a></span><span class="op">(</span><span class="va">method</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_evaluator</a></span><span class="op">(</span><span class="va">evaluator</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_visualizer</a></span><span class="op">(</span><span class="va">visualizer</span><span class="op">)</span></span>
<span><span class="va">experiment</span></span></code></pre></div>
</li>
<li>
<p><strong>Document and describe the simulation experiment in text.</strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/init_docs.html">init_docs</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p><strong>Run the experiment.</strong></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span><span class="va">experiment</span>, n_reps <span class="op">=</span> <span class="fl">100</span>, save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p><strong>Visualize results via an automated R Markdown report.</strong></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/render_docs.html">render_docs</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></span></code></pre></div>
</li>
</ol>
<p>In this vignette, we will provide an overview of the core features of <code>simChef</code>:</p>
<ol style="list-style-type: decimal">
<li>A tidyverse-inspired grammar of data-driven simulation experiments</li>
<li>A growing built-in library of composable building blocks for evaluation metrics and visualization utilities</li>
<li>Flexible and seamless integration with distributed computation, caching, checkpointing, and debugging tools</li>
<li>Automated generation of an R Markdown document to easily navigate, visualize, and interpret simulation results (see example <a href="../linear_regression_output.html">here</a>)</li>
</ol>
<p>Note: Before proceeding through this guide, we recommend first checking out our introductory vignette: <a href="simChef.html">Getting started with simChef</a>.</p>
</div>
<div class="section level2" number="1">
<h2 id="a-tidy-grammar-for-simulation-experiments">
<span class="header-section-number">1</span> A tidy grammar for simulation experiments<a class="anchor" aria-label="anchor" href="#a-tidy-grammar-for-simulation-experiments"></a>
</h2>
<p>Inspired by the tidyverse <span class="citation">(Wickham et al. 2019)</span>, <code>simChef</code> develops an intuitive grammar for running simulation studies.
To this end, <code>simChef</code> conceptualizes a simulation experiment into a set of core nouns, each with a corresponding verb (or verbs).</p>
<p>More specifically, <code>simChef</code> first breaks down a simulation experiment into four modular components (or nouns), each implemented as an <code>R6</code> class object <span class="citation">(Chang 2022)</span>.
Further, each of these classes is associated with a particular action or verb (italicized below).</p>
<ol style="list-style-type: decimal">
<li>
<strong>DGP</strong>: the data-generating process from which to <em>generate</em> data.</li>
<li>
<strong>Method</strong>: the methods (or models) to <em>fit</em> in the experiment.</li>
<li>
<strong>Evaluator</strong>: the evaluation metrics used to <em>evaluate</em> the methods’ performance.</li>
<li>
<strong>Visualizer</strong>: the visualization procedure used to <em>visualize</em> outputs from the method fits or evaluation results (can be tables, plots, or even R Markdown snippets to display).</li>
</ol>
<p>There is also a fifth and final noun:</p>
<ol start="5" style="list-style-type: decimal">
<li>
<strong>Experiment</strong>: an <code>R6</code> class which unites the four components above (DGP(s), Method(s), Evaluator(s), and Visualizer(s)) and stores references to these objects along with the DGP and Method parameters that should be varied in the study. There are four verbs associated with an Experiment:
<ol style="list-style-type: lower-alpha">
<li>
<em>Fit</em> the Experiment: each Method in the Experiment is fit on each DGP in the Experiment.</li>
<li>
<em>Evaluate</em> the Experiment: each Evaluator in the Experiment is evaluated on the fitted experiment results.</li>
<li>
<em>Visualize</em> the Experiment: each Visualizer in the Experiment is visualized using the fitted and/or evaluated experiment results.</li>
<li>
<em>Run</em> the Experiment: wrapper to fit, evaluate, and visualize the Experiment all at once.</li>
</ol>
</li>
</ol>
<div class="section level3" number="1.1">
<h3 id="basic-example-usage">
<span class="header-section-number">1.1</span> Basic example usage<a class="anchor" aria-label="anchor" href="#basic-example-usage"></a>
</h3>
<p>Leveraging this grammar, we can easily use <code>simChef</code> to run a simulation experiment in six steps.</p>
<ol style="list-style-type: decimal">
<li>Define DGP, method, evaluation, and visualization functions of interest.</li>
<li>Convert functions into <code><a href="../reference/DGP.html">DGP()</a></code>, <code><a href="../reference/Method.html">Method()</a></code>, <code><a href="../reference/Evaluator.html">Evaluator()</a></code>, and <code><a href="../reference/Visualizer.html">Visualizer()</a></code> class objects.</li>
<li>Assemble objects into a complete simulation experiment.</li>
<li>Document and describe the simulation experiment in text.</li>
<li>Run the experiment.</li>
<li>Visualize results via an automated R Markdown report.</li>
</ol>
<blockquote>
<p>For concreteness, suppose that we would like to run an experiment, studying the performance of linear regression under a linear Gaussian data-generating process.</p>
</blockquote>
<div class="section level4">
<h4 id="step-1--define-dgp-method-evaluation-and-visualization-functions-of-interest">Step 1. Define DGP, method, evaluation, and visualization functions of interest<a class="anchor" aria-label="anchor" href="#step-1--define-dgp-method-evaluation-and-visualization-functions-of-interest"></a>
</h4>
<p>To begin, we first need to define the individual parts of the simulation experiment, namely, the data-generation, method, evaluation, and visualization functions under study.
We also need to write these functions such that they “play nicely” with one another under the <code>simChef</code> API.
We will make note of these requirements as we go, but for an introductory overview, please refer to the <em>Writing your own simulation experiment</em> section in <a href="simChef.html">Getting started with simChef</a> or our <a href="cheat-sheet.html">Cheat sheet: Inputs/outputs for user-defined functions</a>.</p>
<p><em>Note</em>: Step 1 requires the most user-written code. After this step, there is minimal coding on the user end as we turn to leverage the <code>simChef</code> grammar for experiments.</p>
<div class="section level5">
<h5 id="step-1a--define-data-generating-process-dgp-functions">Step 1a. Define data-generating process (DGP) function(s)<a class="anchor" aria-label="anchor" href="#step-1a--define-data-generating-process-dgp-functions"></a>
</h5>
<p>As a toy DGP example, let us create a function to simulate a random Gaussian data matrix <span class="math inline">\(\mathbf{X}\)</span> of size <span class="math inline">\(n \times 2\)</span> and a linear response vector <span class="math inline">\(\mathbf{y}\)</span> of size <span class="math inline">\(n \times 1\)</span>, where</p>
<p><span class="math display">\[\begin{gather*}
\mathbf{X} \sim N\left(\mathbf{0}, \begin{pmatrix} 1 &amp; \rho \\ \rho &amp; 1 \end{pmatrix}\right), \\
\mathbf{y} = \mathbf{X} \boldsymbol{\beta} + \boldsymbol{\epsilon},\\
\boldsymbol{\epsilon} \sim N(\mathbf{0}, \sigma^2 \mathbf{I}_n)
\end{gather*}\]</span></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linear_dgp_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">beta</span>, <span class="va">rho</span>, <span class="va">sigma</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cov_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">rho</span>, <span class="va">rho</span>, <span class="fl">1</span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">T</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="va">cov_mat</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="infobox">
<details><summary><em>Requirements for DGP function syntax</em>
</summary><p><strong>DGP inputs</strong>:</p>
<ul>
<li>Any number of named parameters.</li>
</ul>
<p><strong>DGP outputs</strong>:</p>
<ul>
<li>A named list with all data necessary to fit the method, evaluate the method, and visualize results.
<ul>
<li>Note: This returned list of elements will be automatically passed onto the method function(s) as input arguments of the same name.</li>
</ul>
</li>
</ul></details>
</div>
</div>
<div class="section level5">
<h5 id="step-1b--define-method-functions">Step 1b. Define method function(s)<a class="anchor" aria-label="anchor" href="#step-1b--define-method-functions"></a>
</h5>
<p>Given the above DGP, suppose we want to investigate the performance of linear regression, specifically the p-values corresponding to the non-intercept coefficients from <code><a href="https://rdrr.io/r/stats/summary.lm.html" class="external-link">summary.lm()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, <span class="va">cols</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1"</span>, <span class="st">"X2"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">lm_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">X</span><span class="op">)</span></span>
<span>  <span class="va">pvals_tib</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lm_fit</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="va">cols</span>, <span class="st">"Pr(&gt;|t|)"</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pvals_tib</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pvals_tib</span><span class="op">)</span>, <span class="st">"p-value"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">pvals_tib</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="infobox">
<details><summary><em>Requirements for method function syntax</em>
</summary><p><strong>Method inputs</strong>:</p>
<ul>
<li>Named parameters matching all names in the list returned by the DGP function <code>linear_dgp_fun</code> (in this case, <code>X</code> and <code>y</code>).</li>
<li>Any number of additional named parameters (in this case, <code>cols</code>).</li>
</ul>
<p><strong>Method outputs</strong>:</p>
<ul>
<li>A list (or array-like object) of named elements with all data necessary to evaluate the method and visualize results.</li>
</ul></details>
</div>
</div>
<div class="section level5">
<h5 id="step-1c--define-evaluation-functions">Step 1c. Define evaluation function(s)<a class="anchor" aria-label="anchor" href="#step-1c--define-evaluation-functions"></a>
</h5>
<p>To evaluate performance here, one metric (or statistic) of interest could be the rejection probability at some level <span class="math inline">\(\alpha\)</span>, which we compute in the following function <code>reject_prob_fun</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reject_prob_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fit_results</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">group_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">".dgp_name"</span>, <span class="st">".method_name"</span><span class="op">)</span></span>
<span>  <span class="va">eval_out</span> <span class="op">&lt;-</span> <span class="va">fit_results</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span><span class="va">group_vars</span><span class="op">}</span><span class="op">}</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>      `X1 Reject Prob.` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">`X1 p-value`</span> <span class="op">&lt;</span> <span class="va">alpha</span><span class="op">)</span>,</span>
<span>      `X2 Reject Prob.` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">`X2 p-value`</span> <span class="op">&lt;</span> <span class="va">alpha</span><span class="op">)</span>,</span>
<span>      .groups <span class="op">=</span> <span class="st">"keep"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">eval_out</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="infobox">
<details><summary><em>Requirements for evaluation function syntax</em>
</summary><p><strong>Evaluator inputs</strong>:</p>
<ul>
<li>
<code>fit_results</code> (optional, but almost always necessary): output of <code><a href="../reference/fit_experiment.html">fit_experiment()</a></code>, which automatically gets passed to the evaluation function(s).
<ul>
<li>More specifically, <code>fit_results</code> is a tibble containing the method outputs of all (replicate, DGP, method) combinations fitted in the experiment.
<code>fit_results</code> will have columns named <code>.rep</code>, <code>.dgp_name</code>, <code>.method_name</code>, and any other named arguments that were outputted from the method function (i.e., <code>lm_fun</code>).</li>
<li>Note: This argument must be exactly named <code>fit_results</code> or else the evaluation function will not receive the results from the fitted experiment.</li>
<li>Tip: Many evaluation metrics are most naturally computed across replicates, so it is common to group the <code>fit_results</code> by <code>.dgp_name</code> and <code>.method_name</code> as seen in <code>reject_prob_fun()</code> above. In doing so, the rejection probability (across replicates) will be computed for each (DGP, Method) combination separately. However, depending on the goal of the Evaluator function, grouping by <code>.dgp_name</code> and <code>.method_name</code> might not be necessary.</li>
</ul>
</li>
<li>
<code>vary_params</code> (optional): character vector of parameter names that are varied across in the experiment and automatically passed to the evaluation function(s); discussed further in <a href="#example-usage-with-varying-across-component">1.2</a>.</li>
<li>Any number of additional named parameters (in this case, <code>alpha</code>).</li>
</ul>
<p><strong>Evaluator outputs</strong>:</p>
<ul>
<li>Typically a <code>tibble</code> or <code>data.frame</code> with the evaluated metrics or performance of the method.</li>
</ul></details>
</div>
</div>
<div class="section level5">
<h5 id="step-1d--define-visualization-functions">Step 1d. Define visualization function(s)<a class="anchor" aria-label="anchor" href="#step-1d--define-visualization-functions"></a>
</h5>
<p>Lastly, we may want to plot the results from the method fits (stored in <code>fit_results</code>) and/or the outputs from our evaluation metrics (stored in <code>eval_results</code>). For example, we could plot the power of the hypothesis test as in <code>power_plot_fun</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_plot_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fit_results</span>, <span class="va">col</span> <span class="op">=</span> <span class="st">"X1"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fit_results</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">col</span>, <span class="st">"p-value"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                 color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">.method_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                         color <span class="op">=</span> <span class="st">"darkgray"</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ecdf.html" class="external-link">stat_ecdf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"t"</span>, y <span class="op">=</span> <span class="st">"P( p-value \u2264 t )"</span>,</span>
<span>                  linetype <span class="op">=</span> <span class="st">""</span>, color <span class="op">=</span> <span class="st">"Method"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">plt</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="infobox">
<details><summary><em>Requirements for visualization function syntax</em>
</summary><p><strong>Visualizer inputs</strong>:</p>
<ul>
<li>
<code>fit_results</code> (optional): output of <code><a href="../reference/fit_experiment.html">fit_experiment()</a></code>, which automatically gets passed to the visualization function(s).
<ul>
<li>Note: This argument must be exactly named <code>fit_results</code> or else the visualization function will not receive the results from the fitted experiment.</li>
<li>Tip: Include <code>fit_results</code> as an input parameter if the visualization is to be computed using the method outputs.</li>
</ul>
</li>
<li>
<code>eval_results</code> (optional): output of <code><a href="../reference/evaluate_experiment.html">evaluate_experiment()</a></code>, which automatically gets passed to the visualization function(s).
<ul>
<li>More specifically, <code>eval_results</code> is a list of named elements, one element for each Evaluator in the experiment.</li>
<li>Note: This argument must be exactly named <code>eval_results</code> or else the visualization function will not receive the results from the evaluated experiment.</li>
<li>Tip: Include <code>eval_results</code> as an input parameter if the visualization is to be computed using the evaluation outputs.</li>
</ul>
</li>
<li>
<code>vary_params</code> (optional): character vector of parameter names that are varied across in the experiment and automatically passed to the visualization function(s); discussed further in <a href="#example-usage-with-varying-across-component">1.2</a>.</li>
<li>Any number of additional named parameters (in this case, <code>col</code>).</li>
</ul>
<p><strong>Visualizer outputs</strong>:</p>
<ul>
<li>Typically a plot. We highly recommend using <code>ggplot</code> or <code>plotly</code>. On rarer occasions, can also return tables or more generally, any R Markdown snippet.</li>
</ul></details>
</div>
</div>
</div>
<div class="section level4">
<h4 id="step-2--convert-functions-into-dgp-method-evaluator-and-visualizer-class-objects">Step 2. Convert functions into <code>DGP()</code>, <code>Method()</code>, <code>Evaluator()</code>, and <code>Visualizer()</code> class objects<a class="anchor" aria-label="anchor" href="#step-2--convert-functions-into-dgp-method-evaluator-and-visualizer-class-objects"></a>
</h4>
<p>Once we have specified the relevant DGP, method, evaluation, and visualization functions, the next step is to convert these functions into <code><a href="../reference/DGP.html">DGP()</a></code>, <code><a href="../reference/Method.html">Method()</a></code>, <code><a href="../reference/Evaluator.html">Evaluator()</a></code>, and <code><a href="../reference/Visualizer.html">Visualizer()</a></code> class objects for <code>simChef</code>. To do so, we simply wrap the functions in <code><a href="../reference/create_dgp.html">create_dgp()</a></code>, <code><a href="../reference/create_method.html">create_method()</a></code>, <code><a href="../reference/create_evaluator.html">create_evaluator()</a></code>, or <code><a href="../reference/create_visualizer.html">create_visualizer()</a></code>, while specifying an intelligible name for the object and any input parameters to pass to the function.</p>
<p>Each <code>create_*()</code> function follows the same syntax and takes in the inputs:</p>
<ul>
<li>
<code>.*_fun</code>: the function from which to simulate data, fit the method, evaluate metrics, or create a visualization (depending on <code>*</code>).</li>
<li>
<code>.name</code>: an (intelligible) object name, which will be used in creating the R Markdown report.</li>
<li>
<code>...</code>: additional arguments to pass to <code>.*_fun</code> above.</li>
</ul>
<div class="float" id="fig:api-overview">
<img src="figures%2Fapi_overview.png" style="width:100.0%" alt="Overview of the four core components (DGP(), Method(), Evaluator(), Visualizer()) in a simChef Experiment. Using these classes, users can easily build a simChef Experiment using reusable, custom user-defined functions (i.e., dgp_fun, method_fun, eval_fun, and viz_fun). Optional named parameters can be set in these user-defined functions via the ... arguments in the create_*() methods."><div class="figcaption">Overview of the four core components (<code><a href="../reference/DGP.html">DGP()</a></code>, <code><a href="../reference/Method.html">Method()</a></code>, <code><a href="../reference/Evaluator.html">Evaluator()</a></code>, <code><a href="../reference/Visualizer.html">Visualizer()</a></code>) in a <code>simChef</code> <code>Experiment</code>. Using these classes, users can easily build a <code>simChef</code> <code>Experiment</code> using reusable, custom user-defined functions (i.e., <code>dgp_fun</code>, <code>method_fun</code>, <code>eval_fun</code>, and <code>viz_fun</code>). Optional named parameters can be set in these user-defined functions via the <code>...</code> arguments in the <code>create_*()</code> methods.</div>
</div>
<p>For example,</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## DGPs</span></span>
<span><span class="va">linear_dgp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dgp.html">create_dgp</a></span><span class="op">(</span></span>
<span>  .dgp_fun <span class="op">=</span> <span class="va">linear_dgp_fun</span>, .name <span class="op">=</span> <span class="st">"Linear Gaussian DGP"</span>,</span>
<span>  <span class="co"># additional named parameters to pass to .dgp_fun()</span></span>
<span>  n <span class="op">=</span> <span class="fl">200</span>, beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, rho <span class="op">=</span> <span class="fl">0</span>, sigma <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Methods</span></span>
<span><span class="va">lm_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_method.html">create_method</a></span><span class="op">(</span></span>
<span>  .method_fun <span class="op">=</span> <span class="va">lm_fun</span>, .name <span class="op">=</span> <span class="st">"OLS"</span></span>
<span>  <span class="co"># additional named parameters to pass to .method_fun()</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Evaluators</span></span>
<span><span class="va">reject_prob_eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_evaluator.html">create_evaluator</a></span><span class="op">(</span></span>
<span>  .eval_fun <span class="op">=</span> <span class="va">reject_prob_fun</span>, .name <span class="op">=</span> <span class="st">"Rejection Prob. (alpha = 0.1)"</span>,</span>
<span>  <span class="co"># additional named parameters to pass to .eval_fun()</span></span>
<span>  alpha <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Visualizers</span></span>
<span><span class="va">power_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_visualizer.html">create_visualizer</a></span><span class="op">(</span></span>
<span>  .viz_fun <span class="op">=</span> <span class="va">power_plot_fun</span>, .name <span class="op">=</span> <span class="st">"Power"</span></span>
<span>  <span class="co"># additional named parameters to pass to .viz_fun()</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Some notes on the use of <code>...</code> arguments in <code>create_*()</code>:</p>
<ul>
<li>
<code>...</code> arguments in <code>create_*()</code> must be named arguments that match those in <code>.*_fun()</code>.</li>
<li>
<code>...</code> arguments in <code>create_*()</code> will override any default arguments set in <code>.*_fun()</code>.
<ul>
<li>E.g., In <code>reject_prob_eval</code>, <code>alpha = 0.1</code>, not <code>0.05</code>.</li>
</ul>
</li>
<li>If <code>...</code> arguments in <code>create_*()</code> are not specified, the default arguments in <code>.*_fun()</code> are used.
<ul>
<li>E.g., In <code>lm_method</code>, <code>cols = c("X1", "X2")</code>.</li>
</ul>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="step-3--assemble-objects-into-a-complete-simulation-experiment">Step 3. Assemble objects into a complete simulation experiment<a class="anchor" aria-label="anchor" href="#step-3--assemble-objects-into-a-complete-simulation-experiment"></a>
</h4>
<p>At this point, we have created a <code><a href="../reference/DGP.html">DGP()</a></code> (<code>dgp</code>), <code><a href="../reference/Method.html">Method()</a></code> (<code>lm_method</code>), <code><a href="../reference/Evaluator.html">Evaluator()</a></code> (<code>reject_prob_eval</code>), and <code><a href="../reference/Visualizer.html">Visualizer()</a></code> (<code>power_plot</code>) for our simulation experiment.
The next step is to create a simulation experiment recipe and <code>add</code> each component to the recipe via:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_experiment.html">create_experiment</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Linear Regression Experiment"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_dgp</a></span><span class="op">(</span><span class="va">linear_dgp</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_method</a></span><span class="op">(</span><span class="va">lm_method</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_evaluator</a></span><span class="op">(</span><span class="va">reject_prob_eval</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_visualizer</a></span><span class="op">(</span><span class="va">power_plot</span><span class="op">)</span></span></code></pre></div>
<p><em>Tip</em>: We can easily see the individual parts of the simulation experiment recipe by printing the experiment.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></span>
<span><span class="co">#&gt; Experiment Name: Linear Regression Experiment </span></span>
<span><span class="co">#&gt;    Saved results at: results/Linear Regression Experiment </span></span>
<span><span class="co">#&gt;    DGPs: Linear Gaussian DGP </span></span>
<span><span class="co">#&gt;    Methods: OLS </span></span>
<span><span class="co">#&gt;    Evaluators: Rejection Prob. (alpha = 0.1) </span></span>
<span><span class="co">#&gt;    Visualizers: Power </span></span>
<span><span class="co">#&gt;    Vary Across: None</span></span></code></pre></div>
<p><em>Notes</em>:</p>
<ul>
<li>Any number of DGPs, Methods, Evaluators, and Visualizers can be added to the simulation experiment recipe.</li>
<li>Once a DGP, Method, Evaluator, or Visualizer has been added to the simulation experiment recipe, the component can be updated using <code><a href="../reference/update_funs.html">update_dgp()</a></code>, <code><a href="../reference/update_funs.html">update_method()</a></code>, <code><a href="../reference/update_funs.html">update_evaluator()</a></code>, or <code><a href="../reference/update_funs.html">update_visualizer()</a></code> and removed using <code><a href="../reference/remove_funs.html">remove_dgp()</a></code>, <code><a href="../reference/remove_funs.html">remove_method()</a></code>, <code><a href="../reference/remove_funs.html">remove_evaluator()</a></code>, or <code><a href="../reference/remove_funs.html">remove_visualizer()</a></code>.</li>
</ul>
</div>
<div class="section level4">
<h4 id="step-4--document-and-describe-the-simulation-experiment-in-text">Step 4. Document and describe the simulation experiment in text<a class="anchor" aria-label="anchor" href="#step-4--document-and-describe-the-simulation-experiment-in-text"></a>
</h4>
<p>A crucial component when running veridical simulations is <strong>documentation</strong>.
We highly encourage practitioners to document:</p>
<ul>
<li>the purpose or objective of the simulation experiment,</li>
<li>what <code>DGP(s)</code>, <code>Method(s)</code>, <code>Evaluator(s)</code>, and <code>Visualizer(s)</code> were used, and</li>
<li>why these <code>DGP(s)</code>, <code>Method(s)</code>, <code>Evaluator(s)</code>, and <code>Visualizer(s)</code> were chosen.</li>
</ul>
<p>This can and should be done before even running the simulation experiment.
To facilitate this tedious but important process, we have provided a convenient helper function <code><a href="../reference/init_docs.html">init_docs()</a></code> to initialize/create a documentation template:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/init_docs.html">init_docs</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></span></code></pre></div>
<p>This creates a series of blank .md files for the user to fill out with descriptions of the simulation experiment and its recipe components. These blank .md files can be found in the experiment’s root results directory under docs/. To find the experiment’s root results directory, use <code>get_save_dir(experiment)</code>. You can find example .md files corresponding to the current experiment and others <a href="https://github.com/Yu-Group/simChef/tree/main/vignettes/example-docs/" class="external-link">here</a>.</p>
</div>
<div class="section level4">
<h4 id="step-5--run-the-experiment">Step 5. Run the experiment<a class="anchor" aria-label="anchor" href="#step-5--run-the-experiment"></a>
</h4>
<p>Thus far, we have created and documented the simulation experiment recipe, but we have not generated any results from the experiment. That is, we have only given the simulation experiment instructions on what to do. To run the experiment, say over 10 replicates, we can do so via</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span><span class="va">experiment</span>, n_reps <span class="op">=</span> <span class="fl">10</span>, save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in get(paste0(generic, ".", class), envir = get_method_env()) : </span></span>
<span><span class="co">#&gt;   object 'type_sum.accel' not found</span></span>
<span><span class="co">#&gt; Fitting Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Saving fit results...</span></span>
<span><span class="co">#&gt; Fit results saved | time taken: 0.016710 seconds</span></span>
<span><span class="co">#&gt; 10 reps completed (totals: 10/10) | time taken: 0.042153 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Evaluating Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Evaluation completed | time taken: 0.000143 minutes</span></span>
<span><span class="co">#&gt; Saving eval results...</span></span>
<span><span class="co">#&gt; Eval results saved | time taken: 0.087202 seconds</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Visualizing Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#&gt; Visualization completed | time taken: 0.002383 minutes</span></span>
<span><span class="co">#&gt; Saving viz results...</span></span>
<span><span class="co">#&gt; Viz results saved | time taken: 0.080761 seconds</span></span>
<span><span class="co">#&gt; ==============================</span></span></code></pre></div>
<p><code><a href="../reference/run_experiment.html">run_experiment()</a></code> is a convenient wrapper function that:</p>
<ol style="list-style-type: decimal">
<li>Fits the experiment (<code><a href="../reference/fit_experiment.html">fit_experiment()</a></code>), which fits each <code>Method</code> on each <code>DGP</code> in the <code>Experiment</code>,</li>
<li>Evaluates the experiment (<code><a href="../reference/evaluate_experiment.html">evaluate_experiment()</a></code>), which evaluates each <code>Evaluator</code> on the fitted results, and</li>
<li>Visualizes the experiment (<code><a href="../reference/visualize_experiment.html">visualize_experiment()</a></code>), which visualizes each <code>Visualizer</code> on the fitted and/or evaluated results.</li>
</ol>
<p>Consequently, the output of <code><a href="../reference/run_experiment.html">run_experiment()</a></code> is a list of length three:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">results</span>, max.level <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ fit_results : tibble [10 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ eval_results:List of 1</span></span>
<span><span class="co">#&gt;   ..$ Rejection Prob. (alpha = 0.1): tibble [1 × 4] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ viz_results :List of 1</span></span>
<span><span class="co">#&gt;   ..$ Power:List of 11</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "class")= chr [1:2] "gg" "ggplot"</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>
<code>fit_results</code>: output of <code><a href="../reference/fit_experiment.html">fit_experiment()</a></code>
<ul>
<li>A tibble of results from each (replicate, DGP, Method) combination with the following columns:
<ul>
<li>
<code>.rep</code>: replicate ID</li>
<li>
<code>.dgp_name</code>: name of DGP</li>
<li>
<code>.method_name</code>: name of Method</li>
<li>
<code>vary_across</code> parameter columns (if applicable): value of the specified <code>vary_across</code> parameter</li>
<li>A column corresponding to each named component in the list returned by <code>Method</code> (e.g., <code>method_out1</code>, <code>method_out2</code>, …)</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="va">fit_results</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 5</span></span></span>
<span><span class="co">#&gt;    .rep  .dgp_name           .method_name `X1 p-value` `X2 p-value`</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1     Linear Gaussian DGP OLS              4.90<span style="color: #949494;">e</span><span style="color: #BB0000;">-29</span>       0.704 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2     Linear Gaussian DGP OLS              4.28<span style="color: #949494;">e</span><span style="color: #BB0000;">-28</span>       0.713 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 3     Linear Gaussian DGP OLS              1.60<span style="color: #949494;">e</span><span style="color: #BB0000;">-38</span>       0.680 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 4     Linear Gaussian DGP OLS              2.31<span style="color: #949494;">e</span><span style="color: #BB0000;">-29</span>       0.011<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 5     Linear Gaussian DGP OLS              8.08<span style="color: #949494;">e</span><span style="color: #BB0000;">-33</span>       0.127 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 6     Linear Gaussian DGP OLS              8.95<span style="color: #949494;">e</span><span style="color: #BB0000;">-29</span>       0.980 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 7     Linear Gaussian DGP OLS              6.84<span style="color: #949494;">e</span><span style="color: #BB0000;">-33</span>       0.385 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 8     Linear Gaussian DGP OLS              6.60<span style="color: #949494;">e</span><span style="color: #BB0000;">-29</span>       0.116 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 9     Linear Gaussian DGP OLS              4.16<span style="color: #949494;">e</span><span style="color: #BB0000;">-28</span>       0.765 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 10    Linear Gaussian DGP OLS              1.28<span style="color: #949494;">e</span><span style="color: #BB0000;">-21</span>       0.530</span></span></code></pre></div>
</li>
</ul>
</li>
<li>
<code>eval_results</code>: output of <code><a href="../reference/evaluate_experiment.html">evaluate_experiment()</a></code>
<ul>
<li>A named list of elements, with one element for each <code>Evaluator</code> in the <code>Experiment</code>
<ul>
<li>The list names correspond to the names given to each <code>Evaluator</code> in <code>create_evaluator(.name = ...)</code>
</li>
<li>The list elements are exactly the return values from each <code>Evaluator</code> function</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="va">eval_results</span></span>
<span><span class="co">#&gt; $`Rejection Prob. (alpha = 0.1)`</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">#&gt;   .dgp_name           .method_name `X1 Reject Prob.` `X2 Reject Prob.`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Linear Gaussian DGP OLS                          1               0.1</span></span></code></pre></div>
</li>
</ul>
</li>
<li>
<code>viz_results</code>: output of <code><a href="../reference/visualize_experiment.html">visualize_experiment()</a></code>
<ul>
<li>A named list of elements, with one element for each <code>Visualizer</code> in the <code>Experiment</code>
<ul>
<li>The list names correspond to the names given to each <code>Visualizer</code> in <code>create_visualizer(.name = ...)</code>
</li>
<li>The list elements are exactly the return values from each <code>Visualizer</code> function</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="va">viz_results</span></span>
<span><span class="co">#&gt; $Power</span></span></code></pre></div>
<img src="simChef-full_files/figure-html/viz-results-output-1.png" style="display: block; margin: auto;">
</li>
</ul>
</li>
</ol>
<p>Notes:</p>
<ul>
<li>By default, the results are not saved to disk. However, to generate the R Markdown report, we will need to save the results to disk and hence set <code>save = TRUE</code> in the call to <code><a href="../reference/run_experiment.html">run_experiment()</a></code> above.</li>
<li>The experiment can also be run in parallel. For a more detailed walkthrough on how to parallelize the experiment, please see <code><a href="../articles/parallel.html">vignette("parallel")</a></code>.</li>
</ul>
</div>
<div class="section level4">
<h4 id="step-6--visualize-results-via-an-automated-r-markdown-report">Step 6. Visualize results via an automated R Markdown report<a class="anchor" aria-label="anchor" href="#step-6--visualize-results-via-an-automated-r-markdown-report"></a>
</h4>
<p>Finally, to visualize and report all results from the simulation experiment, we can render the R Markdown documentation. This will generate a single html document, including the code, documentation (from Step 4), and simulation results.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/render_docs.html">render_docs</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></span></code></pre></div>
<p>The results can be found <a href="../linear_regression_base_output.html">here</a>.</p>
<p>Note that if the documentation template has not yet been created for <code>experiment</code> (e.g., via <code>init_docs(experiment)</code>), then <code><a href="../reference/render_docs.html">render_docs()</a></code> will automatically create the documentation template for the user to fill out. Again, we highly encourage practitioners to document their simulation experiments in the spirit of transparency and reproducibility.</p>
</div>
</div>
<div class="section level3" number="1.2">
<h3 id="example-usage-with-varying-across-component">
<span class="header-section-number">1.2</span> Example usage with varying across component<a class="anchor" aria-label="anchor" href="#example-usage-with-varying-across-component"></a>
</h3>
<p>Now, moving slightly beyond the most basic usage of <code>simChef</code>, it is often helpful to understand how a method’s performance is affected as we vary parameter(s) in the DGP and/or method across different values.</p>
<p>For instance, what happens to the power as the amount of noise in the linear model increases?</p>
<p>Using the grammar of <code>simChef</code>, we can investigate this question by adding a <code>vary_across</code> component to the <code>Experiment</code>. In this example, we are varying the <code>sigma</code> (i.e,. the noise level) parameter in the Linear Gaussian DGP across four different values (i.e,. 1, 2, 4, and 8) while keeping all other parameters fixed at their baseline value.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="va">experiment</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/vary_across.html">add_vary_across</a></span><span class="op">(</span>.dgp <span class="op">=</span> <span class="st">"Linear Gaussian DGP"</span>, sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></span>
<span><span class="co">#&gt; Experiment Name: Linear Regression Experiment </span></span>
<span><span class="co">#&gt;    Saved results at: results/Linear Regression Experiment </span></span>
<span><span class="co">#&gt;    DGPs: Linear Gaussian DGP </span></span>
<span><span class="co">#&gt;    Methods: OLS </span></span>
<span><span class="co">#&gt;    Evaluators: Rejection Prob. (alpha = 0.1) </span></span>
<span><span class="co">#&gt;    Visualizers: Power </span></span>
<span><span class="co">#&gt;    Vary Across: </span></span>
<span><span class="co">#&gt;       DGP: Linear Gaussian DGP </span></span>
<span><span class="co">#&gt;          sigma:  num [1:4] 1 2 4 8</span></span></code></pre></div>
<div class="infobox-blue">
<details><summary><strong>About <code>add_vary_across()</code></strong>
</summary><p>More generally, <code><a href="../reference/vary_across.html">add_vary_across()</a></code> can be used to vary across one or more parameters in a <code>DGP</code> or <code>Method</code> while keeping all other parameters fixed at their baseline value. The inputs to <code>add_vary_across</code> are as follows:</p>
<ul>
<li>
<code>.dgp</code>, <code>.method</code>: Name of the <code>DGP</code>/<code>Method</code> to vary or the <code>DGP</code>/<code>Method</code> object itself.
<ul>
<li>Note: Only one of <code>.dgp</code> or <code>.method</code> can be specified at a time. To vary across more than one <code>DGP</code> and/or <code>Method</code>, use a separate <code><a href="../reference/vary_across.html">add_vary_across()</a></code> call for each.</li>
</ul>
</li>
<li>
<code>...</code>: Any number of named arguments of the form <code>[param_name] = [param_values]</code>.
<ul>
<li>
<code>[param_name]</code> should be the name of the argument/parameter in the <code>DGP</code>/<code>Method</code> function that will be varied.</li>
<li>
<code>[param_values]</code> should be a vector or list of values that <code>[param_name]</code> will take on, while all other arguments are kept constant at their baseline value (see <code>DGP$dgp_params</code> or <code>Method$method_params</code> for these baseline values).</li>
</ul>
</li>
</ul>
<p>Some notes on varying across multiple parameters:</p>
<ul>
<li>If multiple arguments of <code>[param_name] = [param_values]</code> are provided within a call to <code><a href="../reference/vary_across.html">add_vary_across()</a></code>, the cross-product of parameter values is taken.
<ul>
<li>E.g., <code>add_vary_across(.dgp = "Linear Gaussian DGP", sigma = c(1, 2, 4, 8), n = c(100, 200, 300))</code> will result in <span class="math inline">\(4 \times 3 = 12\)</span> distinct configurations of the <code>DGP</code>.</li>
</ul>
</li>
<li>It is possible to vary across both <code>DGP</code> and <code>Method</code> parameters in an <code>Experiment</code>. Here, all DGP-method combinations are fitted.
<ul>
<li>E.g., <code>add_vary_across(.dgp = "Linear Gaussian DGP", sigma = c(1, 2, 4, 8)) |&gt; add_vary_across(.method = "OLS", cols = c("X1", "X2"))</code> results in 8 DGP-method combinations to be fitted in the <code>Experiment</code> (4 variations on the <code>DGP</code> <span class="math inline">\(\times\)</span> 2 variations on the <code>Method</code>).</li>
</ul>
</li>
</ul></details>
</div>
<p>However, when we run the experiment, the results are not quite what we want.
While <code>fit_results</code> yields a tibble with 40 rows (= 10 replicates <span class="math inline">\(\times\)</span> 4 <code>DGP</code> variations <span class="math inline">\(\times\)</span> 1 <code>Method</code>) as desired, the evaluation results in <code>eval_results</code> have been summarized/aggregated across all values of <code>sigma</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vary_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span><span class="va">experiment</span>, n_reps <span class="op">=</span> <span class="fl">10</span>, save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Fitting Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Saving fit results...</span></span>
<span><span class="co">#&gt; Fit results saved | time taken: 0.025724 seconds</span></span>
<span><span class="co">#&gt; 10 reps completed (totals: 10/10) | time taken: 0.144608 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Evaluating Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Evaluation completed | time taken: 0.000168 minutes</span></span>
<span><span class="co">#&gt; Saving eval results...</span></span>
<span><span class="co">#&gt; Eval results saved | time taken: 0.027669 seconds</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Visualizing Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Visualization completed | time taken: 0.000227 minutes</span></span>
<span><span class="co">#&gt; Saving viz results...</span></span>
<span><span class="co">#&gt; Viz results saved | time taken: 0.091859 seconds</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="va">vary_results</span><span class="op">$</span><span class="va">fit_results</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 40 × 6</span></span></span>
<span><span class="co">#&gt;    .rep  .dgp_name           .method_name sigma `X1 p-value` `X2 p-value`</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1     Linear Gaussian DGP OLS              1     1.29<span style="color: #949494;">e</span><span style="color: #BB0000;">-31</span>        0.300</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1     Linear Gaussian DGP OLS              2     6.56<span style="color: #949494;">e</span><span style="color: #BB0000;">- 8</span>        0.975</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1     Linear Gaussian DGP OLS              4     6.78<span style="color: #949494;">e</span><span style="color: #BB0000;">- 4</span>        0.692</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1     Linear Gaussian DGP OLS              8     5.55<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span>        0.955</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2     Linear Gaussian DGP OLS              1     7.20<span style="color: #949494;">e</span><span style="color: #BB0000;">-32</span>        0.971</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2     Linear Gaussian DGP OLS              2     1.51<span style="color: #949494;">e</span><span style="color: #BB0000;">-11</span>        0.281</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2     Linear Gaussian DGP OLS              4     8.09<span style="color: #949494;">e</span><span style="color: #BB0000;">- 4</span>        0.301</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2     Linear Gaussian DGP OLS              8     4.96<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>        0.922</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 3     Linear Gaussian DGP OLS              1     5.10<span style="color: #949494;">e</span><span style="color: #BB0000;">-32</span>        0.944</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 3     Linear Gaussian DGP OLS              2     2.48<span style="color: #949494;">e</span><span style="color: #BB0000;">-12</span>        0.429</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 30 more rows</span></span></span>
<span><span class="va">vary_results</span><span class="op">$</span><span class="va">eval_results</span></span>
<span><span class="co">#&gt; $`Rejection Prob. (alpha = 0.1)`</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">#&gt;   .dgp_name           .method_name `X1 Reject Prob.` `X2 Reject Prob.`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Linear Gaussian DGP OLS                       0.85               0.1</span></span>
<span><span class="va">vary_results</span><span class="op">$</span><span class="va">viz_results</span></span>
<span><span class="co">#&gt; $Power</span></span></code></pre></div>
<p><img src="simChef-full_files/figure-html/vary-across-results-1-1.png" style="display: block; margin: auto;"></p>
<p>To see how different values of <code>sigma</code> impact the OLS results, we need to modify our <code>Evaluator</code> and <code>Visualizer</code> functions.
Specifically, in <code>reject_prob_fun()</code>, we want to group <code>fit_results</code> by <code>sigma</code> in addition to <code>.dgp_name</code> and <code>.method_name</code>.
To do this, we can manually set <code>group_vars &lt;- c(".dgp_name", ".method_name", "sigma")</code>.
However, it would be better practice to make use of an input argument named <code>vary_params</code> like below.
When we run the experiment (via <code><a href="../reference/run_experiment.html">run_experiment()</a></code>), <code>vary_params</code> will be auto-filled by a vector of the parameter names that are varied (i.e., those that have been added via <code><a href="../reference/vary_across.html">add_vary_across()</a></code>).
In this case, <code>vary_params</code> will be auto-filled by <code>c("sigma")</code>.
Thus, by using this <code>vary_params</code> argument, the <code>Evaluator</code> will work more generally, even if other parameters besides <code>sigma</code> are varied in the <code>Experiment</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reject_prob_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fit_results</span>, <span class="va">vary_params</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">group_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">".dgp_name"</span>, <span class="st">".method_name"</span>, <span class="va">vary_params</span><span class="op">)</span>  <span class="co"># MODIFIED!</span></span>
<span>  <span class="va">eval_out</span> <span class="op">&lt;-</span> <span class="va">fit_results</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="op">{</span><span class="op">{</span><span class="va">group_vars</span><span class="op">}</span><span class="op">}</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>      `X1 Reject Prob.` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">`X1 p-value`</span> <span class="op">&lt;</span> <span class="va">alpha</span><span class="op">)</span>,</span>
<span>      `X2 Reject Prob.` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">`X2 p-value`</span> <span class="op">&lt;</span> <span class="va">alpha</span><span class="op">)</span>,</span>
<span>      .groups <span class="op">=</span> <span class="st">"keep"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">eval_out</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">reject_prob_eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_evaluator.html">create_evaluator</a></span><span class="op">(</span></span>
<span>  .eval_fun <span class="op">=</span> <span class="va">reject_prob_fun</span>, .name <span class="op">=</span> <span class="st">"Rejection Prob. (alpha = 0.1)"</span>,</span>
<span>  <span class="co"># additional named parameters to pass to .eval_fun()</span></span>
<span>  alpha <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Similarly in <code>power_plot_fun()</code>, we need to add <code>vary_params</code> as an input argument to plot the results across different values of <code>sigma</code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_plot_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fit_results</span>, <span class="va">vary_params</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">col</span> <span class="op">=</span> <span class="st">"X1"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fit_results</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">col</span>, <span class="st">"p-value"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                 color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">.method_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                         color <span class="op">=</span> <span class="st">"darkgray"</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ecdf.html" class="external-link">stat_ecdf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"t"</span>, y <span class="op">=</span> <span class="st">"P( p-value \u2264 t )"</span>,</span>
<span>                  linetype <span class="op">=</span> <span class="st">""</span>, color <span class="op">=</span> <span class="st">"Method"</span><span class="op">)</span></span>
<span>  <span class="co"># MODIFIED!</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">vary_params</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">plt</span> <span class="op">&lt;-</span> <span class="va">plt</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.data</span><span class="op">[[</span><span class="va">vary_params</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">plt</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">power_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_visualizer.html">create_visualizer</a></span><span class="op">(</span>.viz_fun <span class="op">=</span> <span class="va">power_plot_fun</span>, .name <span class="op">=</span> <span class="st">"Power"</span><span class="op">)</span></span></code></pre></div>
<p>Now, we are ready to update our experiment with the corrected <code>Evaluator</code> and <code>Visualizer</code> and run the experiment via:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vary_results</span> <span class="op">&lt;-</span> <span class="va">experiment</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/update_funs.html">update_evaluator</a></span><span class="op">(</span><span class="va">reject_prob_eval</span>, name <span class="op">=</span> <span class="st">"Rejection Prob. (alpha = 0.1)"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/update_funs.html">update_visualizer</a></span><span class="op">(</span><span class="va">power_plot</span>, name <span class="op">=</span> <span class="st">"Power"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">10</span>, save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Fitting Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Saving fit results...</span></span>
<span><span class="co">#&gt; Fit results saved | time taken: 0.046635 seconds</span></span>
<span><span class="co">#&gt; 10 reps completed (totals: 10/10) | time taken: 0.147674 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Evaluating Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Evaluation completed | time taken: 0.000099 minutes</span></span>
<span><span class="co">#&gt; Saving eval results...</span></span>
<span><span class="co">#&gt; Eval results saved | time taken: 0.028360 seconds</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Visualizing Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Visualization completed | time taken: 0.000178 minutes</span></span>
<span><span class="co">#&gt; Saving viz results...</span></span>
<span><span class="co">#&gt; Viz results saved | time taken: 0.102311 seconds</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="va">vary_results</span><span class="op">$</span><span class="va">fit_results</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 40 × 6</span></span></span>
<span><span class="co">#&gt;    .rep  .dgp_name           .method_name sigma `X1 p-value` `X2 p-value`</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1     Linear Gaussian DGP OLS              1     1.15<span style="color: #949494;">e</span><span style="color: #BB0000;">-36</span>       0.365 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1     Linear Gaussian DGP OLS              2     6.67<span style="color: #949494;">e</span><span style="color: #BB0000;">-10</span>       0.927 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1     Linear Gaussian DGP OLS              4     2.98<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span>       0.833 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1     Linear Gaussian DGP OLS              8     5.00<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>       0.267 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2     Linear Gaussian DGP OLS              1     1.07<span style="color: #949494;">e</span><span style="color: #BB0000;">-37</span>       0.719 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2     Linear Gaussian DGP OLS              2     3.43<span style="color: #949494;">e</span><span style="color: #BB0000;">-12</span>       0.398 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2     Linear Gaussian DGP OLS              4     3.35<span style="color: #949494;">e</span><span style="color: #BB0000;">- 5</span>       0.446 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2     Linear Gaussian DGP OLS              8     6.79<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>       0.058<span style="text-decoration: underline;">8</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 3     Linear Gaussian DGP OLS              1     2.89<span style="color: #949494;">e</span><span style="color: #BB0000;">-36</span>       0.933 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 3     Linear Gaussian DGP OLS              2     9.61<span style="color: #949494;">e</span><span style="color: #BB0000;">-13</span>       0.018<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 30 more rows</span></span></span>
<span><span class="va">vary_results</span><span class="op">$</span><span class="va">eval_results</span></span>
<span><span class="co">#&gt; $`Rejection Prob. (alpha = 0.1)`</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 5</span></span></span>
<span><span class="co">#&gt;   .dgp_name           .method_name sigma `X1 Reject Prob.` `X2 Reject Prob.`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Linear Gaussian DGP OLS              1               1                 0.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Linear Gaussian DGP OLS              2               1                 0.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Linear Gaussian DGP OLS              4               1                 0  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Linear Gaussian DGP OLS              8               0.3               0.1</span></span>
<span><span class="va">vary_results</span><span class="op">$</span><span class="va">viz_results</span></span>
<span><span class="co">#&gt; $Power</span></span></code></pre></div>
<p><img src="simChef-full_files/figure-html/vary-across-results-2-1.png" style="display: block; margin: auto;"></p>
<p>Note here we need to use <code>update_*</code> instead of <code>add_*</code> since an <code>Evaluator</code> named “Rejection Prob. (alpha = 0.1)” and a <code>Visualizer</code> named “Power” already exist in the <code>Experiment</code>. Using <code>add_*</code> will throw an error.</p>
</div>
<div class="section level3" number="1.3">
<h3 id="more-example-usages-with-varying-across-component">
<span class="header-section-number">1.3</span> More example usages with varying across component<a class="anchor" aria-label="anchor" href="#more-example-usages-with-varying-across-component"></a>
</h3>
<p>To further showcase the power of <code>simChef</code> and to provide additional examples, let’s add another plot (in fact, an interactive plot using <code><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html" class="external-link">plotly::ggplotly</a></code>) to our <code>Experiment</code> and run the <code>Experiment</code> (a) across various values of the coefficient <span class="math inline">\(\boldsymbol{\beta}_2\)</span> and (b) across the correlation <span class="math inline">\(\rho\)</span> between features in <span class="math inline">\(\mathbf{X}\)</span>.</p>
<p>Notes:</p>
<ul>
<li>The visualizer function below (<code>reject_prob_plot_fun</code>) takes in the <code>Evaluator</code> results, stored as <code>eval_results</code>, and plots the rejection probability for the <span class="math inline">\(\boldsymbol{\beta}_1\)</span> at <span class="math inline">\(\alpha = 0.1\)</span>.</li>
<li>In order to vary the coefficient <span class="math inline">\(\boldsymbol{\beta}_2\)</span>, we must specify this through the argument <code>beta</code>, which is vector-valued. To plot this vector-valued parameter on the x-axis (or any axis) in our plots, an additional pre-processing step must be performed since these values are not directly compatible with <code>ggplot</code>. Here, we leverage a built-in helper function <code><a href="../reference/list_col_to_chr.html">list_col_to_chr()</a></code>, which converts a list-type tibble column to a character-type tibble column that is amenable for plotting (unlike the list-type column). This preprocessing step using <code><a href="../reference/list_col_to_chr.html">list_col_to_chr()</a></code> is included in both <code>reject_prob_plot_fun()</code> and our updated version of <code>power_plot_fun()</code> below.</li>
<li>To reduce the computational burden in this vignette, we choose not to vary across multiple parameters simultaneously and instead, choose to vary only a single <code>DGP</code> argument in each run of the experiment (hence, the use of <code><a href="../reference/vary_across.html">remove_vary_across()</a></code> below).</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create rejection probability plot</span></span>
<span><span class="va">reject_prob_plot_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">eval_results</span>, <span class="va">vary_params</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">eval_name</span> <span class="op">&lt;-</span> <span class="st">"Rejection Prob. (alpha = 0.1)"</span></span>
<span>  <span class="va">eval_results_df</span> <span class="op">&lt;-</span> <span class="va">eval_results</span><span class="op">[[</span><span class="va">eval_name</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">eval_results_df</span><span class="op">[[</span><span class="va">vary_params</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># deal with the case when we vary across a parameter that is vector-valued</span></span>
<span>    <span class="va">eval_results_df</span><span class="op">[[</span><span class="va">vary_params</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/list_col_to_chr.html">list_col_to_chr</a></span><span class="op">(</span></span>
<span>      <span class="va">eval_results_df</span><span class="op">[[</span><span class="va">vary_params</span><span class="op">]</span><span class="op">]</span>, name <span class="op">=</span> <span class="va">vary_params</span>, verbatim <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">eval_results_df</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="va">vary_params</span><span class="op">]</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">`X1 Reject Prob.`</span>,</span>
<span>                 color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">.method_name</span><span class="op">)</span>,</span>
<span>                 fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">.method_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">vary_params</span>, y <span class="op">=</span> <span class="va">eval_name</span>, </span>
<span>                  color <span class="op">=</span> <span class="st">"Method"</span>, fill <span class="op">=</span> <span class="st">"Method"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">eval_results_df</span><span class="op">[[</span><span class="va">vary_params</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">plt</span> <span class="op">&lt;-</span> <span class="va">plt</span> <span class="op">+</span></span>
<span>      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">plt</span> <span class="op">&lt;-</span> <span class="va">plt</span> <span class="op">+</span></span>
<span>      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">plotly</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html" class="external-link">ggplotly</a></span><span class="op">(</span><span class="va">plt</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">reject_prob_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_visualizer.html">create_visualizer</a></span><span class="op">(</span></span>
<span>  .viz_fun <span class="op">=</span> <span class="va">reject_prob_plot_fun</span>, .name <span class="op">=</span> <span class="st">"Rejection Prob. (alpha = 0.1) Plot"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># update power plot to work for vector-valued vary_params</span></span>
<span><span class="va">power_plot_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fit_results</span>, <span class="va">vary_params</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">col</span> <span class="op">=</span> <span class="st">"X1"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">fit_results</span><span class="op">[[</span><span class="va">vary_params</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># deal with the case when we vary across a parameter that is vector-valued</span></span>
<span>    <span class="va">fit_results</span><span class="op">[[</span><span class="va">vary_params</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/list_col_to_chr.html">list_col_to_chr</a></span><span class="op">(</span></span>
<span>      <span class="va">fit_results</span><span class="op">[[</span><span class="va">vary_params</span><span class="op">]</span><span class="op">]</span>, name <span class="op">=</span> <span class="va">vary_params</span>, verbatim <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fit_results</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">col</span>, <span class="st">"p-value"</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                 color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">.method_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, intercept <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                         color <span class="op">=</span> <span class="st">"darkgray"</span>, linetype <span class="op">=</span> <span class="st">"solid"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ecdf.html" class="external-link">stat_ecdf</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"t"</span>, y <span class="op">=</span> <span class="st">"P( p-value \u2264 t )"</span>,</span>
<span>                  linetype <span class="op">=</span> <span class="st">""</span>, color <span class="op">=</span> <span class="st">"Method"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">vary_params</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">plt</span> <span class="op">&lt;-</span> <span class="va">plt</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.data</span><span class="op">[[</span><span class="va">vary_params</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">plt</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">power_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_visualizer.html">create_visualizer</a></span><span class="op">(</span>.viz_fun <span class="op">=</span> <span class="va">power_plot_fun</span>, .name <span class="op">=</span> <span class="st">"Power"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># update experiment</span></span>
<span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="va">experiment</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/update_funs.html">update_visualizer</a></span><span class="op">(</span><span class="va">power_plot</span>, name <span class="op">=</span> <span class="st">"Power"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_visualizer</a></span><span class="op">(</span><span class="va">reject_prob_plot</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># (a) run experiment across varying values of beta_2</span></span>
<span><span class="va">vary_beta2_results</span> <span class="op">&lt;-</span> <span class="va">experiment</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/vary_across.html">remove_vary_across</a></span><span class="op">(</span>dgp <span class="op">=</span> <span class="st">"Linear Gaussian DGP"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/vary_across.html">add_vary_across</a></span><span class="op">(</span></span>
<span>    .dgp <span class="op">=</span> <span class="st">"Linear Gaussian DGP"</span>,</span>
<span>    beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">10</span>, save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Fitting Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Saving fit results...</span></span>
<span><span class="co">#&gt; Fit results saved | time taken: 0.029902 seconds</span></span>
<span><span class="co">#&gt; 10 reps completed (totals: 10/10) | time taken: 0.180027 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Evaluating Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Evaluation completed | time taken: 0.000166 minutes</span></span>
<span><span class="co">#&gt; Saving eval results...</span></span>
<span><span class="co">#&gt; Eval results saved | time taken: 0.030001 seconds</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Visualizing Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Visualization completed | time taken: 0.002005 minutes</span></span>
<span><span class="co">#&gt; Saving viz results...</span></span>
<span><span class="co">#&gt; Viz results saved | time taken: 0.145333 seconds</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span></span>
<span><span class="co"># (b) run experiment across varying values of rho (correlation)</span></span>
<span><span class="va">vary_cor_results</span> <span class="op">&lt;-</span> <span class="va">experiment</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/vary_across.html">remove_vary_across</a></span><span class="op">(</span>dgp <span class="op">=</span> <span class="st">"Linear Gaussian DGP"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/vary_across.html">add_vary_across</a></span><span class="op">(</span>.dgp <span class="op">=</span> <span class="st">"Linear Gaussian DGP"</span>, rho <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">10</span>, save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Fitting Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Saving fit results...</span></span>
<span><span class="co">#&gt; Fit results saved | time taken: 0.030957 seconds</span></span>
<span><span class="co">#&gt; 10 reps completed (totals: 10/10) | time taken: 0.157227 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Evaluating Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Evaluation completed | time taken: 0.000100 minutes</span></span>
<span><span class="co">#&gt; Saving eval results...</span></span>
<span><span class="co">#&gt; Eval results saved | time taken: 0.031338 seconds</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Visualizing Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Visualization completed | time taken: 0.001362 minutes</span></span>
<span><span class="co">#&gt; Saving viz results...</span></span>
<span><span class="co">#&gt; Viz results saved | time taken: 0.147545 seconds</span></span>
<span><span class="co">#&gt; ==============================</span></span></code></pre></div>
<p>Rather than printing all results from these experiment runs here, let’s generate the R Markdown report summary:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/render_docs.html">render_docs</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></span></code></pre></div>
<p>The results can be found <a href="../linear_regression_output.html">here</a>.</p>
</div>
</div>
<div class="section level2" number="2">
<h2 id="simulation-experiment-templates-and-library">
<span class="header-section-number">2</span> Simulation experiment templates and library<a class="anchor" aria-label="anchor" href="#simulation-experiment-templates-and-library"></a>
</h2>
<p>In addition to the grammar of simulation experiments, <code>simChef</code> also offers a growing built-in library of composable building blocks and templates to meet common simulation needs.</p>
<div class="section level3" number="2.1">
<h3 id="boilerplate-code-templates">
<span class="header-section-number">2.1</span> Boilerplate code templates<a class="anchor" aria-label="anchor" href="#boilerplate-code-templates"></a>
</h3>
<p>In particular, we have created boilerplate code templates for running common types of simulation experiments, namely, those focused on prediction (regression and classification), feature selection, and inference. These templates provide (1) a quick starting point with Evaluators and Visualizers that are commonly used for the specified type of simulation experiment and (2) a concrete example of how to get started using functions from the <code>simChef</code> library.</p>
<p>In particular, we have implemented the following templates:</p>
<ul>
<li><code>use_prediction_template(type = "regression")</code></li>
<li><code>use_prediction_template(type = "classification")</code></li>
<li><code><a href="../reference/library_templates.html">use_feature_selection_template()</a></code></li>
<li><code><a href="../reference/library_templates.html">use_inference_template()</a></code></li>
</ul>
<p>These functions will print out code to the console that can be easily copied and/or run. For example,</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/library_templates.html">use_prediction_template</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"regression"</span><span class="op">)</span></span>
<span><span class="co">#&gt; dgp &lt;- create_dgp(</span></span>
<span><span class="co">#&gt;   .dgp_fun = stop('Add DGP function here.'),</span></span>
<span><span class="co">#&gt;   .name = stop('Add name of DGP here.'),</span></span>
<span><span class="co">#&gt;   stop('Add additional arguments (if necessary) to pass to DGP here.')</span></span>
<span><span class="co">#&gt; ) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; method &lt;- create_method(</span></span>
<span><span class="co">#&gt;   .method_fun = stop('Add Method function here.'),</span></span>
<span><span class="co">#&gt;   .name = stop('Add name of Method here.'),</span></span>
<span><span class="co">#&gt;   stop('Add additional arguments (if necessary) to pass to Method here.')</span></span>
<span><span class="co">#&gt; ) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; nested_pred_cols &lt;- stop('(Optional) Add name of column in `fit_results` with prediction result columns to be unnested.')</span></span>
<span><span class="co">#&gt; true_pred_col &lt;- stop('Add name of column in `fit_results` with true responses here.')</span></span>
<span><span class="co">#&gt; est_pred_col &lt;- stop('Add name of column in `fit_results` with the predicted responses here.')</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; pred_err &lt;- create_evaluator(</span></span>
<span><span class="co">#&gt;   .eval_fun = summarize_pred_err,</span></span>
<span><span class="co">#&gt;   .name = 'Prediction Accuracy',</span></span>
<span><span class="co">#&gt;   nested_cols = nested_pred_cols,</span></span>
<span><span class="co">#&gt;   truth_col = true_pred_col,</span></span>
<span><span class="co">#&gt;   estimate_col = est_pred_col</span></span>
<span><span class="co">#&gt; ) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; pred_err_plot &lt;- create_visualizer(</span></span>
<span><span class="co">#&gt;   .viz_fun = plot_pred_err,</span></span>
<span><span class="co">#&gt;   .name = 'Prediction Accuracy Plot',</span></span>
<span><span class="co">#&gt;   eval_name = 'Prediction Accuracy'</span></span>
<span><span class="co">#&gt; ) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; experiment &lt;- create_experiment(name = 'Prediction Experiment') |&gt; </span></span>
<span><span class="co">#&gt;   add_dgp(dgp) |&gt; </span></span>
<span><span class="co">#&gt;   add_method(method) |&gt; </span></span>
<span><span class="co">#&gt;   add_evaluator(pred_err) |&gt; </span></span>
<span><span class="co">#&gt;   add_visualizer(pred_err_plot) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; init_docs(experiment)  #&gt; fill out documentation before proceeding!</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; results &lt;- run_experiment(</span></span>
<span><span class="co">#&gt;   experiment = experiment,</span></span>
<span><span class="co">#&gt;   n_reps = stop('Add number of replicates here.'),</span></span>
<span><span class="co">#&gt;   save = TRUE</span></span>
<span><span class="co">#&gt; ) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; render_docs(experiment)</span></span></code></pre></div>
<p>For more guidance, we can also include concrete examples of a DGP and Method via:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/library_templates.html">use_prediction_template</a></span><span class="op">(</span></span>
<span>  type <span class="op">=</span> <span class="st">"regression"</span>, include_dgp_example <span class="op">=</span> <span class="cn">TRUE</span>, include_method_example <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; if (!require('dplyr')) install.packages('dplyr')</span></span>
<span><span class="co">#&gt; if (!require('purrr')) install.packages('purrr')</span></span>
<span><span class="co">#&gt; if (!require('ranger')) install.packages('ranger')</span></span>
<span><span class="co">#&gt;  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; gaussian_linear_dgp &lt;- function (n, p, beta = 1, err_sd = 1, data_split = TRUE, train_prop = 0.5, </span></span>
<span><span class="co">#&gt;     return_support = TRUE) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     X &lt;- matrix(stats::rnorm(n * p), nrow = n, ncol = p)</span></span>
<span><span class="co">#&gt;     beta_vec &lt;- matrix(beta, ncol = 1, nrow = p)</span></span>
<span><span class="co">#&gt;     y &lt;- X %*% beta_vec + stats::rnorm(n = n, sd = err_sd)</span></span>
<span><span class="co">#&gt;     if (data_split) {</span></span>
<span><span class="co">#&gt;         train_ids &lt;- sample(1:n, size = round(n * train_prop))</span></span>
<span><span class="co">#&gt;         Xtest &lt;- X[-train_ids, , drop = FALSE]</span></span>
<span><span class="co">#&gt;         ytest &lt;- y[-train_ids]</span></span>
<span><span class="co">#&gt;         X &lt;- X[train_ids, , drop = FALSE]</span></span>
<span><span class="co">#&gt;         y &lt;- y[train_ids]</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     else {</span></span>
<span><span class="co">#&gt;         Xtest &lt;- NULL</span></span>
<span><span class="co">#&gt;         ytest &lt;- NULL</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     if (return_support) {</span></span>
<span><span class="co">#&gt;         support &lt;- which(beta_vec != 0)</span></span>
<span><span class="co">#&gt;         out &lt;- list(X = X, y = y, Xtest = Xtest, ytest = ytest, </span></span>
<span><span class="co">#&gt;             support = support)</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     else {</span></span>
<span><span class="co">#&gt;         out &lt;- list(X = X, y = y, Xtest = Xtest, ytest = ytest)</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     return(out)</span></span>
<span><span class="co">#&gt; } </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; dgp &lt;- create_dgp(</span></span>
<span><span class="co">#&gt;   .dgp_fun = gaussian_linear_dgp,</span></span>
<span><span class="co">#&gt;   .name = 'Example DGP (Uncorrelated Gaussian Linear DGP)',</span></span>
<span><span class="co">#&gt;   n = 200,</span></span>
<span><span class="co">#&gt;   p = 10,</span></span>
<span><span class="co">#&gt;   beta = c(1, 1, 1, 1, 1, 0, 0, 0, 0, 0),</span></span>
<span><span class="co">#&gt;   err_sd = 1,</span></span>
<span><span class="co">#&gt;   data_split = TRUE,</span></span>
<span><span class="co">#&gt;   train_prop = 0.5,</span></span>
<span><span class="co">#&gt;   return_support = TRUE</span></span>
<span><span class="co">#&gt; ) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; rf_method &lt;- function (X, y, Xtest, ytest, support, ...) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     data &lt;- cbind(as.data.frame(X), .y = y)</span></span>
<span><span class="co">#&gt;     if (is.factor(y)) {</span></span>
<span><span class="co">#&gt;         mtry &lt;- round(sqrt(ncol(X)))</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     else {</span></span>
<span><span class="co">#&gt;         mtry &lt;- round(ncol(X)/3)</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     fit &lt;- ranger::ranger(data = data, dependent.variable.name = ".y", </span></span>
<span><span class="co">#&gt;         importance = "impurity", mtry = mtry, num.threads = 1, </span></span>
<span><span class="co">#&gt;         ...)</span></span>
<span><span class="co">#&gt;     preds &lt;- stats::predict(fit, as.data.frame(Xtest))$predictions</span></span>
<span><span class="co">#&gt;     if (is.factor(y)) {</span></span>
<span><span class="co">#&gt;         k &lt;- nlevels(y)</span></span>
<span><span class="co">#&gt;         prob_preds &lt;- stats::predict(fit, as.data.frame(Xtest), </span></span>
<span><span class="co">#&gt;             predict.all = TRUE, num.threads = 1)$predictions</span></span>
<span><span class="co">#&gt;         prob_preds &lt;- dplyr::select(stats::setNames(purrr::list_rbind(purrr::map(1:nrow(prob_preds), </span></span>
<span><span class="co">#&gt;             function(i) {</span></span>
<span><span class="co">#&gt;                 x &lt;- factor(prob_preds[i, ], levels = 1:k)</span></span>
<span><span class="co">#&gt;                 tibble::as_tibble_row(c(prop.table(table(x))))</span></span>
<span><span class="co">#&gt;             })), levels(y)), -1)</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     else {</span></span>
<span><span class="co">#&gt;         prob_preds &lt;- NULL</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     p &lt;- ncol(X)</span></span>
<span><span class="co">#&gt;     if (is.null(colnames(X))) {</span></span>
<span><span class="co">#&gt;         features &lt;- 1:p</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     else {</span></span>
<span><span class="co">#&gt;         features &lt;- colnames(X)</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     out &lt;- list(y = ytest, predictions = preds, prob_predictions = prob_preds, </span></span>
<span><span class="co">#&gt;         support_df = data.frame(feature = features, true_support = 1:p %in% </span></span>
<span><span class="co">#&gt;             support, imp = fit$variable.importance, selected = fit$variable.importance &gt; </span></span>
<span><span class="co">#&gt;             mean(fit$variable.importance)))</span></span>
<span><span class="co">#&gt;     return(out)</span></span>
<span><span class="co">#&gt; } </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; method &lt;- create_method(</span></span>
<span><span class="co">#&gt;   .method_fun = rf_method,</span></span>
<span><span class="co">#&gt;   .name = 'RF'</span></span>
<span><span class="co">#&gt; ) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; nested_pred_cols &lt;- c('y', 'predictions', 'prob_predictions')  # prediction results columns to be unnested</span></span>
<span><span class="co">#&gt; true_pred_col &lt;- 'y'  # true response column</span></span>
<span><span class="co">#&gt; est_pred_col &lt;- 'predictions'  # predicted response column</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; pred_err &lt;- create_evaluator(</span></span>
<span><span class="co">#&gt;   .eval_fun = summarize_pred_err,</span></span>
<span><span class="co">#&gt;   .name = 'Prediction Accuracy',</span></span>
<span><span class="co">#&gt;   nested_cols = nested_pred_cols,</span></span>
<span><span class="co">#&gt;   truth_col = true_pred_col,</span></span>
<span><span class="co">#&gt;   estimate_col = est_pred_col</span></span>
<span><span class="co">#&gt; ) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; pred_err_plot &lt;- create_visualizer(</span></span>
<span><span class="co">#&gt;   .viz_fun = plot_pred_err,</span></span>
<span><span class="co">#&gt;   .name = 'Prediction Accuracy Plot',</span></span>
<span><span class="co">#&gt;   eval_name = 'Prediction Accuracy'</span></span>
<span><span class="co">#&gt; ) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; experiment &lt;- create_experiment(name = 'Prediction Experiment') |&gt; </span></span>
<span><span class="co">#&gt;   add_dgp(dgp) |&gt; </span></span>
<span><span class="co">#&gt;   add_method(method) |&gt; </span></span>
<span><span class="co">#&gt;   add_evaluator(pred_err) |&gt; </span></span>
<span><span class="co">#&gt;   add_visualizer(pred_err_plot) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; init_docs(experiment)  #&gt; fill out documentation before proceeding!</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; results &lt;- run_experiment(</span></span>
<span><span class="co">#&gt;   experiment = experiment,</span></span>
<span><span class="co">#&gt;   n_reps = stop('Add number of replicates here.'),</span></span>
<span><span class="co">#&gt;   save = TRUE</span></span>
<span><span class="co">#&gt; ) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; render_docs(experiment)</span></span></code></pre></div>
<p>A complete list of boilerplate templates can be found <a href="https://yu-group.github.io/simChef/reference/index.html#boilerplate-templates">here</a>.</p>
</div>
<div class="section level3" number="2.2">
<h3 id="library-of-dgps-evaluators-and-visualizers">
<span class="header-section-number">2.2</span> Library of DGPs, Evaluators, and Visualizers<a class="anchor" aria-label="anchor" href="#library-of-dgps-evaluators-and-visualizers"></a>
</h3>
<p>Beyond these templates, there is also a growing library of built-in evaluation metrics, visualization utilities, and other helper developer functions within <code>simChef</code>.
These built-in functions can sometimes greatly reduce the amount of user-written code in Step 1 (from Section <a href="#basic-example-usage">1.1</a>).
For more information on available functions in this built-in library, please see the following:</p>
<ul>
<li><a href="https://yu-group.github.io/simChef/reference/index.html#evaluator-library-prediction">Evaluator library</a></li>
<li><a href="https://yu-group.github.io/simChef/reference/index.html#visualizer-library-prediction">Visualizer library</a></li>
<li><a href="https://yu-group.github.io/simChef/reference/index.html#developer-functions">Developer library</a></li>
</ul>
<p>A library of DGPs is in the works as part of the <a href="https://yu-group.github.io/dgpoix/" class="external-link"><code>dgpoix</code></a> R package (currently, in very early development stages).</p>
</div>
</div>
<div class="section level2" number="3">
<h2 id="tools-for-faster-development-and-computation-of-simulation-experiments">
<span class="header-section-number">3</span> Tools for faster development and computation of simulation experiments<a class="anchor" aria-label="anchor" href="#tools-for-faster-development-and-computation-of-simulation-experiments"></a>
</h2>
<div class="section level3" number="3.1">
<h3 id="parallelization">
<span class="header-section-number">3.1</span> Parallelization<a class="anchor" aria-label="anchor" href="#parallelization"></a>
</h3>
<p>Given the large amount of computation that simulation studies require, one of the main goals of <code>simChef</code> is to make it easy to parallelize your simulations.
<code>simChef</code> uses the R package <a href="https://future.futureverse.org/" class="external-link"><code>future</code></a> to distribute simulation replicates across whatever available resources the user specifies.
All you have to do to start running your simulations in parallel is set the <code>future</code> plan before calling <code><a href="../reference/run_experiment.html">run_experiment()</a></code>:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_workers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://parallelly.futureverse.org/reference/availableCores.html" class="external-link">availableCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="va">n_workers</span><span class="op">)</span></span></code></pre></div>
<p>For more information on parallelization, please refer to <a href="parallel.html">Computing experimental replicates in parallel</a>.</p>
</div>
<div class="section level3" number="3.2">
<h3 id="caching">
<span class="header-section-number">3.2</span> Caching<a class="anchor" aria-label="anchor" href="#caching"></a>
</h3>
<p>To reduce redundant computations, one may want to avoid re-running previously computed and saved components of an <code>Experiment</code>.
This can be done by setting the argument <code>use_cached</code> to <code>TRUE</code> in <code><a href="../reference/run_experiment.html">run_experiment()</a></code>.
More specifically, when an <code>Experiment</code> is run with <code>use_cached = TRUE</code>, all previously cached results (i.e., those that have been previously saved to disk with <code>save = TRUE</code>) are loaded in and checked if their corresponding <code>Experiment</code> matches the configurations of the current <code>Experiment</code>.
If the cached <code>Experiment</code> configurations match that of the current <code>Experiment</code>, the cached results are used and only the uncached components of the <code>Experiment</code> are run.</p>
<p>As an example, let us run the following experiment and save its results.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_experiment.html">create_experiment</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Linear Regression Experiment"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_dgp</a></span><span class="op">(</span><span class="va">linear_dgp</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_method</a></span><span class="op">(</span><span class="va">lm_method</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_evaluator</a></span><span class="op">(</span><span class="va">reject_prob_eval</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_visualizer</a></span><span class="op">(</span><span class="va">power_plot</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_visualizer</a></span><span class="op">(</span><span class="va">reject_prob_plot</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/vary_across.html">add_vary_across</a></span><span class="op">(</span>.dgp <span class="op">=</span> <span class="st">"Linear Gaussian DGP"</span>, sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">orig_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span><span class="va">experiment</span>, n_reps <span class="op">=</span> <span class="fl">10</span>, save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Fitting Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Saving fit results...</span></span>
<span><span class="co">#&gt; Fit results saved | time taken: 0.035465 seconds</span></span>
<span><span class="co">#&gt; 10 reps completed (totals: 10/10) | time taken: 0.218098 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Evaluating Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Evaluation completed | time taken: 0.000098 minutes</span></span>
<span><span class="co">#&gt; Saving eval results...</span></span>
<span><span class="co">#&gt; Eval results saved | time taken: 0.022480 seconds</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Visualizing Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Visualization completed | time taken: 0.001094 minutes</span></span>
<span><span class="co">#&gt; Saving viz results...</span></span>
<span><span class="co">#&gt; Viz results saved | time taken: 0.137255 seconds</span></span>
<span><span class="co">#&gt; ==============================</span></span></code></pre></div>
<p>When setting <code>use_cached = TRUE</code>, the following line of code will not generate any new results but will instead read in the saved or cached results from disk.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cached_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span><span class="va">experiment</span>, n_reps <span class="op">=</span> <span class="fl">10</span>, use_cached <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading in cached fit results...</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Reading in cached eval results...</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Reading in cached viz results...</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">cached_results</span>, <span class="va">orig_results</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>We can also choose to read in a smaller number of the cached replicates,</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">smaller_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span><span class="va">experiment</span>, n_reps <span class="op">=</span> <span class="fl">5</span>, use_cached <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading in cached fit results...</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Evaluating Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Evaluation completed | time taken: 0.000101 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Visualizing Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Visualization completed | time taken: 0.001082 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>  <span class="va">smaller_results</span><span class="op">$</span><span class="va">fit_results</span>,</span>
<span>  <span class="va">orig_results</span><span class="op">$</span><span class="va">fit_results</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">.rep</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>or increase the number of replicates without re-doing computation for the previously cached replicates.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">larger_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span><span class="va">experiment</span>, n_reps <span class="op">=</span> <span class="fl">15</span>, use_cached <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading in cached fit results...</span></span>
<span><span class="co">#&gt; Fitting Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; 5 reps completed (totals: 15/15) | time taken: 0.117192 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Evaluating Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Evaluation completed | time taken: 0.000100 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Visualizing Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Visualization completed | time taken: 0.001081 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>  <span class="va">larger_results</span><span class="op">$</span><span class="va">fit_results</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">.rep</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>  <span class="va">orig_results</span><span class="op">$</span><span class="va">fit_results</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>In addition, caching works when adding or modifying components of an <code>Experiment</code>.
In the following, we add a new <code>DGP</code> to the <code>Experiment</code>.
As a result, when we run the <code>Experiment</code> with <code>use_cached = TRUE</code>, only the replicates involving the new <code>DGP</code> are run while the replicates involving the old <code>DGP</code> (i.e., the <code>Linear Gaussian DGP</code>) are loaded in from the cache.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_dgp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dgp.html">create_dgp</a></span><span class="op">(</span></span>
<span>  .dgp_fun <span class="op">=</span> <span class="va">linear_dgp_fun</span>, .name <span class="op">=</span> <span class="st">"Linear Gaussian DGP (large n)"</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">500</span>, beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, rho <span class="op">=</span> <span class="fl">0</span>, sigma <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="va">experiment</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_dgp</a></span><span class="op">(</span><span class="va">new_dgp</span><span class="op">)</span></span>
<span><span class="va">new_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span><span class="va">experiment</span>, n_reps <span class="op">=</span> <span class="fl">10</span>, use_cached <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Fitting Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Reading in cached fit results...</span></span>
<span><span class="co">#&gt; Appending cached results to the new fit results...</span></span>
<span><span class="co">#&gt; 10 reps completed (totals: 10/10) | time taken: 0.080150 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Evaluating Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Evaluation completed | time taken: 0.000107 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Visualizing Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Visualization completed | time taken: 0.001238 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span></span>
<span>  <span class="va">new_results</span><span class="op">$</span><span class="va">fit_results</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.dgp_name</span> <span class="op">==</span> <span class="st">"Linear Gaussian DGP"</span><span class="op">)</span>,</span>
<span>  <span class="va">orig_results</span><span class="op">$</span><span class="va">fit_results</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Note that since we did not save the <code>Experiment</code> results above, then the following will recompute the replicates corresponding to the new <code>DGP</code>. Please set <code>save = TRUE</code> in order to cache the results for future use.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_results2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span><span class="va">experiment</span>, n_reps <span class="op">=</span> <span class="fl">10</span>, use_cached <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Fitting Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Reading in cached fit results...</span></span>
<span><span class="co">#&gt; Appending cached results to the new fit results...</span></span>
<span><span class="co">#&gt; 10 reps completed (totals: 10/10) | time taken: 0.080675 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Evaluating Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Evaluation completed | time taken: 0.000099 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; Visualizing Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Visualization completed | time taken: 0.001115 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span></code></pre></div>
<p>Some other helpful functions regarding caching include:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># to load in the cached fit results for an experiment</span></span>
<span><span class="va">fit_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cached_results.html">get_cached_results</a></span><span class="op">(</span><span class="va">experiment</span>, <span class="st">"fit"</span><span class="op">)</span></span>
<span><span class="co"># to load in the cached evaluation results for an experiment</span></span>
<span><span class="va">eval_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cached_results.html">get_cached_results</a></span><span class="op">(</span><span class="va">experiment</span>, <span class="st">"eval"</span><span class="op">)</span></span>
<span><span class="co"># to load in the cached visualization results for an experiment</span></span>
<span><span class="va">viz_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cached_results.html">get_cached_results</a></span><span class="op">(</span><span class="va">experiment</span>, <span class="st">"viz"</span><span class="op">)</span></span>
<span><span class="co"># to load in the cached Experiment object</span></span>
<span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cached_results.html">get_cached_results</a></span><span class="op">(</span><span class="va">experiment</span>, <span class="st">"experiment"</span><span class="op">)</span></span>
<span><span class="co"># to load in the Experiment parameters corresponding to the cached *_results</span></span>
<span><span class="va">cached_exp_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cached_results.html">get_cached_results</a></span><span class="op">(</span><span class="va">experiment</span>, <span class="st">"experiment_cached_params"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># to clear the cache</span></span>
<span><span class="fu"><a href="../reference/clear_cache.html">clear_cache</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="3.3">
<h3 id="checkpointing">
<span class="header-section-number">3.3</span> Checkpointing<a class="anchor" aria-label="anchor" href="#checkpointing"></a>
</h3>
<p>A checkpoint is a periodic snapshot of the simulation results, saved to disk.
Checkpoints help guard against lost progress in the case of unexpected problems, such as node failures when running on a cluster, at the cost of longer simulation running times.
Checkpoints are most useful for long-running simulations where the cost of creating the checkpoints is small relative to the total cost of the simulation.
As a result, users should be careful not to create checkpoints more often than necessary.</p>
<p>To enable checkpointing, use a positive value for the argument <code>checkpoint_n_reps</code> passed to <code><a href="../reference/run_experiment.html">run_experiment()</a></code>.
Below is an artificial example in which we use checkpointing and encounter errors as the simulation progresses past the first checkpoint:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counter</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># a DGP which returns an error on its 26th call (i.e., when counter hits 26)</span></span>
<span><span class="va">checkpoint_dgp_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">counter</span> <span class="op">&lt;&lt;-</span> <span class="va">counter</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">counter</span> <span class="op">==</span> <span class="fl">26</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Unexpected error!"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">checkpoint_dgp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dgp.html">create_dgp</a></span><span class="op">(</span><span class="va">checkpoint_dgp_fun</span>, .name <span class="op">=</span> <span class="st">"Checkpoint DGP"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a toy Method</span></span>
<span><span class="va">checkpoint_method_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"result"</span><span class="op">)</span></span>
<span><span class="va">checkpoint_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_method.html">create_method</a></span><span class="op">(</span><span class="va">checkpoint_method_fun</span>, .name <span class="op">=</span> <span class="st">"Method"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create checkpoint experiment</span></span>
<span><span class="va">checkpoint_experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_experiment.html">create_experiment</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"checkpoint-exper"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_dgp</a></span><span class="op">(</span><span class="va">checkpoint_dgp</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_method</a></span><span class="op">(</span><span class="va">checkpoint_method</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run 100 reps, checkpointing every 25 reps, though it should return an error</span></span>
<span><span class="va">checkpoint_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span></span>
<span>  <span class="va">checkpoint_experiment</span>, n_reps <span class="op">=</span> <span class="fl">100</span>, checkpoint_n_reps <span class="op">=</span> <span class="fl">25</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Fitting checkpoint-exper...</span></span>
<span><span class="co">#&gt; Saving fit results checkpoint...</span></span>
<span><span class="co">#&gt; Fit results saved | time taken: 0.015790 seconds</span></span>
<span><span class="co">#&gt; 25 reps completed (totals: 25/100) | time taken: 0.200792 minutes</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `self$fit()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Error(s) encountered while running the simulation, including:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Unexpected error!</span></span>
<span><span class="co">#&gt; The above error occurred while processing "Checkpoint DGP" (params empty).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Run `rlang::last_error()$partial_results`to return partial simulation results.</span></span>
<span><span class="co">#&gt; Run `rlang::last_error()$errors` to inspect each error, along with the params,</span></span>
<span><span class="co">#&gt;   `DGP`, `Method`, and inputs/outputs before the error occurred.</span></span></code></pre></div>
<p>Since a full 25 replicates completed before the simulation failed, the first checkpoint was successful.
You can use <code>get_cached_results(checkpoint_experiment, "fit")</code> to examine the completed replicates, or simply continue the simulation using the same code you already ran (since the error will not be returned again by design).</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">checkpoint_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span></span>
<span>  <span class="va">checkpoint_experiment</span>, n_reps <span class="op">=</span> <span class="fl">100</span>, checkpoint_n_reps <span class="op">=</span> <span class="fl">25</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading in cached fit results...</span></span>
<span><span class="co">#&gt; Fitting checkpoint-exper...</span></span>
<span><span class="co">#&gt; Saving fit results checkpoint...</span></span>
<span><span class="co">#&gt; Fit results saved | time taken: 0.026841 seconds</span></span>
<span><span class="co">#&gt; 25 reps completed (totals: 50/100) | time taken: 0.202223 minutes</span></span>
<span><span class="co">#&gt; Saving fit results checkpoint...</span></span>
<span><span class="co">#&gt; Fit results saved | time taken: 0.026854 seconds</span></span>
<span><span class="co">#&gt; 25 reps completed (totals: 75/100) | time taken: 0.404212 minutes</span></span>
<span><span class="co">#&gt; Saving fit results...</span></span>
<span><span class="co">#&gt; Fit results saved | time taken: 0.026655 seconds</span></span>
<span><span class="co">#&gt; 25 reps completed (totals: 100/100) | time taken: 0.606401 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; No evaluators to evaluate. Skipping evaluation.</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="co">#&gt; No visualizers to visualize. Skipping visualization.</span></span>
<span><span class="co">#&gt; ==============================</span></span></code></pre></div>
</div>
<div class="section level3" number="3.4">
<h3 id="error-debugging">
<span class="header-section-number">3.4</span> Error debugging<a class="anchor" aria-label="anchor" href="#error-debugging"></a>
</h3>
<p>In the event of an error, <code>simChef</code> makes it possible to both retrieve results from completed replicates (before the error occurred) and to gracefully debug errors in user-defined functions. For the sake of demonstration, let us create an artificial example.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create experiment</span></span>
<span><span class="va">dgp_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span>
<span><span class="va">dgp_fun_err</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Uh oh!"</span><span class="op">)</span> <span class="op">}</span></span>
<span><span class="va">dgp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dgp.html">create_dgp</a></span><span class="op">(</span><span class="va">dgp_fun</span>, .name <span class="op">=</span> <span class="st">"Working DGP"</span><span class="op">)</span></span>
<span><span class="va">dgp_err</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dgp.html">create_dgp</a></span><span class="op">(</span><span class="va">dgp_fun_err</span>, .name <span class="op">=</span> <span class="st">"Buggy DGP"</span><span class="op">)</span></span>
<span><span class="va">method_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"result"</span><span class="op">)</span></span>
<span><span class="va">method</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_method.html">create_method</a></span><span class="op">(</span><span class="va">method_fun</span>, .name <span class="op">=</span> <span class="st">"Method"</span><span class="op">)</span></span>
<span><span class="va">buggy_experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_experiment.html">create_experiment</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"debugging-exper"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_dgp</a></span><span class="op">(</span><span class="va">dgp</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_dgp</a></span><span class="op">(</span><span class="va">dgp_err</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_method</a></span><span class="op">(</span><span class="va">method</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run experiment though it should return an error</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span><span class="va">buggy_experiment</span>, n_reps <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Fitting debugging-exper...</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `self$fit()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Error(s) encountered while running the simulation, including:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Uh oh!</span></span>
<span><span class="co">#&gt; The above error occurred while processing "Buggy DGP" (params empty).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Run `rlang::last_error()$partial_results`to return partial simulation results.</span></span>
<span><span class="co">#&gt; Run `rlang::last_error()$errors` to inspect each error, along with the params,</span></span>
<span><span class="co">#&gt;   `DGP`, `Method`, and inputs/outputs before the error occurred.</span></span></code></pre></div>
<p>If working interactively, the error can be inspected using the usual call to <code><a href="https://rlang.r-lib.org/reference/last_error.html" class="external-link">rlang::last_error()</a></code>. Results that were run and completed before the error can be recovered via <code>rlang::last_error()$partial_results</code> and you can find errors that occurred within the simulation loop via <code>rlang::last_error()$errors</code>.</p>
<p>Alternatively, we can wrap the call that ran the error (in this case, <code><a href="../reference/run_experiment.html">run_experiment()</a></code>) in <code><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch()</a></code> as follows:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/run_experiment.html">run_experiment</a></span><span class="op">(</span><span class="va">buggy_experiment</span>, n_reps <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  error <span class="op">=</span> <span class="va">identity</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Fitting debugging-exper...</span></span>
<span><span class="va">results</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">&lt;error/simChef_error&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in </span><span style="color: #5555FF; font-weight: bold;">`self$fit()`</span><span style="font-weight: bold;">:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Error(s) encountered while running the simulation, including:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Uh oh!</span></span>
<span><span class="co">#&gt; The above error occurred while processing "Buggy DGP" (params empty).</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Run `rlang::last_error()$partial_results`to return partial simulation results.</span></span>
<span><span class="co">#&gt; Run `rlang::last_error()$errors` to inspect each error, along with the params,</span></span>
<span><span class="co">#&gt;   `DGP`, `Method`, and inputs/outputs before the error occurred.</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Backtrace:</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">    </span>▆</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> 1. </span>├─<span style="font-weight: bold;">base</span>::tryCatch(...)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> 2. </span>│ <span style="color: #949494;">└─base (local) tryCatchList(expr, classes, parentenv, handlers)</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> 3. </span>│   <span style="color: #949494;">└─base (local) tryCatchOne(expr, names, parentenv, handlers[[1L]])</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> 4. </span>│     <span style="color: #949494;">└─base (local) doTryCatch(return(expr), name, parentenv, handler)</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> 5. </span>└─<span style="font-weight: bold;">simChef</span>::run_experiment(buggy_experiment, n_reps = 2)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> 6. </span>  └─experiment$run(...)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> 7. </span>    └─<span style="color: #5555FF; font-weight: bold;">self$fit(...)</span></span></span></code></pre></div>
<p>From this, we can view the results that were completed before we ran into the error via</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="va">partial_results</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">#&gt;   .rep  .dgp_name   .method_name result1</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1     Working DGP Method       result</span></span></code></pre></div>
<p>and extract the error object(s) via</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">$</span><span class="va">errors</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 11</span></span></span>
<span><span class="co">#&gt;   .rep  .dgp   .dgp_name .dgp_params .method .method_name .method_params .method_output .err        .pid .gc          </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1     <span style="color: #949494;">&lt;DGP&gt;</span>  Buggy DGP <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span>             <span style="color: #949494;">&lt;smChf_rr&gt;</span> <span style="text-decoration: underline;">15</span>256 <span style="color: #949494;">&lt;dbl [2 × 6]&gt;</span></span></span></code></pre></div>
<p>Note that the error tibble contains the <code>DGP</code> and <code>Method</code> (if the <code>DGP</code> was not the error cause) that were being processed when the error occurred in the <code>.dgp</code> and <code>.method</code> columns, respectively.
The corresponding input parameters are in the <code>.dgp_params</code> and <code>.method_params</code> columns (both <code>NA</code> here since no parameters were varied in the experiment).
Finally, the captured error itself is in the <code>.err</code> column.
Using this, we can easily investigate and reproduce the error and if desired, work directly with the user-specified function that raised the error, e.g.,</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get dgp that ran the error</span></span>
<span><span class="va">err_fun</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">errors</span><span class="op">$</span><span class="va">.dgp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">dgp_fun</span></span>
<span><span class="co"># reproduce error via a direct call to the DGP function that raised the error</span></span>
<span><span class="fu">err_fun</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in err_fun(): Uh oh!</span></span></code></pre></div>
</div>
</div>
<div class="section level2" number="4">
<h2 id="r-markdown-documentation">
<span class="header-section-number">4</span> R Markdown documentation<a class="anchor" aria-label="anchor" href="#r-markdown-documentation"></a>
</h2>
<p>One of the key features of <code>simChef</code> is the ease of generating an R Markdown report via <code><a href="../reference/render_docs.html">render_docs()</a></code> as shown below. This automated documentation gathers the scientific details, summary tables, and plots side-by-side with the user’s custom source code and parameters for DGPs, methods, evaluation metrics, and visualization procedures.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/render_docs.html">render_docs</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></span></code></pre></div>
<p>To be more precise, this call to <code>render_docs(experiment)</code> will compile the documentation and results (both evaluation and visualization results) from all saved <code>Experiments</code> under the experiment’s root results directory (specified by <code>get_save_dir(experiment)</code>).</p>
<p>Equivalently, we can create the same R Markdown report summary by directly specifying the experiment’s root results directory.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/render_docs.html">render_docs</a></span><span class="op">(</span>save_dir <span class="op">=</span> <span class="fu"><a href="../reference/get_save_dir.html">get_save_dir</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3" number="4.1">
<h3 id="customizing-document-options-for-evaluators-and-visualizers">
<span class="header-section-number">4.1</span> Customizing document options for Evaluators and Visualizers<a class="anchor" aria-label="anchor" href="#customizing-document-options-for-evaluators-and-visualizers"></a>
</h3>
<p>There are several options to customize the aesthetics of <code>Evaluators</code> and <code>Visualizers</code> displayed in the R Markdown report.
These can be set using the <code>.doc_options</code> argument in <code><a href="../reference/create_evaluator.html">create_evaluator()</a></code> and <code><a href="../reference/create_visualizer.html">create_visualizer()</a></code>.
For example, we can customize the height and width of the Power plot via</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">power_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_visualizer.html">create_visualizer</a></span><span class="op">(</span></span>
<span>  .viz_fun <span class="op">=</span> <span class="va">power_plot_fun</span>, .name <span class="op">=</span> <span class="st">"Power"</span>,</span>
<span>  .doc_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">10</span>, width <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="va">experiment</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/update_funs.html">update_visualizer</a></span><span class="op">(</span><span class="va">power_plot</span>, name <span class="op">=</span> <span class="st">"Power"</span><span class="op">)</span></span></code></pre></div>
<p>and the number of digits in the evaluation table outputs via</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reject_prob_eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_evaluator.html">create_evaluator</a></span><span class="op">(</span></span>
<span>  .eval_fun <span class="op">=</span> <span class="va">reject_prob_fun</span>, .name <span class="op">=</span> <span class="st">"Rejection Prob. (alpha = 0.1)"</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.1</span>, .doc_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="va">experiment</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/update_funs.html">update_evaluator</a></span><span class="op">(</span><span class="va">reject_prob_eval</span>, name <span class="op">=</span> <span class="st">"Rejection Prob. (alpha = 0.1)"</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, <code><a href="../reference/set_doc_options.html">set_doc_options()</a></code> can be used to update the R Markdown option for an existing object, e.g.,</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="va">experiment</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_doc_options.html">set_doc_options</a></span><span class="op">(</span></span>
<span>    field_name <span class="op">=</span> <span class="st">"visualizer"</span>, name <span class="op">=</span> <span class="st">"Power"</span>, height <span class="op">=</span> <span class="fl">10</span>, width <span class="op">=</span> <span class="fl">8</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="../reference/save_experiment.html">save_experiment</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></span></code></pre></div>
<p>To hide the output of an <code>Evaluator</code> or <code>Visualizer</code> in the R Markdown report, use <code>set_doc_options(show = FALSE, ...)</code> or <code>create_*(.doc_show = FALSE, ...)</code>.
Moreover, for an <code>Evaluator</code>, the maximum number of rows to display in the R Markdown report can be set via <code>set_doc_options(nrows = 10, ...)</code> or <code>create_*(.doc_nrows = 10, ...)</code>.
Note that if document options are set after running the experiment, the experiment must be manually saved via <code>save_experiment(experiment)</code> in order for these changes to appear in the R Markdown output.</p>
</div>
<div class="section level3" number="4.2">
<h3 id="customizing-aesthetics-of-r-markdown-documentation">
<span class="header-section-number">4.2</span> Customizing aesthetics of R Markdown documentation<a class="anchor" aria-label="anchor" href="#customizing-aesthetics-of-r-markdown-documentation"></a>
</h3>
<p>There are additional customization options that can be set in <code><a href="../reference/render_docs.html">render_docs()</a></code> including the order in which results of <code>Evaluators</code> and <code>Visualizers</code> are displayed (via the <code>eval_order</code> and <code>viz_order</code> arguments) and the R Markdown output type or theme. For example,</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use html_document instead of vthemes::vmodern (default)</span></span>
<span><span class="fu"><a href="../reference/render_docs.html">render_docs</a></span><span class="op">(</span><span class="va">experiment</span>, output_format <span class="op">=</span> <span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/html_document.html" class="external-link">html_document</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add custom css style</span></span>
<span><span class="fu"><a href="../reference/render_docs.html">render_docs</a></span><span class="op">(</span><span class="va">experiment</span>, output_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>css <span class="op">=</span> <span class="st">"path/to/file.css"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To modify the R Markdown file directly, set <code>write_rmd = TRUE</code> in <code><a href="../reference/render_docs.html">render_docs()</a></code>:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/render_docs.html">render_docs</a></span><span class="op">(</span><span class="va">experiment</span>, write_rmd <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>This will write/save the raw R Markdown file used to generate the automated <code>simChef</code> documentation to your disk.
The file can be found in the experiment’s root results directory (specified by <code>get_save_dir(experiment)</code>) and can be directly modified to your liking.</p>
</div>
</div>
<div class="section level2" number="5">
<h2 id="additional-notes-and-usage">
<span class="header-section-number">5</span> Additional notes and usage<a class="anchor" aria-label="anchor" href="#additional-notes-and-usage"></a>
</h2>
<div class="section level3" number="5.1">
<h3 id="the-experiment-r6-class">
<span class="header-section-number">5.1</span> The Experiment R6 class<a class="anchor" aria-label="anchor" href="#the-experiment-r6-class"></a>
</h3>
<p>It is important to note that the <code>Experiment</code> class is an <code>R6</code>.
With this, we need to be careful about clones versus pointers.
In the following, it may look like the <code>new_experiment</code> object has a <code>vary_across</code> component while the <code>old_experiment</code> object does not have a <code>vary_across</code> component.
However, due to the use of the <code>R6</code> class, when <code>old_experiment</code> is piped into <code><a href="../reference/vary_across.html">add_vary_across()</a></code>, this is in itself modifying <code>old_experiment</code>, and <code>new_experiment</code> is simply pointing to this modified <code>old_experiment</code>.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">old_experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_experiment.html">create_experiment</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Old Experiment"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_dgp</a></span><span class="op">(</span><span class="va">linear_dgp</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_method</a></span><span class="op">(</span><span class="va">lm_method</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_evaluator</a></span><span class="op">(</span><span class="va">reject_prob_eval</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_visualizer</a></span><span class="op">(</span><span class="va">power_plot</span><span class="op">)</span></span>
<span><span class="va">old_experiment</span></span>
<span><span class="co">#&gt; Experiment Name: Old Experiment </span></span>
<span><span class="co">#&gt;    Saved results at: results/Old Experiment </span></span>
<span><span class="co">#&gt;    DGPs: Linear Gaussian DGP </span></span>
<span><span class="co">#&gt;    Methods: OLS </span></span>
<span><span class="co">#&gt;    Evaluators: Rejection Prob. (alpha = 0.1) </span></span>
<span><span class="co">#&gt;    Visualizers: Power </span></span>
<span><span class="co">#&gt;    Vary Across: None</span></span>
<span></span>
<span><span class="va">new_experiment</span> <span class="op">&lt;-</span> <span class="va">old_experiment</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/vary_across.html">add_vary_across</a></span><span class="op">(</span>.dgp <span class="op">=</span> <span class="st">"Linear Gaussian DGP"</span>, sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">old_experiment</span></span>
<span><span class="co">#&gt; Experiment Name: Old Experiment </span></span>
<span><span class="co">#&gt;    Saved results at: results/Old Experiment </span></span>
<span><span class="co">#&gt;    DGPs: Linear Gaussian DGP </span></span>
<span><span class="co">#&gt;    Methods: OLS </span></span>
<span><span class="co">#&gt;    Evaluators: Rejection Prob. (alpha = 0.1) </span></span>
<span><span class="co">#&gt;    Visualizers: Power </span></span>
<span><span class="co">#&gt;    Vary Across: </span></span>
<span><span class="co">#&gt;       DGP: Linear Gaussian DGP </span></span>
<span><span class="co">#&gt;          sigma:  num [1:4] 1 2 4 8</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">new_experiment</span>, <span class="va">old_experiment</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/address.html" class="external-link">address</a></span><span class="op">(</span><span class="va">new_experiment</span><span class="op">)</span> <span class="op">==</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/address.html" class="external-link">address</a></span><span class="op">(</span><span class="va">old_experiment</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div class="section level3" number="5.2">
<h3 id="creating-an-experiment-from-another-experiment">
<span class="header-section-number">5.2</span> Creating an experiment from another experiment<a class="anchor" aria-label="anchor" href="#creating-an-experiment-from-another-experiment"></a>
</h3>
<p>To modify <code>new_experiment</code> without changing <code>old_experiment</code>, we need to create <code>new_experiment</code> as a <em>clone</em> of the <code>old_experiment</code> as follows:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_experiment.html">create_experiment</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"I am a clone"</span>, clone_from <span class="op">=</span> <span class="va">old_experiment</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/address.html" class="external-link">address</a></span><span class="op">(</span><span class="va">new_experiment</span><span class="op">)</span> <span class="op">==</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/address.html" class="external-link">address</a></span><span class="op">(</span><span class="va">old_experiment</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="va">new_experiment</span></span>
<span><span class="co">#&gt; Experiment Name: I am a clone </span></span>
<span><span class="co">#&gt;    Saved results at: results/Old Experiment </span></span>
<span><span class="co">#&gt;    DGPs: Linear Gaussian DGP </span></span>
<span><span class="co">#&gt;    Methods: OLS </span></span>
<span><span class="co">#&gt;    Evaluators: Rejection Prob. (alpha = 0.1) </span></span>
<span><span class="co">#&gt;    Visualizers: Power </span></span>
<span><span class="co">#&gt;    Vary Across: None</span></span></code></pre></div>
<p>When creating an <code>Experiment</code> from a clone, we are making a deep clone of the parent experiment’s <code>DGPs</code>, <code>Methods</code>, <code>Evaluators</code>, and <code>Visualizers</code>, but not the <code>vary_across</code> component.
Thus, if we want a <code>vary_across</code> component in <code>new_experiment</code>, we must add this <code>vary_across</code> component ourselves:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_experiment</span> <span class="op">&lt;-</span> <span class="va">new_experiment</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/vary_across.html">add_vary_across</a></span><span class="op">(</span>.dgp <span class="op">=</span> <span class="st">"Linear Gaussian DGP"</span>, sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can also add/update DGPs, Methods, Evaluators, and Visualizers to the cloned experiment without modifying the parent <code>old_experiment</code>.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add DGP</span></span>
<span><span class="va">new_dgp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dgp.html">create_dgp</a></span><span class="op">(</span></span>
<span>  .dgp_fun <span class="op">=</span> <span class="va">linear_dgp_fun</span>, .name <span class="op">=</span> <span class="st">"Linear Gaussian DGP (large n)"</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">500</span>, beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, rho <span class="op">=</span> <span class="fl">0</span>, sigma <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">new_experiment</span> <span class="op">&lt;-</span> <span class="va">new_experiment</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_dgp</a></span><span class="op">(</span><span class="va">new_dgp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">new_experiment</span></span>
<span><span class="co">#&gt; Experiment Name: I am a clone </span></span>
<span><span class="co">#&gt;    Saved results at: results/Old Experiment </span></span>
<span><span class="co">#&gt;    DGPs: Linear Gaussian DGP, Linear Gaussian DGP (large n) </span></span>
<span><span class="co">#&gt;    Methods: OLS </span></span>
<span><span class="co">#&gt;    Evaluators: Rejection Prob. (alpha = 0.1) </span></span>
<span><span class="co">#&gt;    Visualizers: Power </span></span>
<span><span class="co">#&gt;    Vary Across: </span></span>
<span><span class="co">#&gt;       DGP: Linear Gaussian DGP </span></span>
<span><span class="co">#&gt;          sigma:  num [1:4] 1 2 4 8</span></span>
<span><span class="va">old_experiment</span></span>
<span><span class="co">#&gt; Experiment Name: Old Experiment </span></span>
<span><span class="co">#&gt;    Saved results at: results/Old Experiment </span></span>
<span><span class="co">#&gt;    DGPs: Linear Gaussian DGP </span></span>
<span><span class="co">#&gt;    Methods: OLS </span></span>
<span><span class="co">#&gt;    Evaluators: Rejection Prob. (alpha = 0.1) </span></span>
<span><span class="co">#&gt;    Visualizers: Power </span></span>
<span><span class="co">#&gt;    Vary Across: </span></span>
<span><span class="co">#&gt;       DGP: Linear Gaussian DGP </span></span>
<span><span class="co">#&gt;          sigma:  num [1:4] 1 2 4 8</span></span></code></pre></div>
</div>
<div class="section level3" number="5.3">
<h3 id="additional-handling-of-the-experiment">
<span class="header-section-number">5.3</span> Additional handling of the experiment<a class="anchor" aria-label="anchor" href="#additional-handling-of-the-experiment"></a>
</h3>
<p><code><a href="../reference/run_experiment.html">run_experiment()</a></code> is the easiest and most concise way of running the simulation experiment from start to finish.
However, when debugging and developing the simulation experiment, it may be helpful to run only parts of the experiment so as to not repeat time-consuming, redundant computations.
As discussed in Section <a href="#a-tidy-grammar-for-simulation-experiments">1</a>, <code><a href="../reference/run_experiment.html">run_experiment()</a></code> is a wrapper around <code><a href="../reference/fit_experiment.html">fit_experiment()</a></code>, <code><a href="../reference/evaluate_experiment.html">evaluate_experiment()</a></code>, and <code><a href="../reference/visualize_experiment.html">visualize_experiment()</a></code>.
Although generally not necessary, sometimes it can be helpful to call each of these functions separately:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_experiment.html">fit_experiment</a></span><span class="op">(</span><span class="va">experiment</span>, n_reps <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; Fitting Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; 10 reps completed (totals: 10/10) | time taken: 0.244829 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="va">eval_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evaluate_experiment.html">evaluate_experiment</a></span><span class="op">(</span><span class="va">experiment</span>, <span class="va">fit_results</span><span class="op">)</span></span>
<span><span class="co">#&gt; Evaluating Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Evaluation completed | time taken: 0.000101 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="va">viz_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualize_experiment.html">visualize_experiment</a></span><span class="op">(</span><span class="va">experiment</span>, <span class="va">fit_results</span>, <span class="va">eval_results</span><span class="op">)</span></span>
<span><span class="co">#&gt; Visualizing Linear Regression Experiment...</span></span>
<span><span class="co">#&gt; Visualization completed | time taken: 0.001062 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span></code></pre></div>
<p>Similarly, although it is not usually necessary, there may be some instances (e.g., for exploratory data analysis or further diagnosis of the experiment results), in which one would like to generate small samples of data from the <code>DGPs</code> in the experiment via</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_data.html">generate_data</a></span><span class="op">(</span><span class="va">experiment</span>, n_reps <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 1</span></span>
<span><span class="co">#&gt;  $ Linear Gaussian DGP:List of 4</span></span>
<span><span class="co">#&gt;   ..$ :List of 1</span></span>
<span><span class="co">#&gt;   .. ..$ :List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ X: num [1:200, 1:2] 1.7222 2.1346 -0.0689 -0.8678 2.29 ...</span></span>
<span><span class="co">#&gt;   .. .. .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. .. .. .. ..$ : NULL</span></span>
<span><span class="co">#&gt;   .. .. .. .. ..$ : NULL</span></span>
<span><span class="co">#&gt;   .. .. ..$ y: num [1:200, 1] 0.792 1.003 1.017 -0.354 2.583 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "params")=List of 1</span></span>
<span><span class="co">#&gt;   .. .. ..$ sigma: num 1</span></span>
<span><span class="co">#&gt;   ..$ :List of 1</span></span>
<span><span class="co">#&gt;   .. ..$ :List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ X: num [1:200, 1:2] -0.533 -0.876 -0.139 -0.94 0.664 ...</span></span>
<span><span class="co">#&gt;   .. .. .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. .. .. .. ..$ : NULL</span></span>
<span><span class="co">#&gt;   .. .. .. .. ..$ : NULL</span></span>
<span><span class="co">#&gt;   .. .. ..$ y: num [1:200, 1] -3.077 1.072 2.423 -0.992 -2.808 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "params")=List of 1</span></span>
<span><span class="co">#&gt;   .. .. ..$ sigma: num 2</span></span>
<span><span class="co">#&gt;   ..$ :List of 1</span></span>
<span><span class="co">#&gt;   .. ..$ :List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ X: num [1:200, 1:2] -3.289 -1.4307 -1.4029 -0.0207 -1.2221 ...</span></span>
<span><span class="co">#&gt;   .. .. .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. .. .. .. ..$ : NULL</span></span>
<span><span class="co">#&gt;   .. .. .. .. ..$ : NULL</span></span>
<span><span class="co">#&gt;   .. .. ..$ y: num [1:200, 1] -5.7 1.48 -3.87 -1.07 -6.29 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "params")=List of 1</span></span>
<span><span class="co">#&gt;   .. .. ..$ sigma: num 4</span></span>
<span><span class="co">#&gt;   ..$ :List of 1</span></span>
<span><span class="co">#&gt;   .. ..$ :List of 2</span></span>
<span><span class="co">#&gt;   .. .. ..$ X: num [1:200, 1:2] 2.456 -0.896 -0.755 -0.27 -1.16 ...</span></span>
<span><span class="co">#&gt;   .. .. .. ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. .. .. .. ..$ : NULL</span></span>
<span><span class="co">#&gt;   .. .. .. .. ..$ : NULL</span></span>
<span><span class="co">#&gt;   .. .. ..$ y: num [1:200, 1] 6.995 -4.652 1.447 -0.012 4.911 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "params")=List of 1</span></span>
<span><span class="co">#&gt;   .. .. ..$ sigma: num 8</span></span></code></pre></div>
<p>It may also be helpful to work with individual <code><a href="../reference/DGP.html">DGP()</a></code>, <code><a href="../reference/Method.html">Method()</a></code>, <code><a href="../reference/Evaluator.html">Evaluator()</a></code>, and <code><a href="../reference/Visualizer.html">Visualizer()</a></code> objects outside of running an <code>Experiment</code>. This can be done by leveraging the verbs and grammar laid out in Section <a href="#a-tidy-grammar-for-simulation-experiments">1</a>. The API is as follows:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="va">DGP</span><span class="op">$</span><span class="fu">generate</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">method_results</span> <span class="op">&lt;-</span> <span class="va">Method</span><span class="op">$</span><span class="fu">fit</span><span class="op">(</span>data_list <span class="op">=</span> <span class="va">data_list</span><span class="op">)</span></span>
<span><span class="va">eval_results</span> <span class="op">&lt;-</span> <span class="va">Evaluator</span><span class="op">$</span><span class="fu">evaluate</span><span class="op">(</span></span>
<span>  fit_results <span class="op">=</span> <span class="va">fit_results</span>, </span>
<span>  vary_params <span class="op">=</span> <span class="va">vary_params</span></span>
<span><span class="op">)</span></span>
<span><span class="va">viz_results</span> <span class="op">&lt;-</span> <span class="va">Visualizer</span><span class="op">$</span><span class="fu">visualize</span><span class="op">(</span></span>
<span>  fit_results <span class="op">=</span> <span class="va">fit_results</span>, </span>
<span>  eval_results <span class="op">=</span> <span class="va">eval_results</span>, </span>
<span>  vary_params <span class="op">=</span> <span class="va">vary_params</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here, <code>fit_results</code> is the output of <code><a href="../reference/fit_experiment.html">fit_experiment()</a></code>, <code>eval_results</code> is the output of <code><a href="../reference/evaluate_experiment.html">evaluate_experiment()</a></code>, and <code>vary_params</code> is a character vector of the parameter names that are being varied in the experiment.</p>
<p>Other helpful methods for handling the experiment include the <code>get_*</code> family of methods, i.e.,</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_funs.html">get_dgps</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`Linear Gaussian DGP`</span></span>
<span><span class="co">#&gt; DGP Name: Linear Gaussian DGP </span></span>
<span><span class="co">#&gt;    Function: function (n, beta, rho, sigma)  </span></span>
<span><span class="co">#&gt;    Parameters: List of 4</span></span>
<span><span class="co">#&gt;      $ n    : num 200</span></span>
<span><span class="co">#&gt;      $ beta : num [1:2] 1 0</span></span>
<span><span class="co">#&gt;      $ rho  : num 0</span></span>
<span><span class="co">#&gt;      $ sigma: num 1</span></span>
<span><span class="fu"><a href="../reference/get_funs.html">get_methods</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></span>
<span><span class="co">#&gt; $OLS</span></span>
<span><span class="co">#&gt; Method Name: OLS </span></span>
<span><span class="co">#&gt;    Function: function (X, y, cols = c("X1", "X2"))  </span></span>
<span><span class="co">#&gt;    Parameters:  list()</span></span>
<span><span class="fu"><a href="../reference/get_funs.html">get_evaluators</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`Rejection Prob. (alpha = 0.1)`</span></span>
<span><span class="co">#&gt; Evaluator Name: Rejection Prob. (alpha = 0.1) </span></span>
<span><span class="co">#&gt;    Function: function (fit_results, vary_params = NULL, alpha = 0.05)  </span></span>
<span><span class="co">#&gt;    Parameters: List of 1</span></span>
<span><span class="co">#&gt;      $ alpha: num 0.1</span></span>
<span><span class="co">#&gt;    R Markdown Options: List of 3</span></span>
<span><span class="co">#&gt;      $ digits : num 3</span></span>
<span><span class="co">#&gt;      $ sigfig : logi FALSE</span></span>
<span><span class="co">#&gt;      $ options:List of 2</span></span>
<span><span class="co">#&gt;       ..$ scrollX       : logi TRUE</span></span>
<span><span class="co">#&gt;       ..$ scrollCollapse: logi TRUE</span></span>
<span><span class="co">#&gt;    Show in R Markdown: TRUE</span></span>
<span><span class="fu"><a href="../reference/get_funs.html">get_visualizers</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></span>
<span><span class="co">#&gt; $Power</span></span>
<span><span class="co">#&gt; Visualizer Name: Power </span></span>
<span><span class="co">#&gt;    Function: function (fit_results, vary_params = NULL, col = "X1")  </span></span>
<span><span class="co">#&gt;    Parameters:  list()</span></span>
<span><span class="co">#&gt;    R Markdown Options: List of 2</span></span>
<span><span class="co">#&gt;      $ height: num 10</span></span>
<span><span class="co">#&gt;      $ width : num 8</span></span>
<span><span class="co">#&gt;    Show in R Markdown: TRUE </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Rejection Prob. (alpha = 0.1) Plot`</span></span>
<span><span class="co">#&gt; Visualizer Name: Rejection Prob. (alpha = 0.1) Plot </span></span>
<span><span class="co">#&gt;    Function: function (eval_results, vary_params = NULL)  </span></span>
<span><span class="co">#&gt;    Parameters:  list()</span></span>
<span><span class="co">#&gt;    R Markdown Options: List of 2</span></span>
<span><span class="co">#&gt;      $ height: num 6</span></span>
<span><span class="co">#&gt;      $ width : num 10</span></span>
<span><span class="co">#&gt;    Show in R Markdown: TRUE</span></span>
<span><span class="fu"><a href="../reference/vary_across.html">get_vary_across</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></span>
<span><span class="co">#&gt; $dgp</span></span>
<span><span class="co">#&gt; $dgp$`Linear Gaussian DGP`</span></span>
<span><span class="co">#&gt; $dgp$`Linear Gaussian DGP`$sigma</span></span>
<span><span class="co">#&gt; [1] 1 2 4 8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $method</span></span>
<span><span class="co">#&gt; list()</span></span></code></pre></div>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_save_dir.html">get_save_dir</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "./results/Linear Regression Experiment"</span></span></code></pre></div>
</div>
<div class="section level3" number="5.4">
<h3 id="saving-results">
<span class="header-section-number">5.4</span> Saving results<a class="anchor" aria-label="anchor" href="#saving-results"></a>
</h3>
<p>Since the R Markdown report heavily relies on the results file structure to organize the report summary, it may be helpful to understand the default saving structure utilized in <code>simChef</code>.</p>
<p>By default, the experiment’s root results directory is ./results/{EXPERIMENT_NAME}. To change the root results directory, one can specify the desired directory via the <code>save_dir</code> argument in <code><a href="../reference/create_experiment.html">create_experiment()</a></code> or use the <code><a href="../reference/set_save_dir.html">set_save_dir()</a></code> helper function.</p>
<p>All results from <code>run_experiment(experiment, ..., save = TRUE)</code> without a <code>vary_across</code> component are then saved under the root results directory. If <code>experiment</code> has a <code>vary_across</code> component, then the results of <code>run_experiment(experiment, ..., save = TRUE)</code> are saved under ./{ROOT_RESULTS_DIR}/{DGP_OR_METHOD_NAME}/Varying {PARAM_NAME}/.</p>
<p>Here’s the directory tree of the “Linear Regression Experiment” example:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_save_dir.html">get_save_dir</a></span><span class="op">(</span><span class="va">experiment</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; results</span></span>
<span><span class="co">#&gt; ├── Linear Gaussian DGP</span></span>
<span><span class="co">#&gt; │   ├── Varying beta</span></span>
<span><span class="co">#&gt; │   │   ├── eval_results.rds</span></span>
<span><span class="co">#&gt; │   │   ├── experiment.rds</span></span>
<span><span class="co">#&gt; │   │   ├── experiment_cached_params.rds</span></span>
<span><span class="co">#&gt; │   │   ├── fit_results.rds</span></span>
<span><span class="co">#&gt; │   │   └── viz_results.rds</span></span>
<span><span class="co">#&gt; │   ├── Varying rho</span></span>
<span><span class="co">#&gt; │   │   ├── eval_results.rds</span></span>
<span><span class="co">#&gt; │   │   ├── experiment.rds</span></span>
<span><span class="co">#&gt; │   │   ├── experiment_cached_params.rds</span></span>
<span><span class="co">#&gt; │   │   ├── fit_results.rds</span></span>
<span><span class="co">#&gt; │   │   └── viz_results.rds</span></span>
<span><span class="co">#&gt; │   └── Varying sigma</span></span>
<span><span class="co">#&gt; │       ├── eval_results.rds</span></span>
<span><span class="co">#&gt; │       ├── experiment.rds</span></span>
<span><span class="co">#&gt; │       ├── fit_results.rds</span></span>
<span><span class="co">#&gt; │       └── viz_results.rds</span></span>
<span><span class="co">#&gt; ├── Linear Regression Experiment.html</span></span>
<span><span class="co">#&gt; ├── docs</span></span>
<span><span class="co">#&gt; │   ├── dgps</span></span>
<span><span class="co">#&gt; │   │   └── Linear Gaussian DGP.md</span></span>
<span><span class="co">#&gt; │   ├── evaluators</span></span>
<span><span class="co">#&gt; │   │   └── Rejection Prob. (alpha = 0.1).md</span></span>
<span><span class="co">#&gt; │   ├── methods</span></span>
<span><span class="co">#&gt; │   │   └── OLS.md</span></span>
<span><span class="co">#&gt; │   ├── objectives.md</span></span>
<span><span class="co">#&gt; │   └── visualizers</span></span>
<span><span class="co">#&gt; │       ├── Power.md</span></span>
<span><span class="co">#&gt; │       └── Rejection Prob. (alpha = 0.1) Plot.md</span></span>
<span><span class="co">#&gt; ├── eval_results.rds</span></span>
<span><span class="co">#&gt; ├── experiment.rds</span></span>
<span><span class="co">#&gt; ├── experiment_cached_params.rds</span></span>
<span><span class="co">#&gt; ├── fit_results.rds</span></span>
<span><span class="co">#&gt; └── viz_results.rds</span></span></code></pre></div>
</div>
<div class="section level3" number="5.5">
<h3 id="simulation-project-template">
<span class="header-section-number">5.5</span> Simulation project template<a class="anchor" aria-label="anchor" href="#simulation-project-template"></a>
</h3>
<p>To help with onboarding and setting up your simulation study, we have provided a helper function <code><a href="../reference/init_sim_project.html">init_sim_project()</a></code>, which initializes a ready-to-use directory for your <code>simChef</code> simulation project:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/init_sim_project.html">init_sim_project</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"path/to/your/project"</span><span class="op">)</span></span></code></pre></div>
<p>This will create a project directory with the following structure:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a>project<span class="sc">/</span></span>
<span id="cb65-2"><a href="#cb65-2" tabindex="-1"></a>├── .git</span>
<span id="cb65-3"><a href="#cb65-3" tabindex="-1"></a>├── .gitignore</span>
<span id="cb65-4"><a href="#cb65-4" tabindex="-1"></a>├── R           <span class="co"># folder containing general R functions</span></span>
<span id="cb65-5"><a href="#cb65-5" tabindex="-1"></a>│   ├── dgp     <span class="do">## folder containing dgp functions</span></span>
<span id="cb65-6"><a href="#cb65-6" tabindex="-1"></a>│   ├── eval    <span class="do">## folder containing evaluation functions</span></span>
<span id="cb65-7"><a href="#cb65-7" tabindex="-1"></a>│   ├── method  <span class="do">## folder containing method functions</span></span>
<span id="cb65-8"><a href="#cb65-8" tabindex="-1"></a>│   └── viz     <span class="do">## folder containing visualization functions</span></span>
<span id="cb65-9"><a href="#cb65-9" tabindex="-1"></a>├── README.md</span>
<span id="cb65-10"><a href="#cb65-10" tabindex="-1"></a>├── meals       <span class="co"># folder containing scripts to assemble/run simulation experiments</span></span>
<span id="cb65-11"><a href="#cb65-11" tabindex="-1"></a>│   └── meal.R  <span class="do">## example script to assemble/run a simulation experiment</span></span>
<span id="cb65-12"><a href="#cb65-12" tabindex="-1"></a>├── renv</span>
<span id="cb65-13"><a href="#cb65-13" tabindex="-1"></a>├── results     <span class="co"># folder containing results from simulation experiments</span></span>
<span id="cb65-14"><a href="#cb65-14" tabindex="-1"></a>└── tests       <span class="co"># folder containing test scripts</span></span>
<span id="cb65-15"><a href="#cb65-15" tabindex="-1"></a>    ├── testthat</span>
<span id="cb65-16"><a href="#cb65-16" tabindex="-1"></a>    │   ├── dgp<span class="sc">-</span>tests     <span class="do">## folder containing tests for dgp functions</span></span>
<span id="cb65-17"><a href="#cb65-17" tabindex="-1"></a>    │   ├── eval<span class="sc">-</span>tests    <span class="do">## folder containing tests for evaluation functions</span></span>
<span id="cb65-18"><a href="#cb65-18" tabindex="-1"></a>    │   ├── method<span class="sc">-</span>tests  <span class="do">## folder containing tests for method functions</span></span>
<span id="cb65-19"><a href="#cb65-19" tabindex="-1"></a>    │   └── viz<span class="sc">-</span>tests     <span class="do">## folder containing tests for visualization functions</span></span>
<span id="cb65-20"><a href="#cb65-20" tabindex="-1"></a>    └── testthat.R</span></code></pre></div>
<p>Using this project directory structure, we recommend placing your DGP, method, evaluation, and visualization functions in the appropriate subdirectories within the <code>R</code> directory to stay modular and organized. Then, to assemble and run your simulation experiment, you can write an executable <em>meal</em> script and store it in the <code>meals</code> directory. To see what this project directory structure may look like in practice for our toy simulation, check out this <a href="https://github.com/tiffanymtang/simChef-project" class="external-link">GitHub repository</a>.</p>
<p>Moreover, <code><a href="../reference/init_sim_project.html">init_sim_project()</a></code> automatically integrates your simulation project with several major reproducibility and replicability tools, including <code>git</code> (for version control), <code>renv</code> (for management of package dependencies), and <code>testthat</code> (for unit testing). For more information and other best practices to improve reproducibility and replicability of your simulation study, please see the vignette <a href="simulation-directory-setup.html">Setting up your simulation study</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-chang-r6-2022" class="csl-entry">
Chang, Winston. 2022. <em>R6: Encapsulated Classes with Reference Semantics</em>.
</div>
<div id="ref-wickham-welcome-2019" class="csl-entry">
Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. <span>“Welcome to the <span>Tidyverse</span>.”</span> <em>Journal of Open Source Software</em> 4 (43): 1686. <a href="https://doi.org/10.21105/joss.01686" class="external-link">https://doi.org/10.21105/joss.01686</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tiffany Tang, James Duncan.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
