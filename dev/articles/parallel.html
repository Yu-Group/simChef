<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="simChef">
<title>Computing experimental replicates in parallel • simChef</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Computing experimental replicates in parallel">
<meta property="og:description" content="simChef">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">simChef</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.0.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/simChef.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/parallel.html">Computing experimental replicates in parallel</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Yu-Group/simChef/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Computing experimental replicates in parallel</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Yu-Group/simChef/blob/HEAD/vignettes/parallel.Rmd" class="external-link"><code>vignettes/parallel.Rmd</code></a></small>
      <div class="d-none name"><code>parallel.Rmd</code></div>
    </div>

    
    
<p>Given the large amount of computation that simulation studies
require, one of the main goals of <code>simChef</code> is to make it
easy to parallelize your simulations. <code>simChef</code> uses the R
package <a href="https://future.futureverse.org/" class="external-link"><code>future</code></a> to
distribute simulation replicates across whatever available resources the
user specifies. All you have to do to start running your simulations in
parallel is set the <code>future</code> plan before calling
<code><a href="../reference/run_experiment.html">run_experiment()</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_workers</span> <span class="op">&lt;-</span> <span class="fu">availableCores</span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="fu">plan</span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="va">n_workers</span><span class="op">)</span></span></code></pre></div>
<p>The <code>multisession</code> plan used here will run your simulation
experiments on a local (i.e., where R is running) Linux, macOS, or
Windows machine, in this case using all but one of the cores. This is
very convenient, but it’s important to carefully consider two aspects of
the distributed computation in order to effectively parallelize the
simulations: <em>what</em> plan to use and <em>how</em> to use it.</p>
<p>While <code>simChef</code> works with any valid <code>future</code>
plan, one may be better than another for your particular set of
experiments. We recommend you carefully read the <code>future</code> <a href="https://future.futureverse.org/articles/future-1-overview.html#controlling-how-futures-are-resolved" class="external-link">docs</a>
to learn more about the default plans, as well as alternative plans in
packages like <a href="https://future.callr.futureverse.org" class="external-link"><code>future.callr</code></a>
and <a href="https://future.batchtools.futureverse.org" class="external-link"><code>future.batchtools</code></a>.</p>
<div class="section level2">
<h2 id="simulation-tasks">Simulation tasks<a class="anchor" aria-label="anchor" href="#simulation-tasks"></a>
</h2>
<p>When a <code>future</code> plan has been set and the user calls
<code>run_experiment</code>, <code>simChef</code> will distribute
computation across the resources specified in the plan. Consider
<code>n</code> computational “tasks” to be distributed across
<code>p</code> parallel workers. In <code>simChef</code>, tasks
correspond to simulation replicates, which generate data from a single
<code>DGP</code> and fit that data using a single <code>Method</code>,
along with associated parameters (either defaults or from those that
have been varied in the <code>Experiment</code>).</p>
<p>Assuming each task takes approximately the same amount of time to
complete regardless of the worker assigned to the task, then with
<code>n=100</code> and <code>p=4</code> each worker should complete
around 25 of the tasks. In the ideal setting, the total time to complete
the 100 tasks should be around 4 times lower than the time it takes one
worker to complete them, on average.</p>
<div class="section level3">
<h3 id="dealing-with-task-heterogeneity">Dealing with task heterogeneity<a class="anchor" aria-label="anchor" href="#dealing-with-task-heterogeneity"></a>
</h3>
<p>In more realistic scenarios–and especially in simulation experiments
which often include heterogeneous methods compared under diverse
data-generated processes for a range of sample sizes–tasks can be much
less uniform. Different groupings of tasks can have profound
implications for the overall running time. Therefore, it’s important to
carefully decide how to arrange your simulation into separate
experiments in order to take greatest advantage of the available
parallelism.</p>
<p><code>simChef</code> distributes the simulation’s replicates evenly
across available <code>future</code> workers, partially answering the
<em>how</em> question. The remainder of the answer comes from you and
your specific application, but here are a couple tips:</p>
<ul>
<li>In general, one should not have fewer tasks than workers and should
avoid <code>n&gt;&gt;p</code> very small tasks as the overhead of
distributing computation to workers may outweigh the benefits of
parallelism.</li>
<li>When tasks have unbalanced sizes, it can be helpful to group tasks
into separate experiments, each of which has tasks of roughly equal
duration. In spite of the extra overhead, you may find that using a
separate <code>Experiment</code> for each task group ends up decreasing
the overall simulation running time because workers with small tasks
spend less time idly waiting for workers with large tasks to finish.
Using the <code>clone_from</code> argument in
<code><a href="../reference/create_experiment.html">create_experiment()</a></code>, you can copy an existing experiment
and modify it so that tasks have similar sizes, repeating this process
for each group of similarly-sized tasks.</li>
<li>You can use the <a href="https://progressr.futureverse.org/" class="external-link"><code>progressr</code></a>
package to get updates as the experiment computation progresses.</li>
<li>Use <code>options(simChef.debug = TRUE)</code> to get helpful
debugging output as an <code>Experiment</code> works on it’s tasks,
including info on memory usage. This may slow things down quite a bit,
so don’t use it when you run the full simulation.</li>
</ul>
</div>
<div class="section level3">
<h3 id="on-the-roadmap-nested-parallelism">On the roadmap: nested parallelism<a class="anchor" aria-label="anchor" href="#on-the-roadmap-nested-parallelism"></a>
</h3>
<p>In the future we plan to give more control over how the user splits
the computation across workers, with nested parallelism for cases where,
e.g., <code>DGPs</code> can be split across a few nodes (e.g., using one
of the plan in the package <a href="https://future.batchtools.futureverse.org/" class="external-link"><code>future.batchtools</code></a>)
and each node uses many cores to process the replicates in parallel
(e.g., using the <code><a href="https://future.futureverse.org/reference/multicore.html" class="external-link">future::multicore</a></code> plan).</p>
<p>If this is something you’re interested in, please feel free to
contribute to the discussion at <a href="https://github.com/Yu-Group/simChef/issues/54" class="external-link uri">https://github.com/Yu-Group/simChef/issues/54</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Putting aside the caveats above for now, parallelization in
<code>simChef</code> works without modification other than using
<code>future</code> to set a parallel backend. In the example below, we
choose the <code>multicore</code> backend (not available on Windows) to
create forked R processes using all of the available cores.</p>
<p>This example shows how total replicates can quickly add up when
varying across <code>DGP</code> or <code>Method</code> parameters. By
varying across parameters of one of the <code>DGPs</code>, we in effect
have 17 distinct data generating processes in the experiment (1 for
<code>dgp1</code> and 16 for the combinations of parameters to
<code>dgp2</code>), though in actuality there are only two
<code>DGP</code> objects. Similarly, we effectively have 4 distinct
methods, though there are only 2 <code>Method</code> objects. With
<code>n_reps = 2</code>, this results in a total of 2 x 17 x 4 = 136
total rows in the results <code>tibble</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yu-group.github.io/simChef">simChef</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span></span>
<span><span class="va">n_cores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://parallelly.futureverse.org/reference/availableCores.html" class="external-link">availableCores</a></span><span class="op">(</span>methods <span class="op">=</span> <span class="st">"system"</span><span class="op">)</span></span>
<span><span class="va">n_cores</span></span>
<span><span class="co">#&gt; system </span></span>
<span><span class="co">#&gt;      2</span></span>
<span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multicore</span>, workers <span class="op">=</span> <span class="va">n_cores</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dgp_fun1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">=</span><span class="fl">100</span>, <span class="va">rho</span><span class="op">=</span><span class="fl">0.5</span>, <span class="va">noise_level</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cov_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="va">cov_mat</span><span class="op">[</span><span class="va">cov_mat</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rho</span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="va">cov_mat</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">8</span>, <span class="fl">3</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="va">noise_level</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">dgp_fun2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">=</span><span class="fl">100</span>, <span class="va">d</span><span class="op">=</span><span class="fl">100</span>, <span class="va">rho</span><span class="op">=</span><span class="fl">0.5</span>, <span class="va">sparsity</span><span class="op">=</span><span class="fl">0.5</span>, <span class="va">noise_level</span><span class="op">=</span><span class="fl">1</span>,</span>
<span>                     <span class="va">nonzero_coeff</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cov_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span>  <span class="va">cov_mat</span><span class="op">[</span><span class="va">cov_mat</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rho</span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">d</span><span class="op">)</span>, Sigma <span class="op">=</span> <span class="va">cov_mat</span><span class="op">)</span></span>
<span>  <span class="va">coeff_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sparsity</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">sparsity</span><span class="op">)</span> <span class="op">/</span> <span class="fl">4</span>, times <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">coeff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="op">-</span><span class="fl">8</span>, <span class="co"># intercept</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nonzero_coeff</span><span class="op">)</span>, size <span class="op">=</span> <span class="va">d</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      prob <span class="op">=</span> <span class="va">coeff_prob</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">coeff</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="va">noise_level</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">dgp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dgp.html">create_dgp</a></span><span class="op">(</span><span class="va">dgp_fun1</span>, .name <span class="op">=</span> <span class="st">"dense_dgp"</span><span class="op">)</span></span>
<span><span class="va">dgp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_dgp.html">create_dgp</a></span><span class="op">(</span><span class="va">dgp_fun2</span>, .name <span class="op">=</span> <span class="st">"sparse_dgp"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ols</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">X</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">elnet</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, <span class="va">alpha</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">glmnet</span><span class="fu">::</span><span class="fu"><a href="https://glmnet.stanford.edu/reference/glmnet.html" class="external-link">glmnet</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">y</span>, family <span class="op">=</span> <span class="st">"gaussian"</span>, alpha <span class="op">=</span> <span class="va">alpha</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">method1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_method.html">create_method</a></span><span class="op">(</span><span class="va">ols</span>, .name <span class="op">=</span> <span class="st">"ols"</span><span class="op">)</span></span>
<span><span class="va">method2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_method.html">create_method</a></span><span class="op">(</span><span class="va">elnet</span>, .name <span class="op">=</span> <span class="st">"elnet"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_experiment.html">create_experiment</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"exper"</span>, future.packages <span class="op">=</span> <span class="st">"dplyr"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_dgp</a></span><span class="op">(</span><span class="va">dgp1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_dgp</a></span><span class="op">(</span><span class="va">dgp2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_method</a></span><span class="op">(</span><span class="va">method1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_funs.html">add_method</a></span><span class="op">(</span><span class="va">method2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/vary_across.html">add_vary_across</a></span><span class="op">(</span></span>
<span>    .dgp <span class="op">=</span> <span class="st">"sparse_dgp"</span>,</span>
<span>    d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>    rho <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>    sparsity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>    nonzero_coeff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.3</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/vary_across.html">add_vary_across</a></span><span class="op">(</span></span>
<span>    .method <span class="op">=</span> <span class="st">"elnet"</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="va">experiment</span><span class="op">$</span><span class="fu">fit</span><span class="op">(</span>n_reps <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Fitting exper...</span></span>
<span><span class="co">#&gt; 2 reps completed (totals: 2/2) | time taken: 0.673767 minutes</span></span>
<span><span class="co">#&gt; ==============================</span></span>
<span><span class="va">results</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 136 × 16</span></span></span>
<span><span class="co">#&gt;    .rep  .dgp_…¹ .meth…²     d   rho spars…³ nonze…⁴ alpha term  estim…⁵ std.e…⁶</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lis&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1     dense_… elnet      <span style="color: #BB0000;">NA</span>  <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>   <span style="color: #949494;">&lt;NULL&gt;</span>    0   &lt;chr&gt; &lt;dbl&gt;   <span style="color: #949494;">&lt;NULL&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1     dense_… elnet      <span style="color: #BB0000;">NA</span>  <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>   <span style="color: #949494;">&lt;NULL&gt;</span>    0.5 &lt;chr&gt; &lt;dbl&gt;   <span style="color: #949494;">&lt;NULL&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1     dense_… elnet      <span style="color: #BB0000;">NA</span>  <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>   <span style="color: #949494;">&lt;NULL&gt;</span>    1   &lt;chr&gt; &lt;dbl&gt;   <span style="color: #949494;">&lt;NULL&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1     dense_… ols        <span style="color: #BB0000;">NA</span>  <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>   <span style="color: #949494;">&lt;NULL&gt;</span>   <span style="color: #BB0000;">NA</span>   &lt;chr&gt; &lt;dbl&gt;   &lt;dbl&gt;  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1     sparse… elnet     100   0.2     0.5 &lt;dbl&gt;     0   &lt;chr&gt; &lt;dbl&gt;   <span style="color: #949494;">&lt;NULL&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1     sparse… elnet     100   0.2     0.5 &lt;dbl&gt;     0.5 &lt;chr&gt; &lt;dbl&gt;   <span style="color: #949494;">&lt;NULL&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1     sparse… elnet     100   0.2     0.5 &lt;dbl&gt;     1   &lt;chr&gt; &lt;dbl&gt;   <span style="color: #949494;">&lt;NULL&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1     sparse… elnet    <span style="text-decoration: underline;">1</span>000   0.2     0.5 &lt;dbl&gt;     0   &lt;chr&gt; &lt;dbl&gt;   <span style="color: #949494;">&lt;NULL&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1     sparse… elnet    <span style="text-decoration: underline;">1</span>000   0.2     0.5 &lt;dbl&gt;     0.5 &lt;chr&gt; &lt;dbl&gt;   <span style="color: #949494;">&lt;NULL&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1     sparse… elnet    <span style="text-decoration: underline;">1</span>000   0.2     0.5 &lt;dbl&gt;     1   &lt;chr&gt; &lt;dbl&gt;   <span style="color: #949494;">&lt;NULL&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 126 more rows, 5 more variables: statistic &lt;list&gt;, p.value &lt;list&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   step &lt;list&gt;, lambda &lt;list&gt;, dev.ratio &lt;list&gt;, and abbreviated variable</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   names ¹​.dgp_name, ²​.method_name, ³​sparsity, ⁴​nonzero_coeff, ⁵​estimate,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ⁶​std.error</span></span></span></code></pre></div>
<p>If we find lower computational resource utilization than we’d like,
as the simulation grows we might consider breaking this experiment up
into separate experiments, e.g., by DGP, method, or parameters like
sample size <code>n</code> and number of covariates <code>d</code>,
depending on which factors have the greatest impact on task
duration.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by James Duncan, Tiffany Tang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
